{"version":3,"file":"BaseSwatchView-96d72c6c.js","sources":["../../src/PRIVATE_BaseSwatchView/BaseSwatchViewItem.tsx","../../src/PRIVATE_BaseSwatchView/BaseSwatchViewLayout.tsx","../../src/PRIVATE_BaseSwatchView/BaseSwatchViewUtils.ts","../../src/PRIVATE_BaseSwatchView/BaseSwatchView.tsx"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\nimport { ComponentChildren } from 'preact';\nimport { memo } from 'preact/compat';\nimport { useRef, useCallback, useLayoutEffect, StateUpdater, Dispatch } from 'preact/hooks';\nimport { classNames } from '../utils/UNSAFE_classNames';\nimport { warn } from '../utils/UNSAFE_logger';\nimport { allTabbableElements } from '../utils/PRIVATE_tabbableUtils';\nimport { useId } from '../hooks/UNSAFE_useId';\nimport { useResizeObserver } from '../hooks/UNSAFE_useResizeObserver';\nimport { TabbableModeContext } from '../hooks/UNSAFE_useTabbableMode';\nimport { FocusTrap } from '../UNSAFE_FocusTrap';\nimport { ListItemRendererContext } from '../UNSAFE_Collection';\nimport { multiVariantStyles, styles } from './themes/BaseSwatchViewStyles.css';\nimport { compareListItemContext } from '../utils/PRIVATE_collectionUtils';\n\n/**\n * Props for the BaseSwatchViewItem Component\n */\nexport type Props<K, D> = {\n  children: (context: ListItemRendererContext<K, D>) => ComponentChildren;\n  context: ListItemRendererContext<K, D>;\n  isTabbable: boolean;\n  isFocused: boolean;\n  isFocusRingVisible: boolean;\n  focusBehavior: 'swatch' | 'content';\n  setIsFocusBehaviorValid?: Dispatch<StateUpdater<boolean>>;\n  updateSwatchSize?: (width: number, height: number) => void;\n};\n\n/**\n * The internal component used to render a single item in SwatchView.\n */\nexport function BaseSwatchViewItem<K extends string | number, D>({\n  children,\n  context,\n  isTabbable,\n  isFocused,\n  isFocusRingVisible,\n  focusBehavior,\n  setIsFocusBehaviorValid,\n  updateSwatchSize\n}: Props<K, D>) {\n  const rootRef = useRef<HTMLDivElement>(null);\n  const itemKey = context.metadata.key;\n\n  const isItemFocused = isFocused && isFocusRingVisible;\n  const variantClasses = multiVariantStyles({\n    itemFocused: focusBehavior === 'swatch' && isItemFocused ? 'isItemFocused' : 'isNotItemFocused',\n    itemInGridLayout: 'isNotInGridLayout'\n  });\n  const classes = classNames([styles.itemStyle, variantClasses]);\n\n  /*********************************** Tabbable Mode ***********************************/\n\n  // don't bubble Arrow Up/Down/Left/Right events to parent when in isTabbable mode\n  // this bubbling causes the outer CollectionFocus ring to change index while in the isTabbable mode.\n  const handleKeyDown = (event: KeyboardEvent) => {\n    if (\n      focusBehavior === 'swatch' &&\n      isTabbable &&\n      (event.key === 'ArrowDown' ||\n        event.key === 'ArrowUp' ||\n        event.key === 'ArrowLeft' ||\n        event.key === 'ArrowRight')\n    ) {\n      event.stopPropagation();\n    }\n  };\n\n  /************************************ Swatch Size ************************************/\n\n  const handleResize = useCallback(\n    (entry: ResizeObserverEntry) => {\n      updateSwatchSize?.(entry.contentRect.width, entry.contentRect.height);\n    },\n    [updateSwatchSize]\n  );\n\n  const nullRef = useRef<HTMLDivElement>(null);\n  useResizeObserver(updateSwatchSize ? rootRef : nullRef, handleResize);\n\n  /********************************* Focus Behavior *********************************/\n\n  useLayoutEffect(() => {\n    if (focusBehavior === 'content' && isItemFocused) {\n      // rootRef is swatchview item, its first child is the focus trap div, so its first grand child\n      // is the actual content\n      const content = rootRef.current?.firstElementChild?.firstElementChild as HTMLElement;\n      const focusable = allTabbableElements(content, true, true);\n      if (focusable.length === 0 || focusable.length > 1) {\n        warn(\n          `${focusable.length} focusable elements are detected in the swatch. 'content' focusBehavior is intended only for use when the swatch has single focusable element. Please specify one focusable element in the swatch or switch the focusBehavior to 'swatch'.`\n        );\n        setIsFocusBehaviorValid?.(false);\n      } else {\n        focusable[0].focus();\n      }\n    }\n  }, [focusBehavior, isItemFocused, setIsFocusBehaviorValid]);\n\n  const childrenComponent = children(context);\n  return (\n    <div\n      id={useId()}\n      ref={rootRef}\n      class={classes}\n      role=\"gridcell\"\n      data-oj-key={itemKey}\n      onKeyDown={handleKeyDown}\n      {...(typeof itemKey === 'number' && { 'data-oj-key-type': 'number' })}>\n      <TabbableModeContext.Provider value={{ isTabbable }}>\n        <FocusTrap isDisabled={!isTabbable} restoreFocusRef={false}>\n          {childrenComponent}\n        </FocusTrap>\n      </TabbableModeContext.Provider>\n    </div>\n  );\n}\n\nexport const MemoizeBaseSwatchViewItem = memo(\n  BaseSwatchViewItem,\n  <K, D>(prev: Props<K, D>, next: Props<K, D>) => {\n    if (prev && next) {\n      return (\n        prev.children === next.children &&\n        prev.isTabbable === next.isTabbable &&\n        prev.isFocused === next.isFocused &&\n        prev.isFocusRingVisible === next.isFocusRingVisible &&\n        prev.focusBehavior === next.focusBehavior &&\n        compareListItemContext(prev.context, next.context)\n      );\n    }\n    return false;\n  }\n);\n","import { ComponentChildren } from 'preact';\nimport { Flex } from '../UNSAFE_Flex';\nimport { Size } from '../utils/UNSAFE_size';\n\ntype Props = {\n  children: ComponentChildren;\n};\n\nexport function BaseSwatchViewLayout({ children }: Props) {\n  const gap = ['2x' as Size, '2x' as Size] as [Size, Size];\n  return (\n    <Flex wrap=\"wrap\" gap={gap}>\n      {children}\n    </Flex>\n  );\n}\n","export const emptyKeys = { all: false, keys: new Set() };\n\nexport const getColCount = (gapWidth: number, swatchWidth?: number, rootWidth?: number) => {\n  if (!swatchWidth || !rootWidth) return 0;\n\n  // if we have n swatchs, we have n-1 gaps\n  const colCount = Math.floor((rootWidth + gapWidth) / (gapWidth + swatchWidth));\n  return Math.max(1, colCount);\n};\n","/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\nimport { Fragment } from 'preact';\nimport { forwardRef, ForwardedRef } from 'preact/compat';\nimport { useRef, useCallback, useEffect, useState, useImperativeHandle } from 'preact/hooks';\nimport { mergeProps } from '../utils/UNSAFE_mergeProps';\nimport { useTabbableMode } from '#hooks/UNSAFE_useTabbableMode';\nimport { Keys, isKeyDefined } from '../utils/UNSAFE_keys';\nimport {\n  getPrevNextKeyByCount,\n  getFirstVisibleKey,\n  getViewportConfig,\n  findElementByKey,\n  keyExtractor,\n  ITEM_SELECTOR\n} from '../utils/PRIVATE_collectionUtils';\nimport { useCurrentKey } from '../hooks/PRIVATE_useCurrentKey';\nimport { useCollectionFocusRing } from '../hooks/PRIVATE_useCollectionFocusRing';\nimport { useTabbableModeSet } from '../hooks/PRIVATE_useTabbableModeSet';\nimport { useSwatchSelection } from '../hooks/PRIVATE_useSwatchSelection';\nimport { ItemContext, ListItemRendererContext, SelectionDetail } from '../UNSAFE_Collection';\nimport { LoadMoreCollection } from '../PRIVATE_LoadMoreCollection';\nimport { styles } from './themes/BaseSwatchViewStyles.css';\nimport { Props } from '../PRIVATE_SwatchFlexView';\nimport { MemoizeBaseSwatchViewItem } from './BaseSwatchViewItem';\nimport { BaseSwatchViewLayout } from './BaseSwatchViewLayout';\nimport { emptyKeys } from './BaseSwatchViewUtils';\n\n/**\n * Props specific for the GradGridBaseImpl Component\n */\ntype BaseSwatchViewImplProps<K, D> = Props<K, D> & {\n  /**\n   * Provide the number of columns to render;\n   */\n  columns: number;\n  /**\n   * Swatch dimension, including width and height\n   */\n  swatchSize: { width?: number; height?: number };\n  /**\n   * A callback function to update swatch dimension, including width and height\n   */\n  updateSwatchSize: (width: number, height: number) => void;\n};\n\nconst BaseSwatchViewImpl = forwardRef(\n  <K extends string | number, D>(\n    {\n      children,\n      data,\n      onLoadMore = () => {},\n      hasMore = false,\n      getRowKey,\n      currentKey,\n      onCurrentKeyChange,\n      selectedKeys = emptyKeys as Keys<K>,\n      onSelectionChange,\n      viewportConfig,\n      focusBehavior = 'swatch',\n      'aria-label': ariaLabel,\n      'aria-labelledby': ariaLabelledBy,\n      columns,\n      swatchSize,\n      updateSwatchSize\n    }: BaseSwatchViewImplProps<K, D>,\n    ref?: ForwardedRef<HTMLDivElement>\n  ) => {\n    const rootRef = useRef<HTMLDivElement>(null);\n    useImperativeHandle(ref!, () => rootRef.current!, [rootRef]);\n\n    // tracking the anchor key which is used for shift+click selection\n    const anchorKey = useRef<K | undefined>();\n    // tracking pending current key in pointer down event\n    const pendingCurrentKey = useRef<K>();\n\n    const ariaMultiSelectable = 'false';\n    const ariaRowcount = hasMore || !data || columns < 1 ? -1 : Math.ceil(data?.length / columns);\n    const ariaColcount = columns < 1 ? -1 : columns;\n\n    const [isFocusBehaviorValid, setIsFocusBehaviorValid] = useState(true);\n    const validFocusBehavior = isFocusBehaviorValid ? focusBehavior : 'swatch';\n\n    // ensure current item is scrolled into view when current item is updated\n    // during reordering, enable that during keyboard reordering, disable that during mouse reordering\n    const scrollCurrItemIntoView = useRef(false);\n\n    const isFetching = useRef(false);\n\n    /*****************************************************************************************/\n    /************************************* Tabbable Mode *************************************/\n    /*****************************************************************************************/\n\n    const [isCurrentTabbableKey, tabbableModeProps] = useTabbableModeSet(\n      rootRef,\n      (element) => {\n        return keyExtractor(element, ITEM_SELECTOR) as K;\n      },\n      currentKey,\n      onCurrentKeyChange\n    );\n\n    /*****************************************************************************************/\n    /********************************* Current Key and Focus *********************************/\n    /*****************************************************************************************/\n\n    const { currentKeyProps } = useCurrentKey(\n      (element) => keyExtractor(element, ITEM_SELECTOR),\n      true,\n      // init a function every time to make sure we pass in the latest columns,\n      // otherwise the new key might be wrong after resize\n      getPrevNextKeyByCount(data, getRowKey, currentKey, -columns),\n      getPrevNextKeyByCount(data, getRowKey, currentKey, columns),\n      getPrevNextKeyByCount(data, getRowKey, currentKey, -1),\n      getPrevNextKeyByCount(data, getRowKey, currentKey, 1),\n      currentKey,\n      onCurrentKeyChange\n    );\n\n    const [showFocusRing, focusRingProps] = useCollectionFocusRing(rootRef, [\n      'ArrowUp',\n      'ArrowDown',\n      'ArrowLeft',\n      'ArrowRight'\n    ]);\n\n    const handleFocus = () => {\n      // handle initial focus\n      if (\n        !isKeyDefined(currentKey) &&\n        onCurrentKeyChange &&\n        isCurrentTabbableKey(undefined) &&\n        rootRef.current\n      ) {\n        const firstKey =\n          pendingCurrentKey.current || (getFirstVisibleKey(rootRef.current, ITEM_SELECTOR) as K);\n        if (isKeyDefined(firstKey)) {\n          onCurrentKeyChange({ value: firstKey });\n        }\n      }\n    };\n\n    // need to track pointer down element to set currentItem when initial focus happens\n    const handlePointerDown = (event: PointerEvent) => {\n      const key = keyExtractor(event.target as HTMLElement, ITEM_SELECTOR);\n      if (isKeyDefined(key)) {\n        pendingCurrentKey.current = key as K;\n      }\n    };\n\n    const handleKeyDown = (event: KeyboardEvent) => {\n      // for content focusBehavior, when users tab out, we need to focus back to swatch grid, to ensure\n      // the tabbing order works properly, otherwise the focus might get stuck at the current item\n      if (validFocusBehavior === 'content' && event.key === 'Tab') {\n        rootRef.current?.focus({ preventScroll: true });\n      }\n      // during keyboard reordering, the current item should be scrolled into view\n      const keyHandlers = ['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown'];\n      if ((event.metaKey || event.ctrlKey) && event.shiftKey && keyHandlers.includes(event.key)) {\n        scrollCurrItemIntoView.current = true;\n      }\n    };\n\n    useEffect(() => {\n      if (currentKey != null && rootRef.current) {\n        const elem = findElementByKey(rootRef.current, currentKey, ITEM_SELECTOR);\n        if (elem) {\n          // only update aria-activedescendant for screen reader in default focusBehavior\n          if (validFocusBehavior === 'swatch') {\n            const cell = elem.closest(`[role=gridcell]`);\n            const activeDescendant = rootRef.current.getAttribute('aria-activedescendant');\n            if (cell && activeDescendant !== cell.id) {\n              rootRef.current.setAttribute('aria-activedescendant', cell.id);\n              scrollCurrItemIntoView.current = true;\n            }\n          }\n          // make sure current item is visible\n          if (scrollCurrItemIntoView.current) {\n            elem.scrollIntoView({ block: 'nearest' });\n            scrollCurrItemIntoView.current = false;\n          }\n        }\n      }\n      // listen to data because the current item would re-render when data is updated, i.e. the id\n      // of current item would be updated, so the currentKey itself couldn't guarantee the root has\n      // the latest aria-activedescendant\n    }, [currentKey, data, validFocusBehavior]);\n\n    /*****************************************************************************************/\n    /*************************************** Selection ***************************************/\n    /*****************************************************************************************/\n\n    const handleSelectionChange = useCallback(\n      (detail: SelectionDetail<K>) => {\n        if (onSelectionChange) {\n          if (detail.value.all === false && detail.value.keys.size > 0) {\n            // during regular selection, the last key selected by a user gesture is the anchor key\n            anchorKey.current = Array.from(detail.value.keys.values()).pop();\n          }\n          onSelectionChange(detail);\n        }\n      },\n      [anchorKey, onSelectionChange]\n    );\n\n    const { selectionProps } = useSwatchSelection(\n      (element: HTMLElement) => {\n        if (element === rootRef.current) {\n          return currentKey === undefined ? null : currentKey;\n        }\n        return keyExtractor(element, ITEM_SELECTOR) as K;\n      },\n      selectedKeys,\n      false,\n      'toggle',\n      handleSelectionChange\n    );\n\n    /*****************************************************************************************/\n    /************************************* Load More *****************************************/\n    /*****************************************************************************************/\n\n    const handleLoadMore = useCallback(() => {\n      // check isFetching to avoid multiple load more at the same time (details in JET-61117)\n      if (!isFetching.current) {\n        isFetching.current = true;\n        onLoadMore();\n      }\n    }, [isFetching, onLoadMore]);\n\n    useEffect(() => {\n      isFetching.current = false;\n      // listen to data and hasMore because when one of them gets updated, the fetching is done\n    }, [data, hasMore]);\n\n    /*****************************************************************************************/\n    /************************************ Child Component ************************************/\n    /*****************************************************************************************/\n\n    const getItemContext = useCallback(\n      (context: ItemContext<D>) => {\n        const key = getRowKey(context.data);\n\n        return {\n          index: context.index,\n          data: context.data,\n          metadata: { key: key },\n          selector: undefined\n        };\n      },\n      [getRowKey]\n    );\n\n    const childrenComponent = (context: ItemContext<D>) => {\n      const swatchItemContext = getItemContext(context);\n      const isTabbable = isCurrentTabbableKey(swatchItemContext.metadata.key);\n      const isFocused = currentKey === swatchItemContext.metadata.key && !isTabbable;\n      const isFocusRingVisible = isFocused && showFocusRing;\n      const itemRenderFunc = (context: ListItemRendererContext<K, D>) => (\n        <MemoizeBaseSwatchViewItem\n          key={swatchItemContext.metadata.key}\n          context={context}\n          isTabbable={isTabbable}\n          isFocused={isFocused}\n          isFocusRingVisible={isFocusRingVisible}\n          focusBehavior={validFocusBehavior}\n          {...(focusBehavior === 'content' && { setIsFocusBehaviorValid })}\n          {...(swatchItemContext.index === 0 && !swatchSize.width && { updateSwatchSize })}>\n          {children}\n        </MemoizeBaseSwatchViewItem>\n      );\n      return itemRenderFunc(swatchItemContext);\n    };\n\n    const { tabbableModeProps: viewTabbleModeProps } = useTabbableMode();\n\n    viewportConfig = getViewportConfig(rootRef, viewportConfig);\n    const collectionComponent = (\n      <div role=\"row\">\n        <BaseSwatchViewLayout>\n          <LoadMoreCollection\n            data={data}\n            hasMore={hasMore}\n            onLoadMore={handleLoadMore}\n            loadMoreThreshold={12} // gap size + padding 8 + 4\n            viewportConfig={viewportConfig}>\n            {childrenComponent}\n          </LoadMoreCollection>\n        </BaseSwatchViewLayout>\n      </div>\n    );\n\n    return (\n      <div\n        {...mergeProps(\n          currentKeyProps,\n          focusRingProps,\n          viewTabbleModeProps,\n          selectionProps,\n          {\n            onFocus: handleFocus,\n            onPointerDown: handlePointerDown,\n            onKeyDown: handleKeyDown\n          },\n          // only enable tabbable mode in default focusBehavior\n          { ...(validFocusBehavior === 'swatch' && tabbableModeProps) }\n        )}\n        ref={rootRef}\n        role=\"grid\"\n        className={styles.baseStyle}\n        aria-label={ariaLabel}\n        aria-labelledby={ariaLabelledBy}\n        aria-multiselectable={ariaMultiSelectable}\n        aria-rowcount={ariaRowcount}\n        aria-colcount={ariaColcount}>\n        {data?.length || hasMore ? collectionComponent : <Fragment />}\n      </div>\n    );\n  }\n);\n\n/**\n * Props specific for the BaseSwatchView\n */\ntype BaseSwatchViewProps<K, D> = BaseSwatchViewImplProps<K, D> & {\n  ref?: ForwardedRef<HTMLDivElement>;\n};\n\n/**\n * Cast BaseSwatchViewImpl to generic type, because BaseSwatchViewImpl would infer the generic type to specific type,\n * i.e infer <K extends string | number, D> to <string | number, unknown>, which will cause type issues in the parent component\n */\nexport const BaseSwatchView = BaseSwatchViewImpl as <K extends string | number, D>(\n  props: BaseSwatchViewProps<K, D>\n) => JSX.Element;\n"],"names":["_jsx"],"mappings":"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"}
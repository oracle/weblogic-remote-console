{"version":3,"file":"useMenuAction-57d49a9e.js","sources":["../../src/hooks/UNSAFE_useMenuAction/useMenuAction.ts"],"sourcesContent":["import { ComponentProps } from 'preact';\nimport { useState, useCallback } from 'preact/hooks';\nimport { RefObject, ElementRef } from 'preact/compat';\nimport { Menu } from '../../UNSAFE_Menu';\nimport { BaseButton } from '../../UNSAFE_BaseButton';\n\ntype ButtonHandle = ElementRef<typeof BaseButton>;\n\ntype InitialFocusType = ComponentProps<typeof Menu>['initialFocus'];\ntype MenuProps = {\n  isOpen?: ComponentProps<typeof Menu>['isOpen'];\n  anchorRef: ComponentProps<typeof Menu>['anchorRef'];\n  initialFocus?: InitialFocusType;\n  onClose: ComponentProps<typeof Menu>['onClose'];\n};\n\nexport type MenuToggleDetail = {\n  value: boolean;\n};\n\nexport type MenuActionOptions = {\n  isDisabled?: boolean;\n  anchorRef: RefObject<ButtonHandle>;\n  onToggleMenu?: (details: MenuToggleDetail) => void;\n  isMenuOpen?: boolean;\n};\n\nexport type MenuActionReturnType = {\n  triggerProps: Record<string, any>;\n  menuProps: MenuProps;\n};\n\n/**\n * Use to associate a popup menu with a target that supports onAction\n *\n * @returns\n */\nexport function useMenuAction({\n  isDisabled,\n  isMenuOpen,\n  onToggleMenu,\n  anchorRef\n}: MenuActionOptions): MenuActionReturnType {\n  const [initialFocus, setInitialFocus] = useState<InitialFocusType>('menu');\n\n  const handleAction = useCallback<Required<ComponentProps<typeof BaseButton>>['onAction']>(\n    (details) => {\n      if (details.reason === 'keyboard') {\n        setInitialFocus('firstItem');\n      } else {\n        setInitialFocus('menu');\n      }\n\n      onToggleMenu?.({\n        value: !isMenuOpen\n      });\n    },\n    [onToggleMenu, isMenuOpen, setInitialFocus]\n  );\n\n  const handleClose = useCallback<Required<ComponentProps<typeof Menu>>['onClose']>(\n    (detail) => {\n      if (detail.reason === 'anchorClick') {\n        return;\n      }\n\n      //Focus has to be set on the launcher when menu is dismissed or\n      //item is \"selected\"\n      if (detail.reason === 'dismissed' || detail.reason === 'itemAction') {\n        anchorRef.current?.focus();\n      }\n\n      onToggleMenu?.({\n        value: false\n      });\n    },\n    [onToggleMenu, anchorRef]\n  );\n\n  // DOWN ARROW invokes menu\n  const onKeyDown = useCallback(\n    (event: KeyboardEvent) => {\n      if (event.key == 'ArrowDown') {\n        setInitialFocus('firstItem');\n        !isDisabled && onToggleMenu?.({ value: !isMenuOpen });\n        // Prevent page scroll for down arrow, user definitely wanted to show menu in this case.\n        // Don't prevent other keypress defaults, as user may want to hold SPACE down to scroll page.\n        event.preventDefault();\n      }\n    },\n    [isDisabled, isMenuOpen, onToggleMenu]\n  );\n\n  const menuProps = {\n    anchorRef: anchorRef,\n    isOpen: isMenuOpen,\n    onClose: handleClose,\n    initialFocus: initialFocus\n  };\n\n  const triggerProps = isDisabled\n    ? {}\n    : {\n      onAction: handleAction,\n      onKeyDown,\n      'aria-haspopup': 'true',\n      'aria-expanded': isMenuOpen\n    };\n\n  return {\n    triggerProps: triggerProps,\n    menuProps: menuProps\n  };\n}\n"],"names":[],"mappings":";;;AAgCA;;;;AAIG;AACG,SAAU,aAAa,CAAC,EAC5B,UAAU,EACV,UAAU,EACV,YAAY,EACZ,SAAS,EACS,EAAA;IAClB,MAAM,CAAC,YAAY,EAAE,eAAe,CAAC,GAAG,QAAQ,CAAmB,MAAM,CAAC,CAAC;AAE3E,IAAA,MAAM,YAAY,GAAG,WAAW,CAC9B,CAAC,OAAO,KAAI;AACV,QAAA,IAAI,OAAO,CAAC,MAAM,KAAK,UAAU,EAAE;YACjC,eAAe,CAAC,WAAW,CAAC,CAAC;SAC9B;aAAM;YACL,eAAe,CAAC,MAAM,CAAC,CAAC;SACzB;AAED,QAAA,YAAY,GAAG;YACb,KAAK,EAAE,CAAC,UAAU;AACnB,SAAA,CAAC,CAAC;KACJ,EACD,CAAC,YAAY,EAAE,UAAU,EAAE,eAAe,CAAC,CAC5C,CAAC;AAEF,IAAA,MAAM,WAAW,GAAG,WAAW,CAC7B,CAAC,MAAM,KAAI;AACT,QAAA,IAAI,MAAM,CAAC,MAAM,KAAK,aAAa,EAAE;YACnC,OAAO;SACR;;;AAID,QAAA,IAAI,MAAM,CAAC,MAAM,KAAK,WAAW,IAAI,MAAM,CAAC,MAAM,KAAK,YAAY,EAAE;AACnE,YAAA,SAAS,CAAC,OAAO,EAAE,KAAK,EAAE,CAAC;SAC5B;AAED,QAAA,YAAY,GAAG;AACb,YAAA,KAAK,EAAE,KAAK;AACb,SAAA,CAAC,CAAC;AACL,KAAC,EACD,CAAC,YAAY,EAAE,SAAS,CAAC,CAC1B,CAAC;;AAGF,IAAA,MAAM,SAAS,GAAG,WAAW,CAC3B,CAAC,KAAoB,KAAI;AACvB,QAAA,IAAI,KAAK,CAAC,GAAG,IAAI,WAAW,EAAE;YAC5B,eAAe,CAAC,WAAW,CAAC,CAAC;AAC7B,YAAA,CAAC,UAAU,IAAI,YAAY,GAAG,EAAE,KAAK,EAAE,CAAC,UAAU,EAAE,CAAC,CAAC;;;YAGtD,KAAK,CAAC,cAAc,EAAE,CAAC;SACxB;KACF,EACD,CAAC,UAAU,EAAE,UAAU,EAAE,YAAY,CAAC,CACvC,CAAC;AAEF,IAAA,MAAM,SAAS,GAAG;AAChB,QAAA,SAAS,EAAE,SAAS;AACpB,QAAA,MAAM,EAAE,UAAU;AAClB,QAAA,OAAO,EAAE,WAAW;AACpB,QAAA,YAAY,EAAE,YAAY;KAC3B,CAAC;IAEF,MAAM,YAAY,GAAG,UAAU;AAC7B,UAAE,EAAE;AACJ,UAAE;AACA,YAAA,QAAQ,EAAE,YAAY;YACtB,SAAS;AACT,YAAA,eAAe,EAAE,MAAM;AACvB,YAAA,eAAe,EAAE,UAAU;SAC5B,CAAC;IAEJ,OAAO;AACL,QAAA,YAAY,EAAE,YAAY;AAC1B,QAAA,SAAS,EAAE,SAAS;KACrB,CAAC;AACJ;;;;"}
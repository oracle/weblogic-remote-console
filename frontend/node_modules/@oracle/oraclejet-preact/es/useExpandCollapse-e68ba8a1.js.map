{"version":3,"file":"useExpandCollapse-e68ba8a1.js","sources":["../../src/hooks/PRIVATE_useListCommon/useExpandCollapse.ts"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\nimport { useCallback } from 'preact/hooks';\nimport { ToggleDetail } from '#UNSAFE_Collection';\nimport { useUser } from '#hooks/UNSAFE_useUser';\n\n/**\n * A hook that handles mouse and keyboard gesture that toggles the expanded state.\n * @param keyExtractor\n * @param expanded\n * @param onToggle\n * @returns\n */\nexport function useExpandCollapse<K>(\n  keyExtractor: (element: HTMLElement) => K | null,\n  isExpanded: (key: K) => boolean,\n  onToggle?: (detail: ToggleDetail<K>) => void,\n  allowArrowKeysOnly?: boolean\n) {\n  const { direction } = useUser();\n\n  const onClick = useCallback(\n    (event: MouseEvent) => {\n      if (allowArrowKeysOnly !== true && onToggle) {\n        handleToggle(event, keyExtractor, onToggle);\n      }\n    },\n    [keyExtractor, onToggle, allowArrowKeysOnly]\n  );\n\n  const onKeyUp = useCallback(\n    (event: KeyboardEvent) => {\n      if (allowArrowKeysOnly !== true && (event.key === 'Enter' || event.key === ' ')) {\n        handleToggle(event, keyExtractor, onToggle);\n      } else if (event.key === 'ArrowLeft' || event.key === 'ArrowRight') {\n        const isRtl = direction === 'rtl';\n        const isLeftArrow = event.key === 'ArrowLeft' && !isRtl;\n        handleArrowKey(\n          isLeftArrow,\n          event.target as HTMLElement,\n          isExpanded,\n          keyExtractor,\n          onToggle\n        );\n        // arrow key might cause it to scroll horizontally\n        event.preventDefault();\n        event.stopPropagation();\n      }\n    },\n    [keyExtractor, onToggle, isExpanded, direction, allowArrowKeysOnly]\n  );\n\n  // prevent default (propagation) for keyDown to prevent scrolling the container\n  const onKeyDown = useCallback(\n    (event: KeyboardEvent) => {\n      if (allowArrowKeysOnly !== true && (event.key === 'Enter' || event.key === ' ')) {\n        event.preventDefault();\n      } else if (event.key === 'ArrowLeft' || event.key === 'ArrowRight') {\n        event.preventDefault();\n      }\n    },\n    [allowArrowKeysOnly]\n  );\n\n  return onToggle ? { onClick, onKeyDown, onKeyUp } : {};\n}\n\nconst handleArrowKey = <K>(\n  isLeftArrow: boolean,\n  target: HTMLElement,\n  isExpanded: (key: K) => boolean,\n  keyExtractor: (element: HTMLElement) => K | null,\n  onToggle?: (detail: ToggleDetail<K>) => void\n) => {\n  const itemKey = keyExtractor(target);\n  if (onToggle && itemKey) {\n    const contains = isExpanded(itemKey);\n    if ((isLeftArrow && contains) || (!isLeftArrow && !contains)) {\n      onToggle({ value: itemKey });\n    }\n  }\n};\n\nconst handleToggle = <K>(\n  event: Event,\n  keyExtractor: (element: HTMLElement) => K | null,\n  onToggle?: (detail: ToggleDetail<K>) => void\n) => {\n  const itemKey = keyExtractor(event.target as HTMLElement);\n  if (onToggle && itemKey) {\n    onToggle({ value: itemKey });\n    if (event.type === 'click') {\n      event.stopPropagation();\n    }\n  }\n};\n"],"names":[],"mappings":"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"}
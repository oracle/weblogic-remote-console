{"version":3,"file":"useModal-953082f2.js","sources":["../../src/UNSAFE_Modal/hooks/useModal.ts"],"sourcesContent":["import { useRef, useCallback, useEffect } from 'preact/compat';\n\nexport const MODAL_OVERLAY = Symbol.for('oj-modal-overlay');\n\nexport type BackdropElement = HTMLDivElement & {\n  [MODAL_OVERLAY]?: boolean;\n};\n\nexport type UseModalProps = Readonly<{\n  /**\n   * Determines whether the Modal is open.\n   */\n  isOpen: boolean;\n  /**\n   * On backdrop click callback.\n   */\n  onBackdropClick?: (event: MouseEvent) => void;\n}>;\n\n/**\n *\n * @param props\n */\nexport const useModal = (props: UseModalProps) => {\n  const { isOpen, onBackdropClick: onBackdropClickProp } = props;\n\n  const backdropRef = useRef<HTMLDivElement>(null);\n\n  const mouseDownTarget = useRef<EventTarget | null>(null);\n\n  const onMouseDown = useCallback((event: MouseEvent) => {\n    if (backdropRef.current === event.target) {\n      mouseDownTarget.current = event.target;\n    }\n  }, []);\n\n  const onBackdropClick = useCallback(\n    (event: MouseEvent) => {\n      if (backdropRef.current === event.target) {\n        event.stopPropagation();\n        // event should originate on the same target\n        if (mouseDownTarget.current === event.target) {\n          onBackdropClickProp?.(event);\n        }\n      }\n    },\n    [onBackdropClickProp]\n  );\n\n  useEffect(() => {\n    const modal = backdropRef.current as BackdropElement;\n\n    if (modal) {\n      modal.addEventListener('mousedown', onMouseDown);\n      modal.addEventListener('click', onBackdropClick);\n      modal[MODAL_OVERLAY] = true;\n\n      return () => {\n        modal.removeEventListener('mousedown', onMouseDown);\n        modal.removeEventListener('click', onBackdropClick);\n        delete modal[MODAL_OVERLAY];\n      };\n    }\n\n    return () => {};\n  }, [isOpen, onMouseDown, onBackdropClick]);\n\n  return {\n    backdropRef\n  };\n};\n\nexport default useModal;\n"],"names":[],"mappings":";;;AAEa,MAAA,aAAa,GAAG,MAAM,CAAC,GAAG,CAAC,kBAAkB,EAAE;AAiB5D;;;AAGG;AACU,MAAA,QAAQ,GAAG,CAAC,KAAoB,KAAI;IAC/C,MAAM,EAAE,MAAM,EAAE,eAAe,EAAE,mBAAmB,EAAE,GAAG,KAAK,CAAC;AAE/D,IAAA,MAAM,WAAW,GAAG,MAAM,CAAiB,IAAI,CAAC,CAAC;AAEjD,IAAA,MAAM,eAAe,GAAG,MAAM,CAAqB,IAAI,CAAC,CAAC;AAEzD,IAAA,MAAM,WAAW,GAAG,WAAW,CAAC,CAAC,KAAiB,KAAI;QACpD,IAAI,WAAW,CAAC,OAAO,KAAK,KAAK,CAAC,MAAM,EAAE;AACxC,YAAA,eAAe,CAAC,OAAO,GAAG,KAAK,CAAC,MAAM,CAAC;SACxC;KACF,EAAE,EAAE,CAAC,CAAC;AAEP,IAAA,MAAM,eAAe,GAAG,WAAW,CACjC,CAAC,KAAiB,KAAI;QACpB,IAAI,WAAW,CAAC,OAAO,KAAK,KAAK,CAAC,MAAM,EAAE;YACxC,KAAK,CAAC,eAAe,EAAE,CAAC;;YAExB,IAAI,eAAe,CAAC,OAAO,KAAK,KAAK,CAAC,MAAM,EAAE;AAC5C,gBAAA,mBAAmB,GAAG,KAAK,CAAC,CAAC;aAC9B;SACF;AACH,KAAC,EACD,CAAC,mBAAmB,CAAC,CACtB,CAAC;IAEF,SAAS,CAAC,MAAK;AACb,QAAA,MAAM,KAAK,GAAG,WAAW,CAAC,OAA0B,CAAC;QAErD,IAAI,KAAK,EAAE;AACT,YAAA,KAAK,CAAC,gBAAgB,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC;AACjD,YAAA,KAAK,CAAC,gBAAgB,CAAC,OAAO,EAAE,eAAe,CAAC,CAAC;AACjD,YAAA,KAAK,CAAC,aAAa,CAAC,GAAG,IAAI,CAAC;AAE5B,YAAA,OAAO,MAAK;AACV,gBAAA,KAAK,CAAC,mBAAmB,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC;AACpD,gBAAA,KAAK,CAAC,mBAAmB,CAAC,OAAO,EAAE,eAAe,CAAC,CAAC;AACpD,gBAAA,OAAO,KAAK,CAAC,aAAa,CAAC,CAAC;AAC9B,aAAC,CAAC;SACH;AAED,QAAA,OAAO,MAAO,GAAC,CAAC;KACjB,EAAE,CAAC,MAAM,EAAE,WAAW,EAAE,eAAe,CAAC,CAAC,CAAC;IAE3C,OAAO;QACL,WAAW;KACZ,CAAC;AACJ;;;;"}
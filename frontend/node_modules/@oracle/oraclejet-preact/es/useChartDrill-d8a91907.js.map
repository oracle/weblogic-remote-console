{"version":3,"file":"useChartDrill-d8a91907.js","sources":["../../src/hooks/PRIVATE_useChartDrill/useChartDrill.ts"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\nimport type { RefObject } from 'preact';\nimport { useCallback } from 'preact/hooks';\nimport { getInfo } from '#utils/UNSAFE_visUtils';\nimport { ChartGroupInfo, Info, GroupDetail, ItemDetail } from '#utils/UNSAFE_visTypes/chart';\nimport { useVisDrill } from '#hooks/PRIVATE_useVisDrill';\nimport { BarItemData } from '#UNSAFE_BarChart/barChart.types';\nimport { LineAreaItem } from '#UNSAFE_LineAreaChart/lineAreaChart.types';\nimport { ScatterItem } from '#UNSAFE_ScatterChart/scatterChart.types';\nimport { GroupLevelItem } from '#PRIVATE_Axis/groupAxis/hierarchicalUtils';\n\ntype DrillEventsProps<K, D> = {\n  rootRef: RefObject<HTMLDivElement>;\n  levelsArray: GroupLevelItem[][];\n  focusedItemInfo: Info;\n  focusedGroupInfo: ChartGroupInfo;\n  selectionMode: 'none' | 'single' | 'multiple';\n  getDataItem: (seriesIndex: number, groupIndex: number, groupPath: number[]) => D | undefined;\n  drilling: 'on' | 'groupsOnly' | 'off';\n  onItemDrill?: (detail: ItemDetail<K, D>) => void;\n  onGroupDrill?: (detail: GroupDetail) => void;\n};\n\nconst isDrillable = <K, D extends LineAreaItem<K> | ScatterItem<K> | BarItemData<K>>(\n  info: { seriesIndex?: number; groupIndex?: number; levelIndex?: number },\n  drilling: 'on' | 'groupsOnly' | 'off',\n  levelsArray: GroupLevelItem[][],\n  getDataItem: (seriesIndex: number, groupIndex: number, path: number[]) => D | undefined\n) => {\n  const { seriesIndex, groupIndex, levelIndex } = info;\n\n  if (groupIndex === undefined || levelsArray.length < 1) {\n    return false;\n  }\n\n  const groupInfo = levelsArray[levelsArray.length - 1][groupIndex];\n  if (seriesIndex != null) {\n    const itemDrilling = getDataItem(seriesIndex, groupIndex, groupInfo.path)?.drilling != 'off';\n    return drilling === 'on' && itemDrilling;\n  } else if (levelIndex !== undefined) {\n    return levelsArray[levelIndex][groupIndex].item.drilling != 'off';\n  }\n\n  return false;\n};\n\n/**\n * Returns the event handlers for drill support.\n */\nexport function useChartDrill<K, D extends LineAreaItem<K> | ScatterItem<K> | BarItemData<K>>({\n  rootRef,\n  focusedItemInfo,\n  focusedGroupInfo,\n  levelsArray,\n  selectionMode,\n  drilling,\n  getDataItem,\n  onItemDrill,\n  onGroupDrill\n}: DrillEventsProps<K, D>) {\n  const processDrill = useCallback(\n    (info?: { seriesIndex?: number; groupIndex?: number; levelIndex?: number }) => {\n      if (\n        !info ||\n        info.groupIndex == undefined ||\n        !isDrillable(info, drilling, levelsArray, getDataItem)\n      ) {\n        return;\n      }\n\n      const { seriesIndex, groupIndex, levelIndex } = info;\n      const groupInfo =\n        levelsArray[levelIndex != undefined ? levelIndex : levelsArray.length - 1][groupIndex];\n      if (seriesIndex != null) {\n        const data = getDataItem(seriesIndex, groupIndex, groupInfo.path);\n        if (data) {\n          onItemDrill?.({\n            groupIndex,\n            seriesIndex,\n            data,\n            id: data?.id,\n            groupPath: groupInfo.path\n          });\n        }\n      } else {\n        onGroupDrill?.({\n          groupIndex,\n          group: groupInfo.item,\n          id: groupInfo.item.id,\n          groupPath: groupInfo.path\n        });\n      }\n    },\n    [drilling, getDataItem, onGroupDrill, onItemDrill, levelsArray]\n  );\n\n  const onDrill = useCallback(\n    (event: Event) => {\n      if (event.type === 'keydown') {\n        const focusedInfo = focusedItemInfo.isCurrent ? focusedItemInfo : focusedGroupInfo;\n        processDrill(focusedInfo);\n      } else {\n        processDrill(getInfo(rootRef, event.target as HTMLElement));\n      }\n    },\n    [rootRef, focusedItemInfo, focusedGroupInfo, processDrill]\n  );\n\n  return useVisDrill(selectionMode, onDrill);\n}\n"],"names":[],"mappings":"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"}
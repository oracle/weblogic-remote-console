{"version":3,"file":"useOutsideClick-73a51e1d.js","sources":["../../src/hooks/UNSAFE_useOutsideClick/useOutsideClick.ts"],"sourcesContent":["/**\n * `useClickOutside` hook for capturing clicking outside of an element\n */\nimport type { RefObject } from 'preact';\nimport { useEffect, useRef } from 'preact/hooks';\nimport { coerceArray } from '../../utils/UNSAFE_arrayUtils';\nimport { LOGICAL_PARENT } from '../../UNSAFE_Layer/Layer';\nimport { MODAL_OVERLAY, BackdropElement } from '#UNSAFE_Modal/hooks/useModal';\n\ntype Props = {\n  /**\n   * If true outside click is disabled\n   */\n  isDisabled?: boolean;\n  /**\n   * Reference to element or array of elements relative to which outside click is performed\n   */\n  ref: RefObject<HTMLElement> | RefObject<HTMLElement>[];\n  /**\n   * Outside click callback\n   */\n  handler?: (event: MouseEvent) => void;\n};\n\n/**\n * Checks if the mouse event target is inside of any of the specified containers, or if it\n * occurs in a layer whose 'logicalParent' belongs to one of the containers.\n *\n * @param event a mouse event associated with the potential \"outside click\" action\n * @param ref an array of references to elements that are considered \"inside\"\n * @returns 'true' if the event occurs \"outside\" of the specified list of containers\n */\nconst isPointOutside = (event: Event, ref: RefObject<HTMLElement>[]) => {\n  const target = event.target as HTMLElement;\n\n  // if the event has no target, consider it \"inside\"\n  if (!target) {\n    return false;\n  }\n\n  const doc = getDocument(target);\n  if (!doc.contains(target)) {\n    return false;\n  }\n\n  // if the target is contained in any of the target containers, it is not \"outside\"\n  if (ref.some((elRef: RefObject<HTMLElement>) => elRef.current?.contains(target))) {\n    return false;\n  }\n\n  const findLogicalParent = (elem: Element): Element | null => {\n    let elemParent = elem.parentElement as any;\n    while (elemParent) {\n      if (elemParent[LOGICAL_PARENT]) {\n        return elemParent[LOGICAL_PARENT];\n      }\n      elemParent = elemParent.parentElement;\n    }\n    return null;\n  };\n\n  const parentLayerContainsTarget = (element: HTMLElement | null, target: Node): boolean => {\n    const parentLayer = element?.closest('[data-oj-layer]');\n    if (parentLayer && parentLayer.contains(target)) {\n      return true;\n    }\n    return false;\n  };\n\n  // Check if the target is logically owned by any of the refs\n  let logicalParent = findLogicalParent(target);\n  while (logicalParent) {\n    if (ref.some((elRef: RefObject<HTMLElement>) => elRef.current?.contains(logicalParent))) {\n      return false;\n    }\n    logicalParent = findLogicalParent(logicalParent);\n  }\n\n  // if the click target is a modal overlay and it is part of target's modal layer\n  // then it's an outside click. Otherwise, treat the click as an \"inside\" click because\n  // it is a click on another modal overlay which must be above our elem\n  if ((target as BackdropElement)[MODAL_OVERLAY]) {\n    if (\n      !ref.some((elRef: RefObject<HTMLElement>) => {\n        const modalParent = elRef.current?.closest('[data-oj-layer=\"modal\"]');\n        return modalParent && modalParent.contains(target);\n      })\n    ) {\n      return false;\n    } else {\n      return true;\n    }\n  }\n\n  // if the target is a child of a modal layer other than any of the refs,\n  // the click occurs in another modal layer which must be above our elem\n  const modalParent = target.closest('[data-oj-layer=\"modal\"]');\n  if (\n    modalParent &&\n    !ref.some((elRef: RefObject<HTMLElement>) => modalParent.contains(elRef.current))\n  ) {\n    return false;\n  }\n\n  // lastly, look for target's parent based purely on the layer hierarchy\n  if (\n    ref.some((elRef: RefObject<HTMLElement>) => parentLayerContainsTarget(elRef.current, target))\n  ) {\n    return false;\n  }\n\n  return true;\n};\n\nconst getDocument = (node?: Node): Document => node?.ownerDocument ?? document;\n\nexport const useOutsideClick = ({ isDisabled: disabled = false, ref, handler }: Props) => {\n  // use ref to store mutable data and not cause a re-render\n  const mouseDownTargetRef = useRef<EventTarget | null>(null);\n\n  useEffect(() => {\n    const refs = coerceArray(ref);\n    if (\n      !handler ||\n      disabled ||\n      (refs.length > 0 && refs.findIndex((elRef) => elRef.current === null) > -1)\n    )\n      return;\n    const onMouseDown = (event: MouseEvent) => {\n      mouseDownTargetRef.current = event.target;\n    };\n\n    const onMouseUp = (event: MouseEvent) => {\n      if (mouseDownTargetRef.current === event.target && isPointOutside(event, refs)) {\n        handler?.(event);\n      }\n      mouseDownTargetRef.current = null;\n    };\n    const firstElRef = refs[0];\n    const doc = getDocument(firstElRef.current!);\n    if (doc) {\n      doc.addEventListener('mousedown', onMouseDown, true);\n      doc.addEventListener('mouseup', onMouseUp, true);\n\n      return () => {\n        doc.removeEventListener('mousedown', onMouseDown, true);\n        doc.removeEventListener('mouseup', onMouseUp, true);\n      };\n    }\n    return undefined;\n  }, [disabled, handler, ref]);\n};\n"],"names":[],"mappings":";;;;;;AAwBA;;;;;;;AAOG;AACH,MAAM,cAAc,GAAG,CAAC,KAAY,EAAE,GAA6B,KAAI;AACrE,IAAA,MAAM,MAAM,GAAG,KAAK,CAAC,MAAqB,CAAC;;IAG3C,IAAI,CAAC,MAAM,EAAE;AACX,QAAA,OAAO,KAAK,CAAC;KACd;AAED,IAAA,MAAM,GAAG,GAAG,WAAW,CAAC,MAAM,CAAC,CAAC;IAChC,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;AACzB,QAAA,OAAO,KAAK,CAAC;KACd;;AAGD,IAAA,IAAI,GAAG,CAAC,IAAI,CAAC,CAAC,KAA6B,KAAK,KAAK,CAAC,OAAO,EAAE,QAAQ,CAAC,MAAM,CAAC,CAAC,EAAE;AAChF,QAAA,OAAO,KAAK,CAAC;KACd;AAED,IAAA,MAAM,iBAAiB,GAAG,CAAC,IAAa,KAAoB;AAC1D,QAAA,IAAI,UAAU,GAAG,IAAI,CAAC,aAAoB,CAAC;QAC3C,OAAO,UAAU,EAAE;AACjB,YAAA,IAAI,UAAU,CAAC,cAAc,CAAC,EAAE;AAC9B,gBAAA,OAAO,UAAU,CAAC,cAAc,CAAC,CAAC;aACnC;AACD,YAAA,UAAU,GAAG,UAAU,CAAC,aAAa,CAAC;SACvC;AACD,QAAA,OAAO,IAAI,CAAC;AACd,KAAC,CAAC;AAEF,IAAA,MAAM,yBAAyB,GAAG,CAAC,OAA2B,EAAE,MAAY,KAAa;QACvF,MAAM,WAAW,GAAG,OAAO,EAAE,OAAO,CAAC,iBAAiB,CAAC,CAAC;QACxD,IAAI,WAAW,IAAI,WAAW,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;AAC/C,YAAA,OAAO,IAAI,CAAC;SACb;AACD,QAAA,OAAO,KAAK,CAAC;AACf,KAAC,CAAC;;AAGF,IAAA,IAAI,aAAa,GAAG,iBAAiB,CAAC,MAAM,CAAC,CAAC;IAC9C,OAAO,aAAa,EAAE;AACpB,QAAA,IAAI,GAAG,CAAC,IAAI,CAAC,CAAC,KAA6B,KAAK,KAAK,CAAC,OAAO,EAAE,QAAQ,CAAC,aAAa,CAAC,CAAC,EAAE;AACvF,YAAA,OAAO,KAAK,CAAC;SACd;AACD,QAAA,aAAa,GAAG,iBAAiB,CAAC,aAAa,CAAC,CAAC;KAClD;;;;AAKD,IAAA,IAAK,MAA0B,CAAC,aAAa,CAAC,EAAE;QAC9C,IACE,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,KAA6B,KAAI;YAC1C,MAAM,WAAW,GAAG,KAAK,CAAC,OAAO,EAAE,OAAO,CAAC,yBAAyB,CAAC,CAAC;YACtE,OAAO,WAAW,IAAI,WAAW,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;SACpD,CAAC,EACF;AACA,YAAA,OAAO,KAAK,CAAC;SACd;aAAM;AACL,YAAA,OAAO,IAAI,CAAC;SACb;KACF;;;IAID,MAAM,WAAW,GAAG,MAAM,CAAC,OAAO,CAAC,yBAAyB,CAAC,CAAC;AAC9D,IAAA,IACE,WAAW;AACX,QAAA,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,KAA6B,KAAK,WAAW,CAAC,QAAQ,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,EACjF;AACA,QAAA,OAAO,KAAK,CAAC;KACd;;AAGD,IAAA,IACE,GAAG,CAAC,IAAI,CAAC,CAAC,KAA6B,KAAK,yBAAyB,CAAC,KAAK,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC,EAC7F;AACA,QAAA,OAAO,KAAK,CAAC;KACd;AAED,IAAA,OAAO,IAAI,CAAC;AACd,CAAC,CAAC;AAEF,MAAM,WAAW,GAAG,CAAC,IAAW,KAAe,IAAI,EAAE,aAAa,IAAI,QAAQ,CAAC;AAElE,MAAA,eAAe,GAAG,CAAC,EAAE,UAAU,EAAE,QAAQ,GAAG,KAAK,EAAE,GAAG,EAAE,OAAO,EAAS,KAAI;;AAEvF,IAAA,MAAM,kBAAkB,GAAG,MAAM,CAAqB,IAAI,CAAC,CAAC;IAE5D,SAAS,CAAC,MAAK;AACb,QAAA,MAAM,IAAI,GAAG,WAAW,CAAC,GAAG,CAAC,CAAC;AAC9B,QAAA,IACE,CAAC,OAAO;YACR,QAAQ;aACP,IAAI,CAAC,MAAM,GAAG,CAAC,IAAI,IAAI,CAAC,SAAS,CAAC,CAAC,KAAK,KAAK,KAAK,CAAC,OAAO,KAAK,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;YAE3E,OAAO;AACT,QAAA,MAAM,WAAW,GAAG,CAAC,KAAiB,KAAI;AACxC,YAAA,kBAAkB,CAAC,OAAO,GAAG,KAAK,CAAC,MAAM,CAAC;AAC5C,SAAC,CAAC;AAEF,QAAA,MAAM,SAAS,GAAG,CAAC,KAAiB,KAAI;AACtC,YAAA,IAAI,kBAAkB,CAAC,OAAO,KAAK,KAAK,CAAC,MAAM,IAAI,cAAc,CAAC,KAAK,EAAE,IAAI,CAAC,EAAE;AAC9E,gBAAA,OAAO,GAAG,KAAK,CAAC,CAAC;aAClB;AACD,YAAA,kBAAkB,CAAC,OAAO,GAAG,IAAI,CAAC;AACpC,SAAC,CAAC;AACF,QAAA,MAAM,UAAU,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;QAC3B,MAAM,GAAG,GAAG,WAAW,CAAC,UAAU,CAAC,OAAQ,CAAC,CAAC;QAC7C,IAAI,GAAG,EAAE;YACP,GAAG,CAAC,gBAAgB,CAAC,WAAW,EAAE,WAAW,EAAE,IAAI,CAAC,CAAC;YACrD,GAAG,CAAC,gBAAgB,CAAC,SAAS,EAAE,SAAS,EAAE,IAAI,CAAC,CAAC;AAEjD,YAAA,OAAO,MAAK;gBACV,GAAG,CAAC,mBAAmB,CAAC,WAAW,EAAE,WAAW,EAAE,IAAI,CAAC,CAAC;gBACxD,GAAG,CAAC,mBAAmB,CAAC,SAAS,EAAE,SAAS,EAAE,IAAI,CAAC,CAAC;AACtD,aAAC,CAAC;SACH;AACD,QAAA,OAAO,SAAS,CAAC;KAClB,EAAE,CAAC,QAAQ,EAAE,OAAO,EAAE,GAAG,CAAC,CAAC,CAAC;AAC/B;;;;"}
{"version":3,"file":"tabBarUtils-9483d091.js","sources":["../../src/utils/PRIVATE_tabBarUtils/tabBarUtils.ts"],"sourcesContent":["import { MutableRef } from 'preact/hooks';\nimport { getKey } from '../PRIVATE_collectionUtils';\n\nexport type TrailingContentInfo = {\n  badge?: string | null;\n  metadata?: string | null;\n  contentWidth: number;\n};\n\nconst ITEM_SELECTOR = '[role=\"tab\"]';\nconst LABEL_MIN_WIDTH = 96;\nconst TAB_BORDER = 6;\n//This is the minWidth a tab will have if it has only a label.\nconst TAB_MIN_WIDTH = LABEL_MIN_WIDTH + TAB_BORDER;\n\nconst getTrailingContentInfo = (elem: HTMLElement, cache: TrailingContentInfo) => {\n  let trailingContentWidth = 0;\n  const hasSeverity = elem.querySelector('[data-oj-tab-severity]') !== null;\n  //A tab can have only one type of trailing content i.e either badge or metadata or severity so we would calculate only for one of them\n  let badge, metadata;\n  if (hasSeverity) {\n    trailingContentWidth = 20;\n  } else {\n    const badgeElem = elem.querySelector('[data-oj-tab-badge]');\n    if (badgeElem) {\n      badge = badgeElem.getAttribute('data-oj-tab-badge');\n      trailingContentWidth = badge === cache.badge ? cache.contentWidth : badgeElem.clientWidth;\n    } else {\n      const metadataElem = elem.querySelector('[data-oj-tab-metadata]');\n      if (metadataElem) {\n        metadata = metadataElem.getAttribute('data-oj-tab-metadata');\n        trailingContentWidth =\n          metadata === cache.metadata ? cache.contentWidth : metadataElem.clientWidth;\n      }\n    }\n  }\n  return { badge, metadata, contentWidth: trailingContentWidth };\n};\nconst getNonTextWidth = (elem: HTMLElement, trailingContentWidth: number, isLastKey: boolean) => {\n  const tabBarItemBorder = 6;\n  //Gap between one item and it's adjacent neighbor also account's for an item's non text width with the exception of last item.\n  const gapBetweenItems = isLastKey ? 0 : 32;\n  //Gap between each content within the item, example gap between metadata and label.\n  const gapBetweenItemContent = 8;\n  const hasIcon = elem.querySelector('[data-oj-tab-icon]') !== null;\n  const iconWidth = hasIcon ? 20 + gapBetweenItemContent : 0;\n  const isRemovable = elem.querySelector('[data-oj-tabbar-item-remove-icon]') !== null;\n  const removeIconWidth = isRemovable ? 24 + gapBetweenItemContent : 0;\n  const nonTextWidth =\n    tabBarItemBorder +\n    iconWidth +\n    removeIconWidth +\n    (trailingContentWidth > 0 ? trailingContentWidth + gapBetweenItemContent + gapBetweenItems : 0);\n  return nonTextWidth;\n};\n\nexport const getTabWidths = <K extends string | number>(\n  container: HTMLDivElement,\n  trailingContentWidths: MutableRef<Map<K, TrailingContentInfo>>,\n  isTruncationDisabled: boolean,\n  tabBarWidth: number,\n  isAllItemsTruncatedMax?: boolean,\n  keysArray?: K[]\n) => {\n  let sumofItemsWidth = 0;\n  const tabWidths: {\n    key: K;\n    maxWidth: number;\n    cumulativeWidth: number;\n    nonTextWidth?: number;\n    needsTruncation?: boolean;\n    hasReachedLimit?: boolean;\n  }[] = Array.from(container.querySelectorAll(ITEM_SELECTOR)).map((elem) => {\n    const maxWidth = (elem as HTMLElement).offsetWidth;\n    const hasReachedLimit = maxWidth <= LABEL_MIN_WIDTH ? true : false;\n    const itemKey = getKey(elem as HTMLElement) as K;\n    const cacheInfo = trailingContentWidths?.current?.get(itemKey);\n    const trailingContentInfo = getTrailingContentInfo(\n      elem as HTMLElement,\n      cacheInfo ? cacheInfo : { contentWidth: 0 }\n    );\n    trailingContentWidths.current.set(itemKey, trailingContentInfo);\n    const isLastKey =\n      keysArray && itemKey === (keysArray[keysArray.length - 1] as string | number) ? true : false;\n    const nonTextWidth = getNonTextWidth(\n      elem as HTMLElement,\n      trailingContentInfo.contentWidth,\n      isLastKey\n    );\n    sumofItemsWidth += Math.max(96, maxWidth) + nonTextWidth;\n    return {\n      key: itemKey,\n      maxWidth: maxWidth,\n      nonTextWidth: nonTextWidth,\n      cumulativeWidth: sumofItemsWidth,\n      hasReachedLimit: hasReachedLimit\n    };\n  });\n  //If all items have reached max treshold of truncation then we do not have to re-calculate or re-distribute any width\n  if (tabWidths.length > 0 && !isTruncationDisabled && !isAllItemsTruncatedMax) {\n    const gap = (tabWidths.length - 1) * 32;\n    const avgWidth = (tabBarWidth - gap) / tabWidths.length;\n    let extraWidth = 0;\n    const wideTabIndex: number[] = [];\n    tabWidths.forEach((record, index) => {\n      //If an item has reached max treshold of truncation then we do not have to re-calculate or re-distribute any width\n      if (!record.hasReachedLimit) {\n        if (record.maxWidth <= avgWidth) {\n          extraWidth = extraWidth + (avgWidth - record.maxWidth);\n        } else {\n          wideTabIndex.push(index);\n        }\n        record.maxWidth = avgWidth;\n      }\n    });\n    if (wideTabIndex.length > 0 && extraWidth > 0) {\n      const distributeWidth = extraWidth / wideTabIndex.length;\n      wideTabIndex.forEach((index) => {\n        //If an item has reached max treshold of truncation then we do not have to re-calculate or re-distribute any width\n        if (!tabWidths[index].hasReachedLimit) {\n          tabWidths[index].maxWidth += distributeWidth;\n          //The hook should add distributed width to the wide tab item's cumulativeWidth\n          tabWidths[index].cumulativeWidth += distributeWidth!;\n          //The hook should return the maximumWidth label can have accounting for non text content as well\n          tabWidths[index].maxWidth -= tabWidths[index].nonTextWidth!;\n        }\n        //If the maximum width is lesser than threshold of truncation i.e 96px + tab's border then reset maxWidth to that and none of the tabs need truncation\n        if (tabWidths[index].maxWidth <= TAB_MIN_WIDTH) {\n          tabWidths[index].needsTruncation = false;\n          tabWidths[index].maxWidth = TAB_MIN_WIDTH;\n        }\n      });\n    }\n  }\n  return tabWidths;\n};\n\n/**\n * Provides the reordered keys and reference item position after performing the move operation\n */\nexport const handleMove = <K extends string | number>(\n  moveDirection: 'forward' | 'backward',\n  tabKeys: K[],\n  itemKey: K\n) => {\n  const newArray = [...tabKeys];\n  const currentItemIndex = newArray.indexOf(itemKey);\n  let referenceItemIndex;\n  if (moveDirection === 'forward') {\n    referenceItemIndex = currentItemIndex + 1;\n    newArray.splice(currentItemIndex, 1);\n    newArray.splice(referenceItemIndex as number, 0, itemKey);\n  } else {\n    referenceItemIndex = currentItemIndex - 1;\n    newArray.splice(currentItemIndex, 1);\n    newArray.splice(referenceItemIndex as number, 0, itemKey);\n  }\n  return {\n    newArray,\n    referenceItemIndex\n  };\n};\n"],"names":[],"mappings":"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"}
{"version":3,"file":"useProgressiveTruncation-ec2227b1.js","sources":["../../src/UNSAFE_TabBarCommon/useProgressiveTruncation.ts"],"sourcesContent":["import type { RefObject } from 'preact';\nimport { useCallback, useLayoutEffect, useState, useRef, StateUpdater } from 'preact/hooks';\nimport { useResizeObserver } from '../hooks/UNSAFE_useResizeObserver';\nimport { Size } from '../utils/UNSAFE_size';\nimport { getTabWidths } from '../utils/PRIVATE_tabBarUtils';\nimport type { TrailingContentInfo } from '../utils/PRIVATE_tabBarUtils';\n\ntype ProgressiveTruncationProps = {\n  rootRef: RefObject<HTMLDivElement>;\n  isDisabled?: boolean;\n};\n\nexport const useProgressiveTruncation = <K extends string | number>({\n  rootRef,\n  isDisabled = false\n}: ProgressiveTruncationProps) => {\n  const trailingContentWidths = useRef(new Map<K, TrailingContentInfo>());\n  const [tabMaxWidth, setTabMaxWidth] = useState<Map<K, Size>>();\n  const [tabBarWidth, setTabBarWidth] = useState<number>(0);\n\n  useLayoutEffect(() => {\n    if (tabMaxWidth == undefined && rootRef && rootRef.current && !isDisabled) {\n      const isOverflow = tabBarWidth < rootRef.current.scrollWidth;\n      if (!isOverflow) {\n        return;\n      }\n      const tabWidths = getTabWidths(\n        rootRef.current,\n        trailingContentWidths,\n        isDisabled,\n        tabBarWidth,\n        false\n      );\n\n      const tabMaxWidthMap = new Map(\n        tabWidths.map((tab) => [tab.key, (tab.maxWidth + 'px') as Size])\n      );\n      setTabMaxWidth(tabMaxWidthMap);\n    }\n  }, [tabBarWidth, tabMaxWidth, isDisabled, rootRef]);\n\n  const getTabBarMaxWidth = useCallback(\n    (entry: { contentRect: { width: StateUpdater<number> } }) => {\n      if (tabBarWidth !== entry.contentRect.width) {\n        setTabBarWidth(entry.contentRect.width);\n        if (tabMaxWidth !== undefined) {\n          setTabMaxWidth(undefined);\n        }\n      }\n    },\n    [tabMaxWidth, tabBarWidth]\n  );\n  useResizeObserver(rootRef, getTabBarMaxWidth, { isDisabled: isDisabled });\n  return {\n    maxWidths: tabMaxWidth\n  };\n};\n"],"names":[],"mappings":";;;;;AAYO,MAAM,wBAAwB,GAAG,CAA4B,EAClE,OAAO,EACP,UAAU,GAAG,KAAK,EACS,KAAI;IAC/B,MAAM,qBAAqB,GAAG,MAAM,CAAC,IAAI,GAAG,EAA0B,CAAC,CAAC;IACxE,MAAM,CAAC,WAAW,EAAE,cAAc,CAAC,GAAG,QAAQ,EAAgB,CAAC;IAC/D,MAAM,CAAC,WAAW,EAAE,cAAc,CAAC,GAAG,QAAQ,CAAS,CAAC,CAAC,CAAC;IAE1D,eAAe,CAAC,MAAK;AACnB,QAAA,IAAI,WAAW,IAAI,SAAS,IAAI,OAAO,IAAI,OAAO,CAAC,OAAO,IAAI,CAAC,UAAU,EAAE;YACzE,MAAM,UAAU,GAAG,WAAW,GAAG,OAAO,CAAC,OAAO,CAAC,WAAW,CAAC;YAC7D,IAAI,CAAC,UAAU,EAAE;gBACf,OAAO;aACR;AACD,YAAA,MAAM,SAAS,GAAG,YAAY,CAC5B,OAAO,CAAC,OAAO,EACf,qBAAqB,EACrB,UAAU,EACV,WAAW,EACX,KAAK,CACN,CAAC;AAEF,YAAA,MAAM,cAAc,GAAG,IAAI,GAAG,CAC5B,SAAS,CAAC,GAAG,CAAC,CAAC,GAAG,KAAK,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,CAAC,QAAQ,GAAG,IAAI,EAAU,CAAC,CACjE,CAAC;YACF,cAAc,CAAC,cAAc,CAAC,CAAC;SAChC;KACF,EAAE,CAAC,WAAW,EAAE,WAAW,EAAE,UAAU,EAAE,OAAO,CAAC,CAAC,CAAC;AAEpD,IAAA,MAAM,iBAAiB,GAAG,WAAW,CACnC,CAAC,KAAuD,KAAI;QAC1D,IAAI,WAAW,KAAK,KAAK,CAAC,WAAW,CAAC,KAAK,EAAE;AAC3C,YAAA,cAAc,CAAC,KAAK,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;AACxC,YAAA,IAAI,WAAW,KAAK,SAAS,EAAE;gBAC7B,cAAc,CAAC,SAAS,CAAC,CAAC;aAC3B;SACF;AACH,KAAC,EACD,CAAC,WAAW,EAAE,WAAW,CAAC,CAC3B,CAAC;IACF,iBAAiB,CAAC,OAAO,EAAE,iBAAiB,EAAE,EAAE,UAAU,EAAE,UAAU,EAAE,CAAC,CAAC;IAC1E,OAAO;AACL,QAAA,SAAS,EAAE,WAAW;KACvB,CAAC;AACJ;;;;"}
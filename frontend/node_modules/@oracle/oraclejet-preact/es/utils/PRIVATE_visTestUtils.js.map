{"version":3,"file":"PRIVATE_visTestUtils.js","sources":["../../../src/utils/PRIVATE_visTestUtils/tabbableUtils.tsx","../../../src/utils/PRIVATE_visTestUtils/domUtil.ts","../../../src/utils/PRIVATE_visTestUtils/eventUtils.ts","../../../src/UNSAFE_Menu/__tests__/menuTestsUtils.ts","../../../src/utils/PRIVATE_visTestUtils/contextMenuUtils.ts"],"sourcesContent":["import { render } from '@testing-library/preact';\nimport { matchTranslationBundle } from '../UNSAFE_matchTranslationBundle';\nimport { RootEnvironmentProvider } from '../../UNSAFE_Environment';\nimport type { RootEnvironment } from '../../UNSAFE_Environment';\nimport { TabbableModeContext } from '../../hooks/UNSAFE_useTabbableMode';\nimport { JSXInternal } from 'preact/src/jsx';\n\nexport const setupTabbableComponent = async (\n  component: JSXInternal.Element,\n  isTabbable?: boolean\n) => {\n  const locale = matchTranslationBundle(['en'], new Set(['en-US', 'en']));\n  const { default: translations } = await import(`../../resources/nls/${locale}/bundle.ts`);\n  const env: Partial<RootEnvironment> = {\n    translations: { '@oracle/oraclejet-preact': translations }\n  };\n  if (isTabbable !== undefined) {\n    return render(\n      <RootEnvironmentProvider environment={env}>\n        <TabbableModeContext.Provider value={{ isTabbable: isTabbable }}>\n          {component}\n        </TabbableModeContext.Provider>\n      </RootEnvironmentProvider>\n    );\n  } else {\n    return render(<RootEnvironmentProvider environment={env}>{component}</RootEnvironmentProvider>);\n  }\n};\n","/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { queryAllByAttribute, queryByAttribute } from '@testing-library/preact';\nimport { expect } from 'chai';\n\nexport const queryById = queryByAttribute.bind(null, 'id');\n\nexport function queryAllBy(attribute: string) {\n  return queryAllByAttribute.bind(null, attribute);\n}\nexport const queryByItemIndex = queryByAttribute.bind(null, 'data-oj-private-item-index');\n\nexport function checkTooltipText(content: string) {\n  const targetElements = document.querySelectorAll('[role=\"tooltip\"]');\n  const targetElementItem = targetElements.item(0) as HTMLElement;\n  const tooltipContainer = targetElementItem?.firstElementChild as HTMLElement;\n  expect(tooltipContainer?.style.opacity).not.equals('');\n  expect(tooltipContainer?.style.opacity).not.equals('0');\n  expect(tooltipContainer?.style.maxHeight).not.equals('');\n  expect(tooltipContainer?.style.maxHeight).not.equals('0');\n  const innerHTML = tooltipContainer?.firstElementChild?.innerHTML;\n  expect(innerHTML).equals(content);\n}\n","/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\ninterface MouseEventDescriptors {\n  originalPageXDescriptor?: PropertyDescriptor;\n  originalPageYDescriptor?: PropertyDescriptor;\n  originalOffsetXDescriptor?: PropertyDescriptor;\n  originalOffsetYDescriptor?: PropertyDescriptor;\n}\n\n/**\n * Mocks the `pageX`, `pageY`, `offsetX`, and `offsetY` properties on the `MouseEvent.prototype`\n * for testing purposes (e.g. for when using userEvent.pointer)\n * See workaround in https://github.com/testing-library/user-event/issues/1037#issuecomment-1576780336\n * that this is based on.\n *\n * This function saves the original property descriptors, then redefines `pageX`, `pageY`, `offsetX`, and `offsetY`\n * to return the values of `clientX` and `clientY`. This allows tests to interact with these properties.\n * This function should be called in beforeEach of tests.\n *\n * @returns An object containing the original property descriptors, which should\n *          be used later to restore the original behavior.\n */\nexport function mockMouseEventPageXYOffsetXY() {\n  const originalPageXDescriptor = Object.getOwnPropertyDescriptor(MouseEvent.prototype, 'pageX');\n  const originalPageYDescriptor = Object.getOwnPropertyDescriptor(MouseEvent.prototype, 'pageY');\n  const originalOffsetXDescriptor = Object.getOwnPropertyDescriptor(\n    MouseEvent.prototype,\n    'offsetX'\n  );\n  const originalOffsetYDescriptor = Object.getOwnPropertyDescriptor(\n    MouseEvent.prototype,\n    'offsetY'\n  );\n\n  Object.defineProperties(MouseEvent.prototype, {\n    pageX: {\n      configurable: true,\n      get() {\n        return this.clientX;\n      }\n    },\n    pageY: {\n      configurable: true,\n      get() {\n        return this.clientY;\n      }\n    },\n    offsetX: {\n      configurable: true,\n      get() {\n        return this.clientX;\n      }\n    },\n    offsetY: {\n      configurable: true,\n      get() {\n        return this.clientY;\n      }\n    }\n  });\n\n  return {\n    originalPageXDescriptor,\n    originalPageYDescriptor,\n    originalOffsetXDescriptor,\n    originalOffsetYDescriptor\n  };\n}\n\n/**\n * Restores the original `pageX`, `pageY`, `offsetX`, and `offsetY` property descriptors on the `MouseEvent.prototype`.\n *\n * This function should be called afterEach of tests to ensure that the `MouseEvent.prototype` is returned to its\n * original state.\n *\n * @param descriptors The output of mockMouseEventPageXYOffsetXY\n */\nexport function restoreMouseEventPageXYOffsetXY(descriptors: MouseEventDescriptors) {\n  const {\n    originalPageXDescriptor,\n    originalPageYDescriptor,\n    originalOffsetXDescriptor,\n    originalOffsetYDescriptor\n  } = descriptors;\n  if (originalPageXDescriptor) {\n    Object.defineProperty(MouseEvent.prototype, 'pageX', originalPageXDescriptor);\n  }\n  if (originalPageYDescriptor) {\n    Object.defineProperty(MouseEvent.prototype, 'pageY', originalPageYDescriptor);\n  }\n  if (originalOffsetXDescriptor) {\n    Object.defineProperty(MouseEvent.prototype, 'offsetX', originalOffsetXDescriptor);\n  }\n  if (originalOffsetYDescriptor) {\n    Object.defineProperty(MouseEvent.prototype, 'offsetY', originalOffsetYDescriptor);\n  }\n}\n","import { ByRoleMatcher, screen } from '@testing-library/preact';\nimport translations from '../../resources/nls/en/bundle';\nimport { RootEnvironment } from '#UNSAFE_Environment';\n\n//TODO: JET-63873\nexport function getIcon(menuItem: HTMLElement, selector: string) {\n  return menuItem.querySelector(selector);\n}\n\nexport function getAllMenuItemsByRole(role: ByRoleMatcher, hidden = true) {\n  return screen.getAllByRole(role, { hidden });\n}\n\nexport function getMenuItemByRole(role: ByRoleMatcher, hidden = true) {\n  return screen.getByRole(role, { hidden });\n}\n\nexport function getLabel(label: string) {\n  return screen.getByText(label);\n}\n\nexport function setObserverConfig() {\n  if (!window.ResizeObserver) {\n    // ResizeObserver isn't available in test environment\n    const MockResizeObserver = jest.fn();\n    MockResizeObserver.mockReturnValue({\n      observe: () => null,\n      unobserve: () => null,\n      disconnect: () => null\n    });\n\n    Object.defineProperty(global, 'ResizeObserver', {\n      writable: true,\n      configurable: true,\n      value: MockResizeObserver\n    });\n  }\n}\n\nexport const menuEnv: Partial<RootEnvironment> = {\n  translations: { '@oracle/oraclejet-preact': translations },\n  mode: 'test'\n};\n","import userEvent from '@testing-library/user-event';\nimport { waitFor, fireEvent, screen } from '@testing-library/preact';\nimport { expect } from 'chai';\nimport {\n  getAllMenuItemsByRole,\n  getLabel,\n  getMenuItemByRole\n} from '#UNSAFE_Menu/__tests__/menuTestsUtils';\n\nexport const getTestContextMenuForNoData = (renderedElement: HTMLElement) => async () => {\n  await userEvent.tab();\n  await userEvent.keyboard('[ENTER]');\n  fireEvent.keyDown(renderedElement, { key: 'F10', shiftKey: true });\n  const menu = screen.queryByRole('menu');\n  expect(menu).to.be.null;\n};\n\nexport const getTestContextMenuViaKeyboard =\n  (renderedElement: HTMLElement, menuContext: any, type: string | undefined) => async () => {\n    expect(renderedElement).not.null;\n    await userEvent.tab();\n    await userEvent.keyboard('[ENTER]');\n    fireEvent.keyDown(renderedElement, { key: 'F10', shiftKey: true });\n\n    const menu = getMenuItemByRole('menu');\n    const menuItems = getAllMenuItemsByRole('menuitem');\n    //With this we check context menu context was set correctly\n    const menuItemGotByLabel = getLabel('MenuItem1');\n    expect(menu).not.null;\n    expect(menuItems.length).equals(3);\n    expect(menuItemGotByLabel).not.null;\n\n    await waitFor(() => {\n      expect(menuContext).not.null;\n    });\n    await waitFor(() => {\n      expect(type).equals('item');\n    });\n    if (menuContext.type === 'item') {\n      await waitFor(() => {\n        expect(menuContext?.data).not.null;\n      });\n    }\n  };\n\nexport const getTestContextMenuViaMouse = (renderedElement: Element) => async () => {\n  const firstElement = renderedElement as HTMLElement;\n\n  fireEvent.contextMenu(firstElement, {\n    clientX: 50,\n    clientY: 50,\n    currentTarget: firstElement\n  });\n  const menu = getMenuItemByRole('menu');\n  const menuItems = getAllMenuItemsByRole('menuitem');\n  //With this we check context menu context was set correctly\n  const menuItemGotByLabel = getLabel('MenuItem1');\n\n  expect(menu).not.null;\n  expect(menuItems.length).equals(3);\n  expect(menuItemGotByLabel).not.null;\n};\n"],"names":["_jsx"],"mappings":"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"}
{"version":3,"file":"useRovingTabIndexContainer-3903d005.js","sources":["../../src/hooks/PRIVATE_useRovingTabIndexContainer/useRovingTabIndexContainer.tsx"],"sourcesContent":["import { useState, useRef } from 'preact/hooks';\nimport { useUser } from '../UNSAFE_useUser';\nimport { getClientHints } from '../../utils/PRIVATE_clientHints';\n\n/**\n * Utility hook for setting up roving tab indexes on children of the consuming parent container\n * For more details: https://www.w3.org/WAI/ARIA/apg/practices/keyboard-interface/#kbd_roving_tabindex\n * @param isDisabled boolean flag to communicate disabled state of consumer\n * @returns id of currently focused element, and props to be spread onto the consuming element\n */\nconst useRovingTabIndexContainer = (isDisabled?: boolean) => {\n  const rootRef = useRef<HTMLDivElement | null>(null);\n  const { direction } = useUser();\n  const isRtl = direction === 'rtl';\n  const [focusedId, setFocusedId] = useState<string | undefined>(undefined);\n  const [isShiftTabbing, setIsShiftTabbing] = useState(false); // shift tabbing is tracked in order to toggle wrapper out of the tab order\n  const clientHints = getClientHints();\n\n  const getRovingItems = () => {\n    return rootRef.current\n      ? Array.from(rootRef.current.querySelectorAll<HTMLElement>('[data-oj-roving-tabindex-item]'))\n      : [];\n  };\n\n  const handleKeyDown = (e: KeyboardEvent) => {\n    if (e.code === 'ArrowRight' || e.code === 'ArrowLeft') {\n      const items = getRovingItems();\n      if (items.length === 0) return;\n      const nextItem = getNextItem(items, e.code, focusedId, isRtl);\n      nextItem.focus();\n    } else if (e.shiftKey && e.code === 'Tab') {\n      setIsShiftTabbing(true);\n    }\n  };\n\n  // In Safari 16 and earlier, clicking on an HTML button element does not trigger a focus(in) event,\n  // and as such our handleFocus logic does not kick in and our focusedId state is never updated.\n  // To work around this, we manually update the focusedId in response to mouse downs. This has been fixed in Safari 17.\n  // This fix can be removed once Safari 18 is released.\n  const handleMouseDown = (e: MouseEvent) => {\n    const rovingItemId = getRovingItemId(e.target as HTMLElement, true);\n    if (rovingItemId) {\n      setFocusedId(rovingItemId);\n    }\n  };\n\n  const handleFocus = (e: FocusEvent) => {\n    if (e.target !== e.currentTarget) {\n      //focus has moved to one of the roving items\n      if (e.target) {\n        setFocusedId(getRovingItemId(e.target as HTMLElement));\n      }\n    } else {\n      //focus has moved to the container, and has to be passed onto the eligble item to receive focus\n      const items = getRovingItems();\n      if (items.length === 0) return;\n      const currentIndex = getCurrentRovingIndex(items, focusedId);\n      items[currentIndex].focus();\n    }\n  };\n\n  const rovingTabIndexContainerProps = {\n    ref: rootRef,\n    onBlur: () => setIsShiftTabbing(false),\n    onFocus: handleFocus,\n    onKeyDown: handleKeyDown,\n    ...(clientHints.browser === 'safari' && { onMouseDown: handleMouseDown }), // mouseDown handler needed for Safari 16\n    tabIndex: isShiftTabbing || isDisabled ? -1 : 0 // tab index is needed on the container in order to pass focus to the first child\n  };\n\n  return { focusedId, rovingTabIndexContainerProps };\n};\n\nconst getRovingItemId = (item: Element, useClosest = false) => {\n  if (useClosest) {\n    const ancestor = item.closest('data-oj-roving-tabindex-item');\n    if (ancestor) {\n      item = ancestor;\n    }\n  }\n\n  return item.getAttribute('data-oj-roving-tabindex-item') || undefined;\n};\n\nconst getCurrentRovingIndex = (items: HTMLElement[], focusedId: string | undefined) => {\n  const currentIndex = items.findIndex((item) => getRovingItemId(item) === focusedId);\n  return currentIndex === -1 ? 0 : currentIndex;\n};\n\nconst getNextItem = (\n  items: HTMLElement[],\n  eventCode: string,\n  focusedId: string | undefined,\n  isRtl: boolean\n) => {\n  const currentIndex = getCurrentRovingIndex(items, focusedId);\n  let nextIndex = -1;\n  if ((!isRtl && eventCode === 'ArrowRight') || (isRtl && eventCode === 'ArrowLeft')) {\n    nextIndex = currentIndex === items.length - 1 ? 0 : currentIndex + 1;\n  }\n  if ((!isRtl && eventCode === 'ArrowLeft') || (isRtl && eventCode === 'ArrowRight')) {\n    nextIndex = currentIndex === 0 ? items.length - 1 : currentIndex - 1;\n  }\n  return items[nextIndex];\n};\n\nexport { useRovingTabIndexContainer };\n"],"names":[],"mappings":"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"}
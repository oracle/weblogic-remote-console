{"version":3,"file":"EnvironmentProvider-546b7ebd.js","sources":["../../src/UNSAFE_Environment/EnvironmentProvider.tsx"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport {\n  CompleteEnvironmentType,\n  DefaultEnvironment,\n  Environment,\n  EnvironmentContext,\n  RootEnvironment\n} from './EnvironmentContext';\nimport { useContext, useMemo } from 'preact/hooks';\n\nimport { ComponentChildren } from 'preact';\nimport { LayerManager } from '../UNSAFE_Layer/LayerManager';\n\n// EnvironmentProvider properties\nexport declare type ProviderProperties<Env extends RootEnvironment | Environment> = {\n  environment?: Env;\n  children?: ComponentChildren;\n};\n\n// Custom merge function\nfunction mergeEnvironment(\n  env1: CompleteEnvironmentType,\n  env2: Partial<RootEnvironment> | undefined\n) {\n  const userValue = Object.assign({}, env1.user, env2?.user);\n  const themeValue = Object.assign({}, env1.theme, env2?.theme);\n\n  // Merge translation values - one level merge\n  const targetTranslations = Object.assign({}, env1.translations);\n  const sourceTranslations = env2?.translations || {};\n  Object.keys(sourceTranslations).forEach((key) => {\n    let newVal = sourceTranslations[key];\n    if (targetTranslations[key]) {\n      // merge is needed\n      newVal = Object.assign({}, targetTranslations[key], newVal);\n    }\n    targetTranslations[key] = newVal;\n  });\n\n  return {\n    user: userValue,\n    theme: themeValue,\n    translations: targetTranslations,\n    colorScheme: env2?.colorScheme ?? env1.colorScheme,\n    scale: env2?.scale ?? env1.scale,\n    currentBgColor: env2?.currentBgColor ?? env1.currentBgColor,\n    mode: env2?.mode ?? env1.mode,\n    density: env2?.density ?? env1.density\n  };\n}\n\n/**\n * The RootEnvironmentProvider component bootstraps essential services and\n * must be placed at the root of any application using components from '@oracle/oraclejet-preact'.\n * Minimally, the application must load the appropriate translation bundle for the user's locale\n * and set it on the RootEnvironmentProvider.\n */\nexport function RootEnvironmentProvider({\n  children,\n  environment\n}: ProviderProperties<RootEnvironment>) {\n  const mergedEnvironment = useMemo(\n    () => mergeEnvironment(DefaultEnvironment, environment),\n    [environment]\n  );\n  return (\n    <EnvironmentContext.Provider value={mergedEnvironment}>\n      <LayerManager>{children}</LayerManager>\n    </EnvironmentContext.Provider>\n  );\n}\n\n/**\n * The EnvironmentProvider is a component that should be used by the application when there is a need to overwrite\n * environment values for a subtree.\n * The component receives an Environment object that will be merged into the values provided by the nearest ancestor Provider.\n * The new environment will be passed to the component's children.\n * Note that some environment values cannot be overwritten. See the description of the Environment type for the list of values\n * that can be replaced.\n */\nexport function EnvironmentProvider({ children, environment }: ProviderProperties<Environment>) {\n  const consumerEnv = useContext(EnvironmentContext);\n  const mergedEnvironment = useMemo(\n    () => mergeEnvironment(consumerEnv, environment),\n    [consumerEnv, environment]\n  );\n\n  return (\n    <EnvironmentContext.Provider value={mergedEnvironment}>{children}</EnvironmentContext.Provider>\n  );\n}\n"],"names":["_jsx"],"mappings":";;;;;;AA0BA;AACA,SAAS,gBAAgB,CACvB,IAA6B,EAC7B,IAA0C,EAAA;AAE1C,IAAA,MAAM,SAAS,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;AAC3D,IAAA,MAAM,UAAU,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,IAAI,CAAC,KAAK,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;;AAG9D,IAAA,MAAM,kBAAkB,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;AAChE,IAAA,MAAM,kBAAkB,GAAG,IAAI,EAAE,YAAY,IAAI,EAAE,CAAC;IACpD,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC,OAAO,CAAC,CAAC,GAAG,KAAI;AAC9C,QAAA,IAAI,MAAM,GAAG,kBAAkB,CAAC,GAAG,CAAC,CAAC;AACrC,QAAA,IAAI,kBAAkB,CAAC,GAAG,CAAC,EAAE;;AAE3B,YAAA,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,kBAAkB,CAAC,GAAG,CAAC,EAAE,MAAM,CAAC,CAAC;SAC7D;AACD,QAAA,kBAAkB,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC;AACnC,KAAC,CAAC,CAAC;IAEH,OAAO;AACL,QAAA,IAAI,EAAE,SAAS;AACf,QAAA,KAAK,EAAE,UAAU;AACjB,QAAA,YAAY,EAAE,kBAAkB;AAChC,QAAA,WAAW,EAAE,IAAI,EAAE,WAAW,IAAI,IAAI,CAAC,WAAW;AAClD,QAAA,KAAK,EAAE,IAAI,EAAE,KAAK,IAAI,IAAI,CAAC,KAAK;AAChC,QAAA,cAAc,EAAE,IAAI,EAAE,cAAc,IAAI,IAAI,CAAC,cAAc;AAC3D,QAAA,IAAI,EAAE,IAAI,EAAE,IAAI,IAAI,IAAI,CAAC,IAAI;AAC7B,QAAA,OAAO,EAAE,IAAI,EAAE,OAAO,IAAI,IAAI,CAAC,OAAO;KACvC,CAAC;AACJ,CAAC;AAED;;;;;AAKG;SACa,uBAAuB,CAAC,EACtC,QAAQ,EACR,WAAW,EACyB,EAAA;AACpC,IAAA,MAAM,iBAAiB,GAAG,OAAO,CAC/B,MAAM,gBAAgB,CAAC,kBAAkB,EAAE,WAAW,CAAC,EACvD,CAAC,WAAW,CAAC,CACd,CAAC;AACF,IAAA,QACEA,GAAC,CAAA,kBAAkB,CAAC,QAAQ,IAAC,KAAK,EAAE,iBAAiB,EAAA,QAAA,EACnDA,IAAC,YAAY,EAAA,EAAA,QAAA,EAAE,QAAQ,EAAgB,CAAA,EAAA,CACX,EAC9B;AACJ,CAAC;AAED;;;;;;;AAOG;SACa,mBAAmB,CAAC,EAAE,QAAQ,EAAE,WAAW,EAAmC,EAAA;AAC5F,IAAA,MAAM,WAAW,GAAG,UAAU,CAAC,kBAAkB,CAAC,CAAC;IACnD,MAAM,iBAAiB,GAAG,OAAO,CAC/B,MAAM,gBAAgB,CAAC,WAAW,EAAE,WAAW,CAAC,EAChD,CAAC,WAAW,EAAE,WAAW,CAAC,CAC3B,CAAC;AAEF,IAAA,QACEA,GAAA,CAAC,kBAAkB,CAAC,QAAQ,EAAA,EAAC,KAAK,EAAE,iBAAiB,EAAA,QAAA,EAAG,QAAQ,EAAA,CAA+B,EAC/F;AACJ;;;;"}
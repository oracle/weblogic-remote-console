{"version":3,"file":"useChartMarquee-2d60324d.js","sources":["../../src/hooks/PRIVATE_useChartMarquee/utils.ts","../../src/hooks/PRIVATE_useChartMarquee/Marquee.tsx","../../src/hooks/PRIVATE_useChartMarquee/useChartMarquee.tsx"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { Dimension } from '#utils/UNSAFE_visTypes/common';\n\nexport function getResolvedDragMode(\n  isUserDragModeButtonShown: boolean,\n  isZoomAndScroll: boolean,\n  isMobile: boolean,\n  dragMode: 'off' | 'pan' | 'zoom' | 'user' | 'select',\n  userSelectedDragMode?: 'pan' | 'zoom' | 'select',\n  isMultiSelection?: boolean\n) {\n  if (userSelectedDragMode != undefined && isUserDragModeButtonShown) {\n    // when dragMode api value change happens, userDragMode state can be stale.\n    // only select userDragMode if there is a button that is present to select it.\n    return userSelectedDragMode;\n  }\n\n  if (dragMode === 'user') {\n    if (!isMobile) {\n      return isZoomAndScroll ? 'pan' : isMultiSelection ? 'select' : 'off';\n    }\n  }\n\n  return isMobile ? 'off' : dragMode;\n}\n\nexport function getMarqueeDims(\n  initialPoint: { x: number; y: number } | undefined,\n  finalPoint: { x: number; y: number } | undefined,\n  plotAreaSpace: Dimension,\n  xSpace: Dimension,\n  ySpace: Dimension,\n  treatAsXSpace: boolean\n) {\n  if (initialPoint && finalPoint) {\n    const spaceWidth = plotAreaSpace.x + plotAreaSpace.width;\n    const spaceHeight = plotAreaSpace.y + plotAreaSpace.height;\n\n    let x1 = Math.max(Math.min(initialPoint.x, finalPoint.x), plotAreaSpace.x);\n    let x2 = Math.min(Math.max(initialPoint.x, finalPoint.x), spaceWidth);\n\n    let y1 = Math.max(Math.min(initialPoint.y, finalPoint.y), plotAreaSpace.y);\n    const y2 = Math.min(Math.max(initialPoint.y, finalPoint.y), spaceHeight);\n\n    let width = Math.abs(x2 - x1);\n    let height = Math.abs(y2 - y1);\n\n    if (isPointInsideSpace(initialPoint.x, initialPoint.y, xSpace) || treatAsXSpace) {\n      y1 = plotAreaSpace.y;\n      height = plotAreaSpace.height;\n    } else if (isPointInsideSpace(initialPoint.x, initialPoint.y, ySpace)) {\n      x1 = plotAreaSpace.x;\n      x2 = spaceWidth;\n      width = plotAreaSpace.width;\n    }\n    return {\n      x1,\n      y1,\n      width,\n      height,\n      x2,\n      y2\n    };\n  }\n  return;\n}\n\nexport function getCursorType(\n  currentDragMode: 'zoom' | 'select' | 'pan' | 'off' | 'user',\n  isPointerDown: boolean\n) {\n  if (currentDragMode === 'zoom' || currentDragMode === 'select') {\n    return 'crosshair';\n  }\n\n  if (currentDragMode === 'pan') {\n    return isPointerDown ? 'grabbing' : 'grab';\n  }\n\n  return;\n}\n\nexport function isPointInsideSpace(x: number, y: number, space: Dimension) {\n  if (x >= space.x && x <= space.x + space.width && y >= space.y && y <= space.y + space.height) {\n    return true;\n  }\n  return false;\n}\n\nexport function isPointOutsideTargetSpace(\n  x: number,\n  y: number,\n  plotAreaSpace: Dimension,\n  xSpace: Dimension,\n  ySpace: Dimension\n) {\n  if (\n    !isPointInsideSpace(x, y, plotAreaSpace) &&\n    !isPointInsideSpace(x, y, xSpace) &&\n    !isPointInsideSpace(x, y, ySpace)\n  ) {\n    return true;\n  }\n  return false;\n}\n\nexport function getPanButtonVisibility(\n  isZoomAndScroll: boolean,\n  dragMode: 'off' | 'pan' | 'zoom' | 'user' | 'select',\n  isMobile: boolean\n) {\n  if (!isMobile || !isZoomAndScroll) {\n    return false;\n  }\n\n  return dragMode === 'user' || dragMode === 'pan';\n}\n\nexport function getZoomButtonVisibility(\n  isZoomAndScroll: boolean,\n  isMobile: boolean,\n  dragMode: 'zoom' | 'select' | 'pan' | 'off' | 'user'\n) {\n  if (!isZoomAndScroll) {\n    return false;\n  }\n\n  // In mobile don't show for user mode\n  return (isMobile && dragMode === 'zoom') || (!isMobile && dragMode === 'user');\n}\n\nexport function getSelectButtonVisibility(\n  isMultiSelection: boolean,\n  isZoomScroll: boolean,\n  isMobile: boolean,\n  dragMode: 'zoom' | 'select' | 'pan' | 'user' | 'off'\n) {\n\n  if (!isMultiSelection) {\n    return false;\n  }\n  else if(!isZoomScroll && ( dragMode === 'user' || dragMode === 'select')){\n    return isMobile;\n  }\n  \n  return dragMode === 'user' || (isMobile && dragMode === 'select');\n}\n","/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { styles } from './themes/useChartMarquee.css';\n\ntype Props = {\n  x1: number;\n  y1: number;\n  width: number;\n  height: number;\n};\nexport function Marquee({ x1, y1, width, height }: Props) {\n  return (\n    <>\n      <rect\n        x={x1}\n        y={y1}\n        width={width}\n        height={height}\n        class={styles.visMarquee}\n        data-oj-private-object=\"marquee\"\n      />\n      <rect\n        x={x1 + 1}\n        y={y1 + 1}\n        width={Math.max(0, width - 2)}\n        height={Math.max(0, height - 2)}\n        class={styles.visMarqueeInnerArea}\n      />\n    </>\n  );\n}\n","/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { RefObject, VNode } from 'preact';\nimport { useRef, useState } from 'preact/hooks';\nimport { Dimension } from '#utils/UNSAFE_visTypes/common';\nimport { Scale } from '#utils/UNSAFE_visTypes/chart';\nimport {\n  getCursorType,\n  getMarqueeDims,\n  isPointOutsideTargetSpace,\n  isPointInsideSpace,\n  getPanButtonVisibility,\n  getZoomButtonVisibility,\n  getSelectButtonVisibility,\n  getResolvedDragMode\n} from './utils';\nimport { isTouch } from '#utils/UNSAFE_visUtils/clientUtils';\nimport { useVisDragModeControls } from '#hooks/PRIVATE_useVisDragModeControls';\nimport { Marquee } from './Marquee';\nimport { SelectionDetail } from '#hooks/PRIVATE_useVisSelection/useSelection';\nimport { AxisInfo } from '#PRIVATE_Axis/axis.types';\nimport { getElementData } from '#utils/UNSAFE_visUtils';\n\ntype MarqueeProps<K, D> = {\n  rootRef: RefObject<HTMLElement>;\n  chartWidth: number;\n  plotAreaSpace: Dimension;\n  xSpace: Dimension;\n  ySpace: Dimension;\n  isZoomScroll: boolean;\n  isMultiSelection: boolean;\n  onSelectionChange?: (detail: SelectionDetail<K, D>) => void;\n  xScale: Scale;\n  onViewportChange?: (x: { xMin?: number; yMin?: number; xMax?: number; yMax?: number }) => void;\n  dragMode: 'user' | 'select' | 'zoom' | 'pan' | 'off';\n  getDataById: (id: K) => D | undefined;\n  selectedIds?: Set<K>;\n  isRtl: boolean;\n  xAxisInfo: AxisInfo;\n};\n\nexport function useChartMarquee<K, D>({\n  rootRef,\n  plotAreaSpace,\n  xSpace,\n  ySpace,\n  dragMode,\n  chartWidth,\n  isMultiSelection,\n  onViewportChange,\n  isZoomScroll,\n  xScale,\n  selectedIds,\n  getDataById,\n  onSelectionChange,\n  isRtl,\n  xAxisInfo\n}: MarqueeProps<K, D>) {\n  const isDeviceTouch = isTouch();\n  const isHovered = useRef(false);\n  const numOfActiveTouches = useRef(0);\n\n  const { min, max, viewportMax, viewportMin, minAxisExtent } = xAxisInfo;\n\n  const initialPointRef = useRef<{\n    x: number;\n    y: number;\n    isMeta?: boolean;\n  }>();\n\n  const showPanButton = getPanButtonVisibility(isZoomScroll, dragMode, isDeviceTouch);\n  const showZoomButton = getZoomButtonVisibility(isZoomScroll, isDeviceTouch, dragMode);\n  const showSelectButton = getSelectButtonVisibility(\n    isMultiSelection,\n    isZoomScroll,\n    isDeviceTouch,\n    dragMode\n  );\n\n  const { dragButtonDivRef, toggleButtonContent, userDragMode } = useVisDragModeControls({\n    componentWidth: chartWidth,\n    plotAreaSpace,\n    isRtl,\n    showPanButton,\n    showZoomButton,\n    showSelectButton,\n    dragMode\n  });\n\n  // for drag --> dragging cursor rerender in pan mode\n  const [isPointerDown, setIsPointerDown] = useState(false);\n  const isDragActiveRef = useRef(false);\n\n  const [finalPoint, setFinalPoint] = useState<{ x: number; y: number }>();\n\n  const selectedIdsRef = useRef<Set<K>>(new Set());\n\n  const isUserDragModeButtonShown =\n    (showPanButton && userDragMode === 'pan') ||\n    (showSelectButton && userDragMode === 'select') ||\n    (showZoomButton && userDragMode === 'zoom');\n\n  const mode = getResolvedDragMode(\n    isUserDragModeButtonShown,\n    isZoomScroll,\n    isDeviceTouch,\n    dragMode,\n    userDragMode,\n    isMultiSelection\n  );\n\n  const dims = getMarqueeDims(\n    initialPointRef.current,\n    finalPoint,\n    plotAreaSpace,\n    xSpace,\n    ySpace,\n    mode === 'zoom' // We need to revisit this for scatter chart and others charts\n  );\n\n  const onPointerEnter = () => {\n    isHovered.current = true;\n  };\n\n  const onPointerDown = (event: PointerEvent) => {\n    // prevent setIsPointerDown(true) when clicked on button\n    // otherwise the button will disapper before being clicked.\n    if (dragButtonDivRef?.current?.contains(event.target as HTMLElement)) {\n      return;\n    }\n\n    const x = event.offsetX;\n    const y = event.offsetY;\n\n    setIsPointerDown(true);\n\n    if (\n      isPointOutsideTargetSpace(x, y, plotAreaSpace, xSpace, ySpace) ||\n      (mode === 'zoom' && isPointInsideSpace(x, y, ySpace))\n    ) {\n      return;\n    }\n\n    initialPointRef.current = { x, y };\n  };\n\n  const onPointerLeave = (event: PointerEvent) => {\n    isHovered.current = false;\n    if (dims && isDeviceTouch && mode != 'off') {\n      (event.currentTarget as HTMLElement).setPointerCapture(event.pointerId);\n    }\n  };\n\n  const onPointerMove = (event: PointerEvent) => {\n    if (!isPointerDown) {\n      return;\n    }\n\n    isDragActiveRef.current = true;\n\n    if (event.metaKey && initialPointRef.current) {\n      initialPointRef.current.isMeta = true;\n    }\n\n    const x = event.offsetX;\n    const y = event.offsetY;\n\n    if (\n      isPointOutsideTargetSpace(x, y, plotAreaSpace, xSpace, ySpace) ||\n      (mode === 'zoom' && isPointInsideSpace(x, y, ySpace))\n    ) {\n      return;\n    }\n\n    const elementData = getElementData(rootRef, event.target as HTMLElement);\n    const elemType = elementData?.['ojPrivateObject'];\n    const originatedFromOverview =\n      elemType === 'window' || elemType === 'leftHandle' || elemType === 'rightHandle';\n\n    if (\n      !originatedFromOverview &&\n      mode === 'pan' &&\n      onViewportChange &&\n      (!isDeviceTouch || (isDeviceTouch && numOfActiveTouches.current === 1))\n    ) {\n      const axisDelta =\n        xScale.invert(x) - xScale.invert((finalPoint?.x || initialPointRef.current?.x)!);\n\n      const viewportRange = viewportMax - viewportMin;\n\n      let xMin = viewportMin - axisDelta;\n      let xMax = viewportMax - axisDelta;\n\n      if (xMin < min) {\n        xMin = min;\n        xMax = xMin + viewportRange;\n      }\n\n      if (xMax > max) {\n        xMax = max;\n        xMin = xMax - viewportRange;\n      }\n\n      if (xMin != viewportMin && xMax != viewportMax && Math.abs(xMax - xMin) >= minAxisExtent) {\n        onViewportChange({\n          xMin,\n          xMax\n        });\n      }\n    }\n\n    setFinalPoint({ x, y });\n  };\n\n  const onPointerUp = (event: PointerEvent) => {\n    setIsPointerDown(false);\n    setFinalPoint(undefined);\n    initialPointRef.current = undefined;\n    isDragActiveRef.current = false;\n\n    if (dragButtonDivRef.current?.contains(event.target as HTMLElement)) {\n      return;\n    }\n\n    if (!dims) {\n      return;\n    }\n\n    if (mode === 'zoom') {\n      const { x1, x2 } = dims;\n      let xMin = Math.min(xScale.invert(x1), xScale.invert(x2));\n      let xMax = Math.max(xScale.invert(x1), xScale.invert(x2));\n      if (Math.abs(xMax - xMin) < minAxisExtent) {\n        const mid = (xMin + xMax) / 2;\n        xMin = Math.max(min, mid - minAxisExtent / 2);\n        xMax = Math.min(max, xMin + minAxisExtent);\n      }\n      onViewportChange?.({\n        xMin,\n        xMax\n      });\n    }\n\n    if (mode === 'select') {\n      const ids = [\n        ...new Set([\n          ...selectedIdsRef.current,\n          ...(event.metaKey ? selectedIds || new Set<K>() : new Set<K>())\n        ])\n      ];\n      const data = ids.map((id) => getDataById(id));\n      onSelectionChange?.({ ids, data });\n      selectedIdsRef.current = new Set<K>();\n    }\n  };\n\n  // if mode is 'off', we still want to show the toggleButton.\n  // pointerUp will not fire because browser will have already claimed the\n  // pointer\n  const onTouchEnd = (event: TouchEvent) => {\n    setIsPointerDown(false);\n    setFinalPoint(undefined);\n    initialPointRef.current = undefined;\n    numOfActiveTouches.current = event.touches.length;\n  };\n\n  const onTouchStart = (event: TouchEvent) => {\n    numOfActiveTouches.current = event.touches.length;\n  };\n\n  let marqueeContent: VNode | undefined;\n\n  const isPointInsideMarquee =\n    mode === 'select' && dims\n      ? (id: K, point: { x: number; y: number }) => {\n          if (initialPointRef.current?.isMeta && selectedIds?.has(id)) {\n            return true;\n          }\n          const { x1, x2, y1, y2 } = dims;\n          const { x, y } = point;\n          if (isPointInsideSpace(x, y, { x: x1, width: x2 - x1, y: y1, height: y2 - y1 })) {\n            selectedIdsRef.current?.add(id);\n            return true;\n          } else {\n            selectedIdsRef.current?.delete(id);\n          }\n          return false;\n        }\n      : undefined;\n\n  if (dims && (mode === 'zoom' || mode === 'select')) {\n    marqueeContent = <Marquee {...dims} />;\n  }\n\n  return {\n    ignoreSelectPointerUp: (mode === 'pan' || mode === 'zoom') && isDragActiveRef.current,\n    cursor: getCursorType(mode, isPointerDown),\n    yAxisCursor: mode !== 'zoom' ? getCursorType(mode, isPointerDown) : 'initial',\n    marqueeContent,\n    toggleButtonContent:\n      !isPointerDown &&\n      ((!isDeviceTouch && isHovered.current) || isDeviceTouch) &&\n      toggleButtonContent,\n    isPointInsideMarquee,\n    dragMode: mode,\n    marqueeProps:\n      dragMode != 'off'\n        ? {\n            onPointerDown,\n            onPointerMove,\n            onPointerUp,\n            onPointerLeave,\n            onPointerEnter,\n            onTouchEnd,\n            onTouchStart\n          }\n        : {}\n  };\n}\n"],"names":["_jsxs","_Fragment","_jsx"],"mappings":"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"}
{"version":3,"file":"useDatatip-c7727336.js","sources":["../../src/hooks/PRIVATE_useDatatip/useDatatip.tsx"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { ComponentChildren } from 'preact';\nimport { Layer } from '#UNSAFE_Layer';\nimport { Floating, Placement } from '#UNSAFE_Floating';\nimport { useRef, useState } from 'preact/hooks';\nimport { styles } from './themes/useDatatip.css';\nimport { useId } from '#hooks/UNSAFE_useId';\nimport { Property } from 'csstype';\nimport { DATATIP_OFFSET } from '#utils/UNSAFE_visUtils/datatipUtils';\nimport { useVisHover } from '#hooks/PRIVATE_useVisHover';\nimport { mergeProps } from '#utils/UNSAFE_mergeProps';\nexport type { Dimension } from '#utils/UNSAFE_visTypes/common';\n\ntype DatatipProps = {\n  /**\n   * The datatip content.\n   */\n  content?: ComponentChildren;\n\n  /**\n   * Whether the datatip is anchored to pointer or element.\n   *\n   */\n  anchor: 'element' | 'pointer';\n\n  /**\n   * The offset from the anchor element or pointer.\n   */\n  offset?: {\n    mainAxis?: number;\n    crossAxis?: number;\n  };\n\n  /**\n   * The border color of the datatip.\n   */\n  borderColor?: Property.BorderColor;\n\n  /**\n   * The placement of datatip from anchor point.\n   */\n  placement?: Placement;\n\n  /**\n   * The touch response value.\n   */\n  touchResponse: 'touchStart' | 'touchHold';\n\n  /**\n   * Whether datatip is disabled\n   */\n  isDisabled?: boolean;\n};\n\n/**\n * The hook to support custom datatip in visualization components.\n */\nexport function useDatatip({\n  content,\n  placement = 'top-end-corner',\n  offset,\n  borderColor,\n  anchor,\n  touchResponse,\n  isDisabled\n}: DatatipProps) {\n  const uniqueIdRef = useRef<string>(useId());\n  const [coords, setCoords] = useState({ x: 0, y: 0 });\n  const offsetValue = offset || { mainAxis: DATATIP_OFFSET, crossAxis: -1 * DATATIP_OFFSET };\n  const [isVisible, setIsVisible] = useState(false);\n\n  const targetRef = useRef<HTMLElement | null>(null);\n  const toggleTimeoutRef = useRef<ReturnType<typeof setTimeout>>();\n\n  const onHover = (event: PointerEvent) => {\n    setCoords({ x: event.clientX, y: event.clientY });\n    setIsVisible(true);\n  };\n\n  const onHoverEnter = (event: PointerEvent, currentTarget: HTMLElement) => {\n    if (\n      event.pointerType === 'touch' ||\n      event.eventPhase === Event.AT_TARGET ||\n      event.eventPhase === Event.BUBBLING_PHASE\n    ) {\n      setCoords({ x: event.clientX, y: event.clientY });\n      targetRef.current = currentTarget;\n      setIsVisible(true);\n    }\n  };\n\n  const onHoverLeave = () => {\n    toggleTimeoutRef.current = setTimeout(() => {\n      setIsVisible(false);\n    }, 20);\n  };\n\n  const hoverHandlers = useVisHover(onHover, onHoverEnter, onHoverLeave, touchResponse);\n\n  const onFocus = (event: FocusEvent) => {\n    if (event.eventPhase === Event.AT_TARGET || event.eventPhase === Event.BUBBLING_PHASE) {\n      targetRef.current = event.target as HTMLElement;\n      setIsVisible(true);\n    }\n  };\n\n  const onBlur = () => {\n    setIsVisible(false);\n  };\n\n  const onContentPointerEnter = () => {\n    clearTimeout(toggleTimeoutRef.current);\n  };\n\n  const onKeyUp = (event: KeyboardEvent) => {\n    if (\n      event.code === 'ArrowUp' ||\n      event.code === 'ArrowDown' ||\n      event.code === 'ArrowRight' ||\n      event.code === 'ArrowLeft' ||\n      event.code === 'Tab'\n    ) {\n      setIsVisible(true);\n    }\n  };\n\n  const onKeyDown = (event: KeyboardEvent) => {\n    if (event.code === 'Escape') {\n      event.preventDefault();\n      setIsVisible(false);\n    }\n  };\n\n  const anchorRef = anchor === 'element' ? targetRef : { current: coords };\n  const datatipContent =\n    isVisible && !!content && !isDisabled ? (\n      <Layer>\n        <Floating\n          anchorRef={anchorRef}\n          placement={placement}\n          offsetValue={offsetValue}\n          flipOptions={{\n            crossAxis: anchor === 'pointer' ? true : false,\n            mainAxis: anchor === 'pointer' ? true : false\n          }}\n          shiftOptions={{ crossAxis: true, mainAxis: true }}>\n          <div\n            role=\"tooltip\"\n            id={uniqueIdRef.current}\n            className={styles.visDatatipStyle}\n            style={{ borderColor }}\n            onPointerEnter={onContentPointerEnter}\n            onPointerLeave={onHoverLeave}>\n            {content}\n          </div>\n        </Floating>\n      </Layer>\n    ) : null;\n\n  return {\n    datatipContent,\n    datatipProps: {\n      'aria-describedby': datatipContent !== null ? uniqueIdRef.current : undefined,\n      ...mergeProps(hoverHandlers, {\n        onKeyUp,\n        onKeyDown,\n        onFocus,\n        onBlur\n      })\n    }\n  };\n}\n"],"names":["_jsx"],"mappings":"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"}
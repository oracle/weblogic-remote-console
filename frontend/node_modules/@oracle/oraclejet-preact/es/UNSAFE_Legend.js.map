{"version":3,"file":"UNSAFE_Legend.js","sources":["../../src/UNSAFE_Legend/legendNavUtils.ts","../../src/UNSAFE_Legend/getLegendLayout.ts","../../src/UNSAFE_Legend/Legend.tsx"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport {\n  ItemActionDetail,\n  ItemFocusDetail,\n  ItemHoverDetail,\n  ItemInfo,\n  LegendItemData\n} from '#utils/UNSAFE_visTypes/legend';\n\nfunction getItem<K, D extends LegendItemData<K>>(itemInfo: ItemInfo, items: D[]) {\n  const { itemIdx } = itemInfo;\n\n  if (itemIdx == -1) {\n    return items[items.length - 1];\n  }\n  return items[itemIdx];\n}\n\nfunction getNextItemInfo<K>(itemInfo: ItemInfo, items: LegendItemData<K>[]) {\n  let itemIdx = itemInfo.itemIdx;\n\n  if (itemIdx == -1) {\n    itemIdx = items.length - 1;\n  }\n\n  itemIdx = Math.min(items.length - 1, itemIdx + 1);\n  if (items[itemIdx].actionable !== 'off') {\n    return { sectionIdx: 0, itemIdx };\n  } else if (itemIdx === items.length - 1) {\n    itemIdx = itemIdx - 1;\n    return { sectionIdx: 0, itemIdx };\n  }\n\n  return getNextItemInfo({ sectionIdx: 0, itemIdx }, items);\n}\n\nfunction getPrevItemInfo<K>(itemInfo: ItemInfo, items: LegendItemData<K>[]) {\n  let itemIdx = itemInfo.itemIdx;\n\n  if (itemIdx == -1) {\n    itemIdx = items.length - 1;\n  }\n\n  itemIdx = Math.max(0, itemIdx - 1);\n  if (items[itemIdx].actionable !== 'off') {\n    return { sectionIdx: 0, itemIdx };\n  }\n\n  return getPrevItemInfo({ sectionIdx: 0, itemIdx }, items);\n}\n\n/**\n * Returns utils functions for navigation in simple legend.\n * @param items\n * @returns\n */\nexport function getLegendNavUtils<K extends string | number, D extends LegendItemData<K>>(\n  items: D[]\n) {\n  return {\n    getItem: (itemInfo: ItemInfo) => {\n      return getItem(itemInfo, items);\n    },\n    getDetailFromInfo: (\n      itemInfo?: ItemInfo\n    ): ItemFocusDetail<K, D> | ItemHoverDetail<K, D> | ItemActionDetail<K, D> => {\n      if (!itemInfo || items.length === 0) {\n        return { itemId: undefined, data: undefined };\n      }\n      const item = getItem(itemInfo, items);\n      return { itemId: item.id, data: item };\n    },\n    getPrevItemInfo: (itemInfo: ItemInfo) => {\n      return getPrevItemInfo(itemInfo, items);\n    },\n    getNextItemInfo: (itemInfo: ItemInfo) => {\n      return getNextItemInfo(itemInfo, items);\n    }\n  };\n}\n","/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { LegendItemData } from '#utils/UNSAFE_visTypes/legend';\nimport { Font, TextDimensions, useTextDimensions } from '#hooks/PRIVATE_useTextDimensions';\nimport { getGridNums } from '#utils/PRIVATE_legendUtils/legendUtils';\n\ntype Props<K> = {\n  width: number;\n  getTextDimensions?: ((textString: string, font?: Font | undefined) => TextDimensions) | undefined;\n  resolvedVars: Record<string, any>;\n  orientation?: 'vertical' | 'horizontal';\n  legendFontStylesObj?: Font;\n  symbolWidth?: number;\n  symbolHeight?: number;\n  items: LegendItemData<K>[];\n};\nexport type LayoutInfo = {\n  totalWidth: number;\n  maxItemWidth: number;\n  maxItemHeight: number;\n  itemsPerRow: number;\n  isWrapped?: boolean;\n};\ntype getTextDimensionsType = NonNullable<\n  NonNullable<ReturnType<typeof useTextDimensions>>['getTextDimensions']\n>;\n\nexport const getLinearLegendLayoutInfo = <K>({\n  width,\n  getTextDimensions,\n  resolvedVars,\n  orientation,\n  legendFontStylesObj = {},\n  symbolWidth,\n  items\n}: Props<K>) => {\n  let maxWidth = 0;\n  let maxHeight = 0;\n  let totalWidth = 0;\n  let isWrapped = false;\n\n  const containerWidth = width;\n\n  if (!Object.keys(resolvedVars).length || !getTextDimensions) {\n    return;\n  }\n\n  const unitLength = parseFloat(resolvedVars['unit']);\n\n  const { maxItemWidth, maxItemHeight, horizontalSectionWidth } = getMaxWidth(\n    items,\n    unitLength,\n    getTextDimensions,\n    legendFontStylesObj,\n    symbolWidth\n  );\n  totalWidth = horizontalSectionWidth;\n  maxWidth = maxItemWidth;\n  maxHeight = maxItemHeight;\n  isWrapped = horizontalSectionWidth > containerWidth!;\n\n  const legendLayoutInfo = {\n    totalWidth,\n    maxItemWidth: Math.min(maxWidth, containerWidth!),\n    maxItemHeight: maxHeight,\n    itemsPerRow:\n      orientation === 'vertical' ? 1 : Math.max(1, Math.floor(containerWidth / maxWidth)),\n    isWrapped\n  };\n\n  return legendLayoutInfo;\n};\n\n/**\n * Returns maximum of the width among the items in a section of legend also return the width of the entire section.\n * @param items Legend items array\n * @param unitLength Base  element\n * @param getTextDimensions Text width measurement function\n * @param legendFontStylesObj Legend text font style properties object\n * @param symbolWidth Width of legend symbol\n *\n * @returns\n */\nconst getMaxWidth = <K>(\n  items: LegendItemData<K>[],\n  unitLength: number,\n  getTextDimensions: getTextDimensionsType,\n  legendFontStylesObj?: Font,\n  symbolWidth?: number,\n  symbolHeight?: number\n) => {\n  let maxItemWidth = 0;\n  let maxItemHeight = 0;\n  let horizontalSectionWidth = 0;\n  let itemSymbolWidth = 0;\n  let itemSymbolHeight = 0;\n  if (symbolWidth) {\n    itemSymbolWidth = unitLength * 1.5 + symbolWidth;\n  } else {\n    //itemSymbolWidth = marginLeft + marginRight + width below expression is simplified\n    itemSymbolWidth = 4 * unitLength;\n  }\n\n  if (symbolHeight) {\n    // symbolHeight/defaultSymbolHeight + symbolPaddingTopBottom\n    itemSymbolHeight = symbolHeight + unitLength * 1.7;\n  } else {\n    // symbolHeight/defaultSymbolHeight + symbolPaddingTopBottom\n    itemSymbolHeight = 2.5 * unitLength + unitLength * 1.7;\n  }\n\n  items?.forEach((item) => {\n    const legendItem = item as LegendItemData<K>;\n    const { width, height } = getTextDimensions(legendItem.text, legendFontStylesObj);\n    //itemTextWidth = paddingLeft + paddingRight + width\n    const itemTextWidth = unitLength * 2.5 + width;\n    //horizontalSectionWidth = total width of the section\n    horizontalSectionWidth += itemSymbolWidth + itemTextWidth;\n    maxItemWidth = Math.max(maxItemWidth, itemSymbolWidth + itemTextWidth);\n    maxItemHeight = Math.max(maxItemHeight, height, itemSymbolHeight);\n  });\n\n  return { maxItemWidth, maxItemHeight, horizontalSectionWidth };\n};\n\nexport function _getPreferredSize<K>(\n  _width: number,\n  _height: number,\n  items: LegendItemData<K>[],\n  resolvedVars: Record<string, any>,\n  orientation: 'vertical' | 'horizontal',\n  legendFontStylesObj: Record<string, any>,\n  symbolWidth?: number,\n  symbolHeight?: number,\n  getTextDimensions?: (textString: string, font?: Font | undefined) => TextDimensions\n) {\n  if (!getTextDimensions) {\n    return undefined;\n  }\n  const layoutInfo = getLinearLegendLayoutInfo({\n    width: _width,\n    getTextDimensions,\n    resolvedVars,\n    orientation,\n    legendFontStylesObj,\n    symbolWidth: symbolWidth,\n    symbolHeight: symbolHeight,\n    items\n  });\n  const { itemsPerCol, itemsPerRow } = getGridNums(items.length, layoutInfo, orientation);\n  const unitLength = parseFloat(resolvedVars['unit']);\n  const preferredWidth = Math.min(\n    _width,\n    itemsPerCol === 1\n      ? layoutInfo!.totalWidth\n      : itemsPerRow\n      ? layoutInfo!.maxItemWidth * itemsPerRow!\n      : layoutInfo!.totalWidth\n  );\n  const paddingLegendItems = 0.8 * unitLength;\n  const paddingLegendTopBottom = 1.5 * unitLength;\n\n  const legendHeight = itemsPerCol\n    ? layoutInfo!.maxItemHeight * itemsPerCol! +\n      (itemsPerCol! - 1) * paddingLegendItems +\n      paddingLegendTopBottom\n    : layoutInfo!.maxItemHeight + paddingLegendTopBottom;\n  const preferredHeight = Math.min(_height, legendHeight);\n\n  return { width: Math.ceil(preferredWidth), height: Math.ceil(preferredHeight) };\n}\n","/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\nimport { Ref, VNode } from 'preact';\nimport { useContext, useMemo, useRef, useState } from 'preact/hooks';\nimport { BaseLegend } from '#PRIVATE_BaseLegend/BaseLegend';\nimport { useVisEvent } from '#hooks/PRIVATE_useVisEvents/useVisEvents';\nimport { LegendProps, LegendDragStartDetail } from './legend.type';\nimport { getLegendNavUtils } from './legendNavUtils';\nimport {\n  getAriaProps,\n  getDatatipText,\n  getGridNums,\n  getIsLegendItemActionable,\n  getItemInfo,\n  getLegendTextStyle,\n  isEqualItem\n} from '#utils/PRIVATE_legendUtils/legendUtils';\nimport { mergeProps } from '#utils/UNSAFE_mergeProps';\nimport { useLegendDatatip } from './useLegendDatatip';\nimport { useItemFocus } from '#hooks/PRIVATE_useVisEvents';\nimport { styles } from '#PRIVATE_BaseLegend/themes/LegendStyles.css';\nimport { useCssVars } from '#hooks/PRIVATE_useCssVars';\nimport { legendVars, getKeyUpHandler } from '#utils/PRIVATE_legendUtils/legendUtils';\nimport { classNames } from '#utils/UNSAFE_classNames';\nimport { useTestId } from '#hooks/UNSAFE_useTestId';\nimport { useLegendContextMenu } from '#PRIVATE_BaseLegend/useLegendContextMenu';\nimport {\n  ItemFocusDetail,\n  ItemActionDetail,\n  ItemInfo,\n  LegendItemData\n} from '#utils/UNSAFE_visTypes/legend';\nimport { useVisTouchResponse } from '#hooks/PRIVATE_useVisTouchResponse';\nimport { merge } from '@oracle/oraclejet-internal-utilities/stringUtils';\nimport { forwardRef, useImperativeHandle } from 'preact/compat';\nimport { TrackResizeContainer } from '#UNSAFE_TrackResizeContainer';\nimport { useTextDimensions } from '#hooks/PRIVATE_useTextDimensions';\nimport { _getPreferredSize, getLinearLegendLayoutInfo } from './getLegendLayout';\nimport { useLegendDnd } from '#hooks/PRIVATE_useLegendDnD/useLegendDnd';\nimport { styles as VisDndStyles } from '#hooks/PRIVATE_useVisDnd/themes/VisDndStyles.css';\nimport { LegendRenderedContext } from '#hooks/UNSAFE_useLegendPreferredSize';\n\nexport type SizeHandle = {\n  _getPreferredSize: (\n    _width: number,\n    _height: number\n  ) => { width: number; height: number } | undefined;\n};\n\ntype ForwardRefLegend = <K extends string | number, D extends LegendItemData<K>>(\n  props: LegendProps<K, D> & { ref?: Ref<SizeHandle> }\n) => VNode | null;\n\n/**\n * A legend displays an interactive description of symbols, colors, etc., used in graphical information representations.\n */\nexport const Legend = forwardRef(\n  <K extends string | number, D extends LegendItemData<K>>(\n    {\n      orientation = 'horizontal',\n      items,\n      isReadOnly = true,\n      onItemAction,\n      onItemHover,\n      onItemFocus,\n      testId,\n      contextMenuConfig,\n      hideAndShowBehavior = 'off',\n      hoverBehavior = 'none',\n      halign = 'start',\n      valign = 'top',\n      ...props\n    }: LegendProps<K, D>,\n    ref: Ref<SizeHandle> = null\n  ) => {\n    // Use the context\n    const { isGetPreferredSizeReady, width, height } = useContext(LegendRenderedContext);\n    const { textMeasureContent, getTextDimensions } = useTextDimensions();\n    const { resolvedVars, cssContent } = useCssVars(legendVars);\n\n    const legendFontStylesObj = getLegendTextStyle(\n      {\n        fontStyle: props.textFontStyle,\n        fontSize: props.textFontSize?.toString(),\n        fontWeight: props.textFontWeight?.toString(),\n        fontFamily: props.textFontFamily\n      },\n      resolvedVars\n    );\n    const rootRef = useRef<HTMLDivElement>(null);\n\n    useImperativeHandle(\n      ref!,\n      () => ({\n        _getPreferredSize: (_width: number, _height: number) => {\n          return _getPreferredSize(\n            _width,\n            _height,\n            items,\n            resolvedVars,\n            orientation,\n            legendFontStylesObj,\n            props.symbolWidth,\n            props.symbolHeight,\n            getTextDimensions\n          );\n        }\n      }),\n      [\n        getTextDimensions,\n        resolvedVars,\n        orientation,\n        legendFontStylesObj,\n        props.symbolWidth,\n        props.symbolHeight,\n        items\n      ]\n    );\n\n    if (\n      getTextDimensions &&\n      resolvedVars['unit'] != undefined &&\n      resolvedVars['fontSize'] != undefined\n    ) {\n      isGetPreferredSizeReady?.(true);\n    }\n\n    const testIdProps = useTestId(testId);\n    const isTestEnv = testIdProps['data-testid'] !== undefined;\n    const rootDimsRef = useRef<DOMRect>();\n    const { getItem, getDetailFromInfo, getPrevItemInfo, getNextItemInfo } = getLegendNavUtils<\n      K,\n      D\n    >(items);\n\n    const isLegendItemActionable = getIsLegendItemActionable(items, isReadOnly);\n    const hasData = items.length > 0;\n\n    const legendKeyUpHandler = (\n      triggerOnAction: () => void,\n      updatefocusedItemInfo: (itemInfo: ItemInfo) => void,\n      focusedItemInfo: ItemInfo\n    ) =>\n      getKeyUpHandler(\n        triggerOnAction,\n        updatefocusedItemInfo,\n        focusedItemInfo,\n        props.hiddenIds != null\n      );\n\n    const { touchResponse, touchResponseStyle } = useVisTouchResponse({\n      type: 'touchStart'\n    });\n    const { focusedItemInfo, hoveredItemInfo, onContextMenuDismissed, activeId, eventsProps } =\n      useVisEvent<ItemInfo, ItemActionDetail<K, D>, ItemFocusDetail<K, D>, D>(\n        touchResponse,\n        !isReadOnly,\n        isLegendItemActionable,\n        legendKeyUpHandler,\n        getDetailFromInfo,\n        getPrevItemInfo,\n        getNextItemInfo,\n        onItemAction,\n        onItemHover,\n        onItemFocus,\n        isEqualItem,\n        getItemInfo,\n        { itemIdx: 0, sectionIdx: 0 },\n        props.hiddenIds != null\n      );\n\n    const { focusedItemRef } = useItemFocus(focusedItemInfo);\n    const datatipText = getDatatipText(items, getItem, focusedItemInfo, hoveredItemInfo);\n    const [datatipDisabled, setDatatipDisabled] = useState(false);\n    const {\n      datatipContent,\n      datatipProps: { 'aria-describedby': datatipAriaDescribedby, ...datatipProps }\n    } = useLegendDatatip({\n      text: datatipText,\n      rootDimsRef,\n      focusedItemInfo,\n      focusedItemRef,\n      touchResponse,\n      isDisabled: datatipDisabled\n    });\n\n    const ariaProps = getAriaProps<K>(\n      isReadOnly,\n      props['aria-label'],\n      props.hiddenIds,\n      merge([props['aria-describedby'], datatipAriaDescribedby]),\n      props['aria-labelledby']\n    );\n\n    const { contextMenuContent, contextMenuProps } = useLegendContextMenu<D>({\n      rootRef,\n      contextMenuConfig: hasData ? contextMenuConfig : undefined,\n      focusedItemInfo,\n      items,\n      isReadOnly,\n      onContextMenuDismissed\n    });\n\n    const [dragOver, setDragOver] = useState<boolean>();\n\n    const { draggable, dndProps, dndContent } = useLegendDnd<K, D, LegendDragStartDetail<D>>({\n      onDrag: props.onDrag,\n      onDragStart: props.onDragStart,\n      onDragEnd: props.onDragEnd,\n      onDragEnter: props.onDragEnter,\n      onDragLeave: props.onDragLeave,\n      onDragOver: props.onDragOver,\n      onDrop: props.onDrop,\n      items,\n      setDragOver,\n      setDatatipDisabled,\n      itemDraggable: props.itemDraggable\n    });\n\n    const mergedProps = mergeProps(eventsProps, datatipProps, contextMenuProps, dndProps);\n    const { legendStyle, renderedLegendStyle } = styles;\n\n    return (\n      <>\n        {!isGetPreferredSizeReady && (\n          <TrackResizeContainer\n            width={width ? `${width}px` : '100%'}\n            height={height ? `${height}px` : '100%'}\n            class={classNames([\n              styles.flexStyle,\n              styles[`${halign}HAlign`],\n              styles[`${valign}VAlign`]\n            ])}>\n            {function _(width) {\n              const layoutInfo = useMemo(\n                () =>\n                  getLinearLegendLayoutInfo<K>({\n                    width,\n                    getTextDimensions,\n                    resolvedVars,\n                    orientation,\n                    legendFontStylesObj,\n                    symbolWidth: props.symbolWidth,\n                    symbolHeight: props.symbolHeight,\n                    items\n                  }),\n                [width]\n              );\n              const { itemsPerCol, itemsPerRow } = getGridNums(items.length, layoutInfo);\n              return (\n                <>\n                  <div\n                    ref={rootRef}\n                    tabIndex={isReadOnly ? undefined : 0}\n                    role=\"application\"\n                    draggable={draggable}\n                    class={classNames([\n                      legendStyle,\n                      renderedLegendStyle,\n                      dragOver\n                        ? VisDndStyles.dndDragOverHTMLStyle\n                        : dragOver === false\n                        ? VisDndStyles.dndRejectedStyle\n                        : undefined\n                    ])}\n                    style={touchResponseStyle}\n                    {...testIdProps}\n                    {...ariaProps}\n                    {...mergedProps}\n                    aria-activedescendant={activeId}>\n                    <BaseLegend\n                      {...props}\n                      focusedItemRef={focusedItemRef}\n                      items={items}\n                      isReadOnly={isReadOnly}\n                      orientation={orientation}\n                      sectionIdx={0}\n                      itemsPerRow={itemsPerRow}\n                      itemsPerCol={itemsPerCol}\n                      itemWidth={layoutInfo?.isWrapped ? layoutInfo?.maxItemWidth : undefined}\n                      focusedItemInfo={focusedItemInfo}\n                      hoveredItemInfo={hoveredItemInfo}\n                      activeId={activeId}\n                      hideAndShowBehavior={hideAndShowBehavior}\n                      hoverBehavior={hoverBehavior}\n                      isTestEnv={isTestEnv}\n                    />\n                  </div>\n                  {datatipContent}\n                  {contextMenuContent}\n                  {dndContent}\n                </>\n              );\n            }}\n          </TrackResizeContainer>\n        )}\n        {textMeasureContent}\n        {cssContent}\n      </>\n    );\n  }\n) as ForwardRefLegend;\n"],"names":["merge","_jsxs","_Fragment","_jsx","VisDndStyles"],"mappings":"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"}
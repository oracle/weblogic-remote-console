{"version":3,"file":"useSwatchSelection-1b942fd3.js","sources":["../../src/hooks/PRIVATE_useSwatchSelection/useSwatchSelection.ts"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\nimport { useCallback, useRef } from 'preact/hooks';\nimport { Keys, containsKey, removeKey } from '../../utils/UNSAFE_keys';\nimport { SelectionDetail } from '../../UNSAFE_Collection';\nimport { getIsSelectionPending } from '#utils/PRIVATE_textSelectionUtils';\nimport { SelectionBehavior } from './SwatchSelection.types';\n\nconst handleSelect = <K>(\n  event: MouseEvent | KeyboardEvent,\n  keyExtractor: (element: HTMLElement) => K | null,\n  selectedKeys: Keys<K>,\n  selectionBehavior: SelectionBehavior,\n  isSelectionRequired: boolean,\n  onChange?: (detail: SelectionDetail<K>) => void\n) => {\n  const itemKey = keyExtractor(event.target as HTMLElement);\n  if (itemKey == null) {\n    return;\n  }\n\n  const selected = containsKey(selectedKeys, itemKey);\n  let keySet = selectedKeys;\n  if (!selected) {\n    // should only contains this item key\n    keySet = { all: false, keys: new Set([itemKey]) };\n  } else if ((event as KeyboardEvent).key !== 'Enter') {\n    // no de-select for enter key\n    if (\n      selectionBehavior === 'toggle' ||\n      event.ctrlKey ||\n      event.metaKey ||\n      (event as KeyboardEvent).key === ' '\n    ) {\n      // de-select only when ctrl/meta key is pressed or selectionBehavior is\n      // explicitly set to toggle\n      keySet = removeKey(selectedKeys, itemKey, isSelectionRequired);\n    }\n  }\n\n  // only invoke callback if there is really a change\n  // note onSelectionChange should never be null here\n  if (selectedKeys != keySet && onChange) {\n    onChange({ value: keySet, target: event.target });\n    if (event.type === 'click') {\n      event.stopPropagation();\n    }\n  }\n};\n\n/**\n * Hook for handling various selection mode.  Customized for color swatch support.\n * @param keyExtractor function to extract the key based on provided element\n * @param selectedKeys the currently selected keys\n * @param isSelectionRequired true if empty selected key is not allowed, false otherwise\n * @param selectionBehavior the selection behavior.  If the value is 'toggle', then the key is\n *                          added/removed from the current selected keys.  If the value is 'replace',\n *                          then the current selected keys are cleared first before the key is added\n *                          unless the ctrl/shift/meta key is pressed.\n * @param onChange callback function that is invoked when selection has changed.\n * @returns an event map that the consumer can register as event listeners\n */\nexport function useSwatchSelection<K>(\n  keyExtractor: (element: HTMLElement) => K | null,\n  selectedKeys: Keys<K>,\n  isSelectionRequired: boolean,\n  selectionBehavior: SelectionBehavior,\n  onChange?: (detail: SelectionDetail<K>) => void\n) {\n  const isTouchPointerRef = useRef<boolean>(false);\n\n  const onClick = useCallback(\n    (event: MouseEvent) => {\n      if (!getIsSelectionPending()) {\n        handleSelect<K>(\n          event,\n          keyExtractor,\n          selectedKeys,\n          isTouchPointerRef.current ? 'toggle' : selectionBehavior,\n          isSelectionRequired,\n          onChange\n        );\n      }\n    },\n    [keyExtractor, selectedKeys, isSelectionRequired, selectionBehavior, onChange]\n  );\n\n  // general keyboard events listen to keyUp for a11y\n  const onKeyUp = useCallback(\n    (event: KeyboardEvent) => {\n      // older browser that we don't support returns 'Spacebar' for space key\n      if (event.key === ' ' || event.key === 'Enter') {\n        handleSelect<K>(\n          event,\n          keyExtractor,\n          selectedKeys,\n          selectionBehavior,\n          isSelectionRequired,\n          onChange\n        );\n      }\n    },\n    [keyExtractor, selectedKeys, selectionBehavior, isSelectionRequired, onChange]\n  );\n\n  const selectionProps = onChange == null ? {} : { onClick, onKeyUp };\n  return { selectionProps };\n}\n"],"names":["containsKey","removeKey","useRef","useCallback","getIsSelectionPending"],"mappings":";;;;;;;AAAA;;;;;;AAMG;AAOH,MAAM,YAAY,GAAG,CACnB,KAAiC,EACjC,YAAgD,EAChD,YAAqB,EACrB,iBAAoC,EACpC,mBAA4B,EAC5B,QAA+C,KAC7C;IACF,MAAM,OAAO,GAAG,YAAY,CAAC,KAAK,CAAC,MAAqB,CAAC,CAAC;AAC1D,IAAA,IAAI,OAAO,IAAI,IAAI,EAAE;QACnB,OAAO;KACR;IAED,MAAM,QAAQ,GAAGA,gBAAW,CAAC,YAAY,EAAE,OAAO,CAAC,CAAC;IACpD,IAAI,MAAM,GAAG,YAAY,CAAC;IAC1B,IAAI,CAAC,QAAQ,EAAE;;AAEb,QAAA,MAAM,GAAG,EAAE,GAAG,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,EAAE,CAAC;KACnD;AAAM,SAAA,IAAK,KAAuB,CAAC,GAAG,KAAK,OAAO,EAAE;;QAEnD,IACE,iBAAiB,KAAK,QAAQ;AAC9B,YAAA,KAAK,CAAC,OAAO;AACb,YAAA,KAAK,CAAC,OAAO;AACZ,YAAA,KAAuB,CAAC,GAAG,KAAK,GAAG,EACpC;;;YAGA,MAAM,GAAGC,cAAS,CAAC,YAAY,EAAE,OAAO,EAAE,mBAAmB,CAAC,CAAC;SAChE;KACF;;;AAID,IAAA,IAAI,YAAY,IAAI,MAAM,IAAI,QAAQ,EAAE;AACtC,QAAA,QAAQ,CAAC,EAAE,KAAK,EAAE,MAAM,EAAE,MAAM,EAAE,KAAK,CAAC,MAAM,EAAE,CAAC,CAAC;AAClD,QAAA,IAAI,KAAK,CAAC,IAAI,KAAK,OAAO,EAAE;YAC1B,KAAK,CAAC,eAAe,EAAE,CAAC;SACzB;KACF;AACH,CAAC,CAAC;AAEF;;;;;;;;;;;AAWG;AACG,SAAU,kBAAkB,CAChC,YAAgD,EAChD,YAAqB,EACrB,mBAA4B,EAC5B,iBAAoC,EACpC,QAA+C,EAAA;AAE/C,IAAA,MAAM,iBAAiB,GAAGC,YAAM,CAAU,KAAK,CAAC,CAAC;AAEjD,IAAA,MAAM,OAAO,GAAGC,iBAAW,CACzB,CAAC,KAAiB,KAAI;AACpB,QAAA,IAAI,CAACC,wCAAqB,EAAE,EAAE;YAC5B,YAAY,CACV,KAAK,EACL,YAAY,EACZ,YAAY,EACZ,iBAAiB,CAAC,OAAO,GAAG,QAAQ,GAAG,iBAAiB,EACxD,mBAAmB,EACnB,QAAQ,CACT,CAAC;SACH;AACH,KAAC,EACD,CAAC,YAAY,EAAE,YAAY,EAAE,mBAAmB,EAAE,iBAAiB,EAAE,QAAQ,CAAC,CAC/E,CAAC;;AAGF,IAAA,MAAM,OAAO,GAAGD,iBAAW,CACzB,CAAC,KAAoB,KAAI;;AAEvB,QAAA,IAAI,KAAK,CAAC,GAAG,KAAK,GAAG,IAAI,KAAK,CAAC,GAAG,KAAK,OAAO,EAAE;AAC9C,YAAA,YAAY,CACV,KAAK,EACL,YAAY,EACZ,YAAY,EACZ,iBAAiB,EACjB,mBAAmB,EACnB,QAAQ,CACT,CAAC;SACH;AACH,KAAC,EACD,CAAC,YAAY,EAAE,YAAY,EAAE,iBAAiB,EAAE,mBAAmB,EAAE,QAAQ,CAAC,CAC/E,CAAC;AAEF,IAAA,MAAM,cAAc,GAAG,QAAQ,IAAI,IAAI,GAAG,EAAE,GAAG,EAAE,OAAO,EAAE,OAAO,EAAE,CAAC;IACpE,OAAO,EAAE,cAAc,EAAE,CAAC;AAC5B;;;;"}
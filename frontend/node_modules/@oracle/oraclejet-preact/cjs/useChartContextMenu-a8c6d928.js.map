{"version":3,"file":"useChartContextMenu-a8c6d928.js","sources":["../../src/hooks/PRIVATE_useChartContextMenu/contextMenuUtils.ts","../../src/hooks/PRIVATE_useChartContextMenu/useChartContextMenu.ts"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { GroupLevelItem } from '#PRIVATE_Axis/groupAxis/hierarchicalUtils';\nimport type { ChartSeriesData, Info, ChartContextMenuContext } from '#utils/UNSAFE_visTypes/chart';\nimport { getInfo } from '#utils/UNSAFE_visUtils';\nimport type { RefObject } from 'preact';\n\nexport function getChartContextMenuContext<K, D>(\n  focusedItemInfo: Info,\n  focusedGroupInfo: Info,\n  gesture: 'mouse' | 'touch' | 'keyboard',\n  target: HTMLElement,\n  series: ChartSeriesData<K, D>[],\n  levelsArray: GroupLevelItem[][],\n  rootRef: RefObject<HTMLElement>,\n  xAxisTitle?: string,\n  yAxisTitle?: string,\n  getDataItem?: (seriesIndex: number, groupIndex: number, groupPath: number[]) => D | undefined\n) {\n  let seriesIndex;\n  let groupIndex;\n  let levelIndex;\n  if (gesture === 'keyboard') {\n    //We find the element where the position of the menu is going to be based of\n    groupIndex = focusedItemInfo.groupIndex;\n    seriesIndex = focusedItemInfo.seriesIndex;\n    levelIndex = focusedGroupInfo.levelIndex;\n  } else {\n    //We search for the key using the target of the event\n    const info = getInfo(rootRef, target);\n    seriesIndex = info ? info.seriesIndex : undefined;\n    groupIndex = info ? info.groupIndex : undefined;\n    levelIndex = info ? info.levelIndex : undefined;\n  }\n  let context;\n  if (seriesIndex !== undefined && groupIndex !== undefined && getDataItem) {\n    const groupPath = levelsArray[levelsArray.length - 1]?.[groupIndex]?.path;\n    const data = getDataItem(seriesIndex, groupIndex, groupPath);\n    context = {\n      data,\n      groupIndex,\n      seriesIndex,\n      type: 'item'\n    };\n  } else if (seriesIndex !== undefined) {\n    context = {\n      data: series[seriesIndex],\n      type: 'series'\n    };\n  } else if (groupIndex !== undefined && levelIndex != undefined) {\n    context = {\n      data: levelsArray[levelIndex]?.[groupIndex],\n      type: 'xAxisTickLabel'\n    };\n  } else {\n    const target = event?.target as HTMLElement;\n    const text = target?.textContent;\n    if ((text && gesture !== 'keyboard' && text === xAxisTitle) || text === yAxisTitle) {\n      context = {\n        type: 'axisTitle',\n        axis: text === xAxisTitle ? 'x' : 'y'\n      };\n    } else {\n      context = {\n        type: 'background'\n      };\n    }\n  }\n  return {\n    context: context as ChartContextMenuContext<K, D>\n  };\n}\n","/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\nimport type { BarSeriesData } from '#UNSAFE_BarChart/barChart.types';\nimport type { LineAreaSeriesData } from '#UNSAFE_LineAreaChart/lineAreaChart.types';\nimport type { RefObject } from 'preact';\nimport type {\n  ChartContextMenuContext,\n  ChartContextMenuConfig,\n  Info\n} from '#utils/UNSAFE_visTypes/chart';\nimport { type gestureTypes, useContextMenu } from '#hooks/PRIVATE_useVisContextMenu';\nimport { getChartContextMenuContext } from './contextMenuUtils';\nimport { calculateOffset } from '#utils/PRIVATE_visLayoutUtils/layoutUtils';\nimport { Dimension } from '#utils/UNSAFE_visTypes/common';\nimport { GroupLevelItem } from '#PRIVATE_Axis/groupAxis/hierarchicalUtils';\n\ntype Props<K, D> = {\n  series: (BarSeriesData<K, D> | LineAreaSeriesData<K, D>)[];\n  levelsArray: GroupLevelItem[][];\n  isRtl: boolean;\n  width: number;\n  height: number;\n  getDataItemPosition: (seriesIndex: number, groupIndex: number) => Dimension | undefined;\n  getDataItem: (seriesIndex: number, groupIndex: number, groupPath: number[]) => D | undefined;\n  focusedItemInfo: Info;\n  focusedGroupInfo: Info;\n  rootRef: RefObject<HTMLDivElement>;\n  xAxisTitle?: string;\n  yAxisTitle?: string;\n  contextMenuConfig?: ChartContextMenuConfig<K, D>;\n  onContextMenuDismissed?: (gesture: gestureTypes) => void;\n};\n\nexport const useChartContextMenu = <K extends string | number, D>({\n  isRtl,\n  width,\n  getDataItemPosition,\n  getDataItem,\n  focusedItemInfo,\n  focusedGroupInfo,\n  series,\n  levelsArray,\n  rootRef,\n  xAxisTitle,\n  yAxisTitle,\n  contextMenuConfig,\n  onContextMenuDismissed\n}: Props<K, D>) => {\n  const { contextMenuProps, contextMenuContent } = useContextMenu<ChartContextMenuContext<K, D>>({\n    onContextMenuHandler: ({ gesture, target }) => {\n      const { context } = getChartContextMenuContext<K, D>(\n        focusedItemInfo,\n        focusedGroupInfo,\n        gesture,\n        target as HTMLElement,\n        series,\n        levelsArray,\n        rootRef,\n        xAxisTitle,\n        yAxisTitle,\n        getDataItem\n      );\n      if (gesture === 'keyboard' && context.type === 'item') {\n        const elementBounds = focusedItemInfo?.isCurrent\n          ? getDataItemPosition(focusedItemInfo.seriesIndex!, focusedItemInfo.groupIndex!)\n          : undefined;\n        const offsetValue = calculateOffset(isRtl, width, elementBounds);\n        return {\n          type: 'offset',\n          context,\n          offsetValue,\n          isRtl,\n          width\n        };\n      }\n      return { type: 'pointer', context };\n    },\n    contextMenuOptions: {\n      isDisabled: !contextMenuConfig //If there is not a context menu renderer we disable the hook\n    },\n    rootRef,\n    contextMenuConfig,\n    onContextMenuDismissed\n  });\n\n  return { contextMenuContent, contextMenuProps };\n};\n"],"names":["getInfo","useContextMenu","calculateOffset"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;AAMG;AAOG,SAAU,0BAA0B,CACxC,eAAqB,EACrB,gBAAsB,EACtB,OAAuC,EACvC,MAAmB,EACnB,MAA+B,EAC/B,WAA+B,EAC/B,OAA+B,EAC/B,UAAmB,EACnB,UAAmB,EACnB,WAA6F,EAAA;AAE7F,IAAA,IAAI,WAAW,CAAC;AAChB,IAAA,IAAI,UAAU,CAAC;AACf,IAAA,IAAI,UAAU,CAAC;AACf,IAAA,IAAI,OAAO,KAAK,UAAU,EAAE;;AAE1B,QAAA,UAAU,GAAG,eAAe,CAAC,UAAU,CAAC;AACxC,QAAA,WAAW,GAAG,eAAe,CAAC,WAAW,CAAC;AAC1C,QAAA,UAAU,GAAG,gBAAgB,CAAC,UAAU,CAAC;KAC1C;SAAM;;QAEL,MAAM,IAAI,GAAGA,mBAAO,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;AACtC,QAAA,WAAW,GAAG,IAAI,GAAG,IAAI,CAAC,WAAW,GAAG,SAAS,CAAC;AAClD,QAAA,UAAU,GAAG,IAAI,GAAG,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;AAChD,QAAA,UAAU,GAAG,IAAI,GAAG,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;KACjD;AACD,IAAA,IAAI,OAAO,CAAC;IACZ,IAAI,WAAW,KAAK,SAAS,IAAI,UAAU,KAAK,SAAS,IAAI,WAAW,EAAE;AACxE,QAAA,MAAM,SAAS,GAAG,WAAW,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,UAAU,CAAC,EAAE,IAAI,CAAC;QAC1E,MAAM,IAAI,GAAG,WAAW,CAAC,WAAW,EAAE,UAAU,EAAE,SAAS,CAAC,CAAC;AAC7D,QAAA,OAAO,GAAG;YACR,IAAI;YACJ,UAAU;YACV,WAAW;AACX,YAAA,IAAI,EAAE,MAAM;SACb,CAAC;KACH;AAAM,SAAA,IAAI,WAAW,KAAK,SAAS,EAAE;AACpC,QAAA,OAAO,GAAG;AACR,YAAA,IAAI,EAAE,MAAM,CAAC,WAAW,CAAC;AACzB,YAAA,IAAI,EAAE,QAAQ;SACf,CAAC;KACH;SAAM,IAAI,UAAU,KAAK,SAAS,IAAI,UAAU,IAAI,SAAS,EAAE;AAC9D,QAAA,OAAO,GAAG;YACR,IAAI,EAAE,WAAW,CAAC,UAAU,CAAC,GAAG,UAAU,CAAC;AAC3C,YAAA,IAAI,EAAE,gBAAgB;SACvB,CAAC;KACH;SAAM;AACL,QAAA,MAAM,MAAM,GAAG,KAAK,EAAE,MAAqB,CAAC;AAC5C,QAAA,MAAM,IAAI,GAAG,MAAM,EAAE,WAAW,CAAC;AACjC,QAAA,IAAI,CAAC,IAAI,IAAI,OAAO,KAAK,UAAU,IAAI,IAAI,KAAK,UAAU,KAAK,IAAI,KAAK,UAAU,EAAE;AAClF,YAAA,OAAO,GAAG;AACR,gBAAA,IAAI,EAAE,WAAW;gBACjB,IAAI,EAAE,IAAI,KAAK,UAAU,GAAG,GAAG,GAAG,GAAG;aACtC,CAAC;SACH;aAAM;AACL,YAAA,OAAO,GAAG;AACR,gBAAA,IAAI,EAAE,YAAY;aACnB,CAAC;SACH;KACF;IACD,OAAO;AACL,QAAA,OAAO,EAAE,OAAwC;KAClD,CAAC;AACJ;;ACvCO,MAAM,mBAAmB,GAAG,CAA+B,EAChE,KAAK,EACL,KAAK,EACL,mBAAmB,EACnB,WAAW,EACX,eAAe,EACf,gBAAgB,EAChB,MAAM,EACN,WAAW,EACX,OAAO,EACP,UAAU,EACV,UAAU,EACV,iBAAiB,EACjB,sBAAsB,EACV,KAAI;AAChB,IAAA,MAAM,EAAE,gBAAgB,EAAE,kBAAkB,EAAE,GAAGC,6BAAc,CAAgC;QAC7F,oBAAoB,EAAE,CAAC,EAAE,OAAO,EAAE,MAAM,EAAE,KAAI;YAC5C,MAAM,EAAE,OAAO,EAAE,GAAG,0BAA0B,CAC5C,eAAe,EACf,gBAAgB,EAChB,OAAO,EACP,MAAqB,EACrB,MAAM,EACN,WAAW,EACX,OAAO,EACP,UAAU,EACV,UAAU,EACV,WAAW,CACZ,CAAC;YACF,IAAI,OAAO,KAAK,UAAU,IAAI,OAAO,CAAC,IAAI,KAAK,MAAM,EAAE;AACrD,gBAAA,MAAM,aAAa,GAAG,eAAe,EAAE,SAAS;sBAC5C,mBAAmB,CAAC,eAAe,CAAC,WAAY,EAAE,eAAe,CAAC,UAAW,CAAC;sBAC9E,SAAS,CAAC;gBACd,MAAM,WAAW,GAAGC,2BAAe,CAAC,KAAK,EAAE,KAAK,EAAE,aAAa,CAAC,CAAC;gBACjE,OAAO;AACL,oBAAA,IAAI,EAAE,QAAQ;oBACd,OAAO;oBACP,WAAW;oBACX,KAAK;oBACL,KAAK;iBACN,CAAC;aACH;AACD,YAAA,OAAO,EAAE,IAAI,EAAE,SAAS,EAAE,OAAO,EAAE,CAAC;SACrC;AACD,QAAA,kBAAkB,EAAE;AAClB,YAAA,UAAU,EAAE,CAAC,iBAAiB;AAC/B,SAAA;QACD,OAAO;QACP,iBAAiB;QACjB,sBAAsB;AACvB,KAAA,CAAC,CAAC;AAEH,IAAA,OAAO,EAAE,kBAAkB,EAAE,gBAAgB,EAAE,CAAC;AAClD;;;;"}
{"version":3,"file":"useDnd-a7d9b60c.js","sources":["../../src/hooks/PRIVATE_useVisDnd/useDnd.tsx"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\nimport { Dispatch, StateUpdater, useRef } from 'preact/hooks';\nimport type { CommonDndProps } from '#utils/UNSAFE_visTypes/common';\n\nexport type DragImageProps<DragStartDetail> = {\n  event: DragEvent;\n  target: HTMLElement;\n  context: DragStartDetail;\n};\n\ntype Props<DragStartDetail, DropDetail> = {\n  getDragContext: (target: HTMLElement, event: DragEvent) => DragStartDetail;\n  getDragImage: (props: DragImageProps<DragStartDetail>) => {\n    image: HTMLElement | SVGElement;\n    offSetX: number;\n    offSetY: number;\n    width: number;\n    height: number;\n  } | null;\n  getDropContext: (event: DragEvent) => DropDetail;\n  onPreDndStart?: (detail: DragStartDetail) => void;\n  setDatatipDisabled: Dispatch<StateUpdater<boolean>>;\n  showDropEffect?: (context: DropDetail) => void;\n  showRejectedDropEffect?: (event: DropDetail) => void;\n  clearDropEffect?: () => void;\n} & CommonDndProps<DragStartDetail, DropDetail>;\n\nexport const useDnd = <DragStartDetail, DropDetail>({\n  onDragStart,\n  onDrag,\n  onDragEnd,\n  onDragEnter,\n  onDragLeave,\n  onDragOver,\n  onDrop,\n  getDragContext,\n  getDropContext,\n  getDragImage,\n  onPreDndStart,\n  setDatatipDisabled,\n  showDropEffect = () => undefined,\n  showRejectedDropEffect = () => undefined,\n  clearDropEffect = () => undefined\n}: Props<DragStartDetail, DropDetail>) => {\n  const dragCandidate = useRef<HTMLElement | null>(null);\n  const dragImageRef = useRef<HTMLDivElement>(null);\n  const dndContent = <div ref={dragImageRef}></div>;\n  const onPointerDown = (event: PointerEvent) => {\n    dragCandidate.current = event.target as HTMLElement;\n  };\n\n  const onDndStart = (event: DragEvent) => {\n    const target = dragCandidate.current ? dragCandidate.current : (event.target as HTMLElement);\n    const context = getDragContext(target, event);\n    if (context) {\n      onPreDndStart && onPreDndStart(context);\n      setDatatipDisabled(true);\n      const dragImg = getDragImage({ event, target, context });\n      if (!dragImg) return;\n      const dragImage = dragImg.image;\n      dragImage.style.width = dragImg.width + 'px';\n      dragImage.style.height = dragImg.height + 'px';\n      // JET-69400 Drag and drop multiple nodes far apart shows wrong drag image\n      dragImage.style.left = -1 * dragImg.width + 'px';\n      dragImage.style.top = -1 * dragImg.height + 'px';\n      dragImage.style.position = 'absolute';\n      document.body.append(dragImage); // @HTMLUpdateOK will remove in next animation frame\n      event.dataTransfer?.setDragImage(dragImage, dragImg.offSetX, dragImg.offSetY);\n      window.requestAnimationFrame(() => {\n        document.body.removeChild(dragImage);\n      });\n      onDragStart && onDragStart(context);\n    } else {\n      event.preventDefault();\n    }\n  };\n\n  const onDndDrag = (event: DragEvent) => {\n    onDrag && onDrag({ event: event });\n  };\n\n  const onDndEnd = (event: DragEvent) => {\n    setDatatipDisabled(false);\n    onDragEnd && onDragEnd({ event: event });\n  };\n\n  const onDndEnter = (event: DragEvent) => {\n    const context = getDropContext(event);\n    if (onDragEnter && context) {\n      onDragEnter(context);\n      if (event.defaultPrevented) {\n        showDropEffect(context);\n      } else {\n        showRejectedDropEffect(context);\n      }\n    }\n  };\n\n  const onDndLeave = (event: DragEvent) => {\n    const context = getDropContext(event) as DropDetail;\n    onDragLeave && context && onDragLeave(context);\n    clearDropEffect();\n  };\n\n  const onDndOver = (event: DragEvent) => {\n    const context = getDropContext(event) as DropDetail;\n    if (onDragOver && context) {\n      onDragOver(context);\n      if (event.defaultPrevented) {\n        showDropEffect(context);\n      } else {\n        showRejectedDropEffect(context);\n      }\n    }\n  };\n\n  const onDndDrop = (event: DragEvent) => {\n    const context = getDropContext(event) as DropDetail;\n    onDrop && context && onDrop(context);\n    clearDropEffect();\n  };\n\n  return {\n    dragProps: {\n      onDragStart: onDndStart,\n      onDrag: onDndDrag,\n      onDragEnd: onDndEnd,\n      onPointerDown\n    },\n    dropProps: {\n      onDragEnter: onDndEnter,\n      onDragLeave: onDndLeave,\n      onDragOver: onDndOver,\n      onDrop: onDndDrop\n    },\n    content: dndContent\n  };\n};\n"],"names":["useRef","_jsx"],"mappings":"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"}
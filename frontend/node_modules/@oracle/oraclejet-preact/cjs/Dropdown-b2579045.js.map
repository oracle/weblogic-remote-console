{"version":3,"file":"Dropdown-b2579045.js","sources":["../../src/UNSAFE_Dropdown/Dropdown.tsx"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { ComponentProps, RefObject, JSX } from 'preact';\nimport { useCallback, useRef } from 'preact/hooks';\n\nimport { Floating } from '../UNSAFE_Floating';\nimport { Layer } from '../UNSAFE_Layer';\nimport { KEYS } from '../utils/PRIVATE_keyboardUtils';\nimport { focusWithin } from '../utils/PRIVATE_tabbableUtils';\nimport { usePopupAnimation } from '#UNSAFE_Popup/usePopupAnimation';\nimport { getTransformOrigin } from '#utils/PRIVATE_popupAnimationUtils';\nimport { AnimationPopupElement } from '../UNSAFE_Popup/usePopupAnimation';\nimport { CollectionInteractionContext } from '#hooks/UNSAFE_useCollectionInteractionContext';\n\nimport { dropdownStyles } from './themes/dropdownStyles.css';\nimport { useOutsideMousedown } from '../hooks/PRIVATE_useOutsideMousedown';\nimport {\n  DURATION_LARGE,\n  SCALE_UP_FULL,\n  mergeAnimationStateObjects\n} from '#utils/PRIVATE_animationUtils';\n\nimport { UnsafeDomHandle, UNSAFE_DOM_ACCESS } from '#utils/UNSAFE_unsafeDomAccess';\n\ntype FloatingProps = ComponentProps<typeof Floating>;\n\n//Same as Menu onClose, only difference is mouseDown instead of outside click\n//Once menu consumes dropdown is going to start using mouseDown\nexport type CloseDetail = { reason: 'dismissed' } | { reason: 'outsideMousedown'; target: Element };\n\ntype IntrinsicProps = Pick<JSX.HTMLAttributes<HTMLDivElement>, 'children'>;\n\ntype Props = IntrinsicProps & {\n  /**\n   *Specifies whether Dropdown is open.\n   * @default false\n   */\n  isOpen?: boolean;\n  /**\n   * Trigger element reference.\n   */\n  anchorRef: FloatingProps['anchorRef'];\n  /**\n   * Id of the dropdown container.\n   * Used usually for accesibility reasons.\n   */\n  id?: string;\n  /**\n   * Called when dropdown is supposed to be closed.\n   * Called when user tab/esc or mouseDown outside the dropdown.\n   */\n  onClose?: (detail: CloseDetail) => void;\n  /**\n   *Min width represented in pixels of the dropdown container.\n   */\n  minWidth?: number;\n  /**\n   * Placement of the floating element relative to its reference element.\n   */\n  placement?: FloatingProps['placement'];\n  /**\n   * Offset displaces the floating element from its core placement along the specified axes.\n   */\n  offset?: FloatingProps['offsetValue'];\n  /**\n   * Triggered when placement or coordinates are changed after collision is detected.\n   */\n  onPosition?: FloatingProps['onPosition'];\n  /**\n   * Specifies the flipping behavior along the respective axis.\n   */\n  flipOptions?: FloatingProps['flipOptions'];\n  /**\n   * Specifies the resizing behaviour for max-height and max-width of the floating component.\n   */\n  sizeOptions?: FloatingProps['sizeOptions'];\n\n  /**\n   *  Specifies the shift behavior along the respective axis\n   */\n  shiftOptions?: FloatingProps['shiftOptions'];\n  /**\n   * Specifies initial focus.\n   * @default 'none'\n   */\n  initialFocus?: 'none' | 'firstFocusable';\n};\n\nconst DEFAULT_PLACEMENT = 'bottom-start';\nconst DEFAULT_OFFSET = { mainAxis: 4, crossAxis: 0 };\nconst DEFAULT_SIZE_OPTIONS = { isMaxWidthAdjusted: true, isMaxHeightAdjusted: true };\nconst DEFAULT_FLIP_OPTIONS = { mainAxis: true, crossAxis: true };\n\nconst animationStates: Parameters<typeof usePopupAnimation>[0]['animationStates'] = {\n  opening: (node: AnimationPopupElement) => {\n    return mergeAnimationStateObjects(\n      [\n        SCALE_UP_FULL,\n        {\n          from: { transformOrigin: getTransformOrigin(node.placement, node.direction) },\n          to: { transformOrigin: getTransformOrigin(node.placement, node.direction) }\n        }\n      ],\n      {\n        duration: DURATION_LARGE\n      }\n    );\n  }\n};\n\n//TODO: Add animation to dropdown. JET-62628\n//TODO: Investigate best approach to have different virtual padding depending on the position and implement it.JET-57950\nexport function Dropdown({\n  isOpen = false,\n  anchorRef,\n  children,\n  id,\n  onClose,\n  minWidth,\n  placement = DEFAULT_PLACEMENT,\n  offset = DEFAULT_OFFSET,\n  onPosition,\n  flipOptions = DEFAULT_FLIP_OPTIONS,\n  sizeOptions = DEFAULT_SIZE_OPTIONS,\n  shiftOptions,\n  initialFocus = 'none'\n}: Props) {\n  const dropdownRef = useRef<HTMLDivElement>(null);\n\n  const onTransitionEnd = useCallback(\n    (isOpen: boolean) => {\n      if (isOpen && initialFocus === 'firstFocusable') {\n        const dropdownElement = dropdownRef.current;\n        if (dropdownElement) {\n          focusWithin(dropdownElement);\n        }\n      }\n    },\n    [initialFocus]\n  );\n\n  const {\n    status,\n    setAnimationElementRef,\n    onPosition: onPositionAnimated\n  } = usePopupAnimation({\n    isOpen,\n    placement,\n    isAnimatedOnMount: true,\n    animationStates,\n    onPosition,\n    onTransitionEnd\n  });\n\n  const handleMousedownClose = useCallback(\n    (event: MouseEvent) => {\n      onClose?.({ reason: 'outsideMousedown', target: event.target as Element });\n    },\n    [onClose]\n  );\n\n  const handleKeyDown = useCallback(\n    (event: KeyboardEvent) => {\n      if (event.defaultPrevented) {\n        return;\n      }\n      switch (event.code) {\n        case KEYS.ESC:\n          onClose?.({ reason: 'dismissed' });\n          break;\n        case KEYS.TAB:\n          onClose?.({ reason: 'dismissed' });\n          break;\n        default:\n          break;\n      }\n    },\n    [onClose]\n  );\n\n  // use the mousedown event to be consistent with legacy JET\n  useOutsideMousedown({\n    isDisabled: false,\n    ref: [dropdownRef],\n    handler: handleMousedownClose\n  });\n\n  return (\n    <>\n      {status !== 'unmounted' ? (\n        <Layer logicalParentRef={toLogicalParentRef(anchorRef)}>\n          <Floating\n            anchorRef={anchorRef}\n            ref={setAnimationElementRef}\n            placement={placement}\n            flipOptions={flipOptions}\n            shiftOptions={shiftOptions}\n            sizeOptions={sizeOptions}\n            offsetValue={offset}\n            onPosition={onPositionAnimated}\n            boundaryOptions={{ padding: { top: 8, bottom: 8, left: 0, right: 0 } }}>\n            <div\n              ref={dropdownRef}\n              id={id}\n              class={dropdownStyles.base}\n              style={{ minWidth: `${minWidth || 0}px` }}\n              onKeyDown={handleKeyDown}>\n              <CollectionInteractionContext.Provider value={'embedded'}>\n                {children}\n              </CollectionInteractionContext.Provider>\n            </div>\n          </Floating>\n        </Layer>\n      ) : null}\n    </>\n  );\n}\n\nfunction toLogicalParentRef(anchorRef: FloatingProps['anchorRef']) {\n  const current = anchorRef.current;\n\n  if (current) {\n    if (current instanceof Element) {\n      return anchorRef as RefObject<Element>;\n    } else if ((current as UnsafeDomHandle<Element>)[UNSAFE_DOM_ACCESS]) {\n      return anchorRef as RefObject<UnsafeDomHandle<Element>>;\n    }\n  }\n\n  return null;\n}\n"],"names":["mergeAnimationStateObjects","SCALE_UP_FULL","getTransformOrigin","DURATION_LARGE","useRef","useCallback","focusWithin","usePopupAnimation","KEYS","useOutsideMousedown","_jsx","_Fragment","Layer","Floating","dropdownStyles","CollectionInteractionContext","UNSAFE_DOM_ACCESS"],"mappings":"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"}
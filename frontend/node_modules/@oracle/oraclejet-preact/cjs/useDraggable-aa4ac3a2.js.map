{"version":3,"file":"useDraggable-aa4ac3a2.js","sources":["../../src/hooks/PRIVATE_useDraggable/useDraggable.ts"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { useCallback, useRef } from 'preact/hooks';\nimport type { RefObject } from 'preact';\nimport { getContainingBlockElem } from '../../utils/PRIVATE_floatingUtils';\nimport { Position, Rect } from '../../utils/UNSAFE_flexibleComponentUtils';\n\nexport type DraggableProps = {\n  onMouseDown?: (event: MouseEvent) => void;\n  onMouseEnter?: (event: MouseEvent) => void;\n  onMouseLeave?: (event: MouseEvent) => void;\n};\n\ntype useDraggableProps = {\n  isDisabled?: boolean;\n  containerRef?: RefObject<HTMLElement>;\n  onDragStart?: (pos: Position) => void;\n  onDragMove?: (pos: Position) => void;\n  onDragEnd?: (pos: Position) => void;\n};\n\n/**\n * A hook with draggable implementation.\n * Returns event handlers that can enhance the target element with drag capability.\n *\n * @param isDisabled determines if the hook is disabled\n * @returns an object with the 'draggableProps' properties.\n */\nexport function useDraggable({\n  isDisabled = false,\n  containerRef,\n  onDragMove,\n  onDragStart,\n  onDragEnd\n}: useDraggableProps): {\n  draggableProps: DraggableProps;\n} {\n  const isDragging = useRef<boolean>(false);\n  const startPosition = useRef<Position>();\n  const offset = useRef<Position>({ x: 0, y: 0 });\n  const initialMousePosition = useRef<Position>({ x: 0, y: 0 });\n  const initialClientRect = useRef<Rect>({ x: 0, y: 0, width: 0, height: 0 });\n\n  const constrainPos = useCallback(\n    (x: number, y: number): Position => {\n      const elem = containerRef?.current;\n\n      const pos = { x, y };\n      if (!elem) return pos;\n\n      const containingBlock = getContainingBlockElem(elem);\n\n      const boundingRect = containingBlock?.getBoundingClientRect();\n      const dialogRect = elem.getBoundingClientRect();\n\n      const limitLeft = boundingRect ? boundingRect.left : 0;\n      const limitTop = boundingRect ? boundingRect.top : 0;\n      const limitRight = boundingRect ? boundingRect.right : window.innerWidth;\n      const limitBottom = boundingRect ? boundingRect.bottom : window.innerHeight;\n\n      if (pos.x < limitLeft) {\n        pos.x = limitLeft;\n      }\n      if (pos.x + dialogRect.width > limitRight) {\n        pos.x = limitRight - dialogRect.width;\n      }\n      if (pos.y < limitTop) {\n        pos.y = limitTop;\n      }\n      if (pos.y + dialogRect.height > limitBottom) {\n        pos.y = limitBottom - dialogRect.height;\n      }\n      return pos;\n    },\n    [containerRef]\n  );\n\n  /**\n   * Handles the mousemove events while the dragging is activated\n   */\n  const handleDrag = useCallback(\n    (event: MouseEvent) => {\n      if (!isDragging.current || !startPosition.current) return;\n\n      const left = event.pageX - initialMousePosition.current.x;\n      const top = event.pageY - initialMousePosition.current.y;\n\n      const newPos = constrainPos(\n        initialClientRect.current.x + left,\n        initialClientRect.current.y + top\n      );\n\n      event.stopPropagation();\n      event.preventDefault();\n\n      onDragMove?.({\n        x: newPos.x,\n        y: newPos.y\n      });\n    },\n    [onDragMove, constrainPos]\n  );\n\n  /**\n   * handles the drag end\n   */\n  const endDrag = useCallback(\n    (event: MouseEvent) => {\n      if (!isDragging.current || !startPosition.current) return;\n\n      isDragging.current = false;\n\n      const left = event.pageX - initialMousePosition.current.x;\n      const top = event.pageY - initialMousePosition.current.y;\n\n      const newPos = constrainPos(\n        initialClientRect.current.x + left,\n        initialClientRect.current.y + top\n      );\n\n      document.removeEventListener('mousemove', handleDrag, true);\n      document.removeEventListener('mouseup', endDrag, true);\n\n      event.preventDefault();\n      event.stopPropagation();\n\n      onDragEnd?.({\n        x: newPos.x,\n        y: newPos.y\n      });\n    },\n    [onDragEnd, handleDrag, constrainPos]\n  );\n\n  /**\n   * handles the start of dragging\n   */\n  const startDrag = useCallback(\n    (event: MouseEvent) => {\n      const findPos = (element: Element) => {\n        let elem = element as HTMLElement;\n        let curLeft = 0;\n        let curTop = 0;\n        if (elem.offsetParent) {\n          do {\n            curLeft += elem.offsetLeft;\n            curTop += elem.offsetTop;\n          } while ((elem = elem.offsetParent as HTMLElement));\n        }\n        return { left: curLeft, top: curTop };\n      };\n\n      const elem = event.currentTarget as HTMLElement;\n\n      if (!elem) return;\n\n      const pos = findPos(elem);\n\n      isDragging.current = true;\n\n      elem.style.cursor = 'move';\n\n      document.addEventListener('mousemove', handleDrag, true);\n      document.addEventListener('mouseup', endDrag, true);\n\n      startPosition.current = { x: pos.left, y: pos.top };\n      offset.current.x = event.offsetX;\n      offset.current.y = event.offsetY;\n      initialMousePosition.current = { x: event.pageX, y: event.pageY };\n      initialClientRect.current = elem.getBoundingClientRect();\n\n      onDragStart?.({\n        x: initialClientRect.current.x,\n        y: initialClientRect.current.y\n      });\n    },\n    [onDragStart, endDrag, handleDrag]\n  );\n\n  /**\n   * mouseenter event handler to change the mouse cursor when the drag sensitive area is hovered\n   */\n  const mouseEnter = useCallback(\n    (event: MouseEvent) => {\n      if (isDisabled) return;\n      const elem = event.currentTarget as HTMLElement;\n      if (elem) {\n        elem.style.cursor = 'move';\n      }\n    },\n    [isDisabled]\n  );\n\n  /**\n   * mouseleave event handler to restore the mouse cursor when the drag sensitive area is left\n   */\n  const mouseLeave = useCallback(\n    (event: MouseEvent) => {\n      if (isDisabled) return;\n      const elem = event.currentTarget as HTMLElement;\n      if (elem) {\n        elem.style.cursor = 'auto';\n      }\n    },\n    [isDisabled]\n  );\n\n  // return object\n  const draggableProps = isDisabled\n    ? {}\n    : {\n        onMouseDown: startDrag,\n        onMouseEnter: mouseEnter,\n        onMouseLeave: mouseLeave\n      };\n\n  return {\n    draggableProps: draggableProps\n  };\n}\n"],"names":["useRef","useCallback","getContainingBlockElem"],"mappings":"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"}
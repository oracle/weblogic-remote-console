{"version":3,"file":"clientHints-c40c5250.js","sources":["../../src/utils/PRIVATE_clientHints/clientHints.ts"],"sourcesContent":["// Typescript does not support NavigatorUAData in its DOM lib,\n// therefore we declare our own type - see:\n//    https://wicg.github.io/ua-client-hints/#interface\ntype NavigatorUAData = {\n  brands: Array<{ brand: string; version: string }>;\n  mobile: boolean;\n  platform: string;\n};\n\n// Enum types\ntype ClientBrowser = 'chrome' | 'edge' | 'firefox' | 'safari' | 'unknown';\n\ntype ClientDeviceType = 'phone' | 'tablet' | 'unknown';\n\ntype ClientPlatform = 'android' | 'ios' | 'mac' | 'windows' | 'unknown';\n\ntype ClientTouchSupport = 'none' | 'primary' | 'secondary' | 'unknown';\n\ntype ClientHoverSupport = 'none' | 'pseudo-classes' | 'events' | 'unknown';\n\nexport type ClientHints = {\n  browser: ClientBrowser;\n  browserMajorVersion: number;\n  deviceType: ClientDeviceType;\n  platform: ClientPlatform;\n  touchSupport: ClientTouchSupport;\n  hoverSupport: ClientHoverSupport;\n  deviceRenderMode: ClientDeviceType; // app override of component render mode based on device (defaults to 'deviceType')\n};\n\nconst defaultClientHintValues: Partial<ClientHints> = {\n  browser: 'unknown',\n  browserMajorVersion: -1,\n  deviceType: 'unknown',\n  platform: 'unknown',\n  touchSupport: 'unknown',\n  hoverSupport: 'unknown'\n};\n\nfunction createDefaultClientHints(): ClientHints {\n  const hints = { ...defaultClientHintValues };\n  return Object.defineProperty(hints, 'deviceRenderMode', {\n    enumerable: true,\n    get() {\n      return getDeviceTypeOverride() ?? this.deviceType;\n    }\n  }) as ClientHints;\n}\n\nlet cachedClientHints: ClientHints;\n\nexport function getClientHints(uaString?: string): Readonly<ClientHints> {\n  // Compute if there is no cached result, OR if a UserAgent string\n  //  was passed in as an argument\n  if (cachedClientHints === undefined || uaString) {\n    let hints: ClientHints;\n\n    if (uaString) {\n      // Compute hints based upon a one-off UserAgent string\n      // without touching the cache\n      hints = createHintsFromUserAgentString(uaString);\n      return hints;\n    } else {\n      // NOTE:  userAgentData only available from modern Chromium-based browsers\n      //        executing in a secure context - otherwise, fall back to processing\n      //        the system UserAgent string\n      const userAgentData = (navigator as any)?.['userAgentData'] as NavigatorUAData;\n      hints = userAgentData\n        ? createHintsFromUserAgentData(userAgentData)\n        : createHintsFromUserAgentString(navigator?.userAgent ?? '');\n\n      // Since the hints were computed from Navigator properties:\n      //    * determine touchSupport, hoverSupport\n      //    * cache the results\n      // NOTE:  Order is important (determination of hoverSupport depends upon touchSupport)\n      determineTouchSupport(hints);\n      determineHoverSupport(hints);\n      cachedClientHints = hints;\n      Object.freeze(cachedClientHints);\n    }\n  }\n  return cachedClientHints;\n}\n\nfunction createHintsFromUserAgentData(userAgentData: NavigatorUAData): Readonly<ClientHints> {\n  const hints = createDefaultClientHints();\n\n  // Loop through brands => browser, browserMajorVersion\n  for (const item of userAgentData.brands) {\n    const brand = item.brand.toLowerCase();\n    if (brand.indexOf('chrome') > -1) {\n      hints.browser = 'chrome';\n    } else if (brand.indexOf('edge') > -1) {\n      hints.browser = 'edge';\n    }\n    if (hints.browser !== 'unknown') {\n      hints.browserMajorVersion = Number(item.version);\n      break;\n    }\n  }\n\n  // Set deviceType, platform\n  const platform = userAgentData.platform.toLowerCase();\n  if (platform === 'windows') {\n    hints.platform = 'windows';\n  } else if (platform === 'android') {\n    hints.platform = 'android';\n    hints.deviceType = userAgentData.mobile ? 'phone' : 'tablet';\n  } else if (platform === 'macos') {\n    hints.platform = 'mac';\n  }\n  // TODO: Verify userAgentData support in Chrome on iPhone/iPad when available\n  /*\n  else if (platform.indexOf('iphone') > -1) {\n    hints.platform = 'ios';\n    hints.deviceType = 'phone';\n  } else if (platform.indexOf('ipad') > -1) {\n    hints.platform = 'ios';\n    hints.deviceType = 'tablet';\n  } else if (platform.indexOf('ios') > -1) {\n    hints.platform = 'ios';\n    hints.deviceType = (userAgentData.mobile ? 'phone' : 'tablet');\n  }\n  */\n  return hints;\n}\n\nfunction createHintsFromUserAgentString(userAgent: string): Readonly<ClientHints> {\n  const hints = createDefaultClientHints();\n\n  // Normalize the userAgent string\n  userAgent = userAgent.toLowerCase();\n\n  // Check platform, deviceType\n  if (userAgent.indexOf('iphone') > -1) {\n    hints.platform = 'ios';\n    hints.deviceType = 'phone';\n  } else if (\n    userAgent.indexOf('ipad') > -1 ||\n    // handle iPad/iPhone safari requesting desktop version of site\n    (userAgent.indexOf('macintosh') > -1 && navigator?.maxTouchPoints > 0)\n  ) {\n    hints.platform = 'ios';\n    hints.deviceType = 'tablet';\n  } else if (userAgent.indexOf('macintosh') > -1) {\n    hints.platform = 'mac';\n  } else if (userAgent.indexOf('android') > -1) {\n    hints.platform = 'android';\n    // add check for device type (based upon legacy AgentUtils logic)\n    hints.deviceType = userAgent.indexOf('mobile') > -1 ? 'phone' : 'tablet';\n  } else if (userAgent.indexOf('windows') > -1) {\n    hints.platform = 'windows';\n  }\n\n  // Now work on browser, browserMajorVersion\n  if (userAgent.indexOf('edg') > -1) {\n    hints.browser = 'edge';\n    hints.browserMajorVersion = parseMajorVersion(userAgent, /edg\\/(\\d+)/);\n  } else if (userAgent.indexOf('chrome') > -1) {\n    hints.browser = 'chrome';\n    hints.browserMajorVersion = parseMajorVersion(userAgent, /chrome\\/(\\d+)/);\n  } else if (userAgent.indexOf('crios') > -1) {\n    hints.browser = 'chrome';\n    hints.browserMajorVersion = parseMajorVersion(userAgent, /crios\\/(\\d+)/);\n  } else if (userAgent.indexOf('fxios') > -1) {\n    hints.browser = 'firefox';\n    hints.browserMajorVersion = parseMajorVersion(userAgent, /fxios\\/(\\d+)/);\n  } else if (userAgent.indexOf('firefox') > -1) {\n    hints.browser = 'firefox';\n    hints.browserMajorVersion = parseMajorVersion(userAgent, /rv:(\\d+)/);\n  } else if (userAgent.indexOf('safari') > -1) {\n    hints.browser = 'safari';\n    hints.browserMajorVersion = parseMajorVersion(userAgent, /version\\/(\\d+)/);\n  }\n\n  return hints;\n}\n\nfunction parseMajorVersion(userAgent: string, majorVersionPattern: RegExp): number {\n  let majorVer;\n  const matches = userAgent.match(majorVersionPattern);\n  if (matches) {\n    const majorVerString = matches[1];\n    if (majorVerString) {\n      majorVer = parseInt(majorVerString);\n    }\n  }\n  return majorVer ?? -1;\n}\n\nfunction determineTouchSupport(hints: ClientHints): void {\n  // if no global window object, or if ontouchstart handler not supported & no touch points,\n  // then no touch support\n  if (\n    typeof window === 'undefined' ||\n    (!('ontouchstart' in window) && navigator.maxTouchPoints === 0)\n  ) {\n    hints.touchSupport = 'none';\n  }\n  // otherwise if primary input pointer is 'coarse', then touch is the primary input method\n  else if (window.matchMedia?.('(pointer: coarse)').matches) {\n    hints.touchSupport = 'primary';\n  }\n  // otherwise if ANY input pointer is 'coarse', then touch is a secondary input method\n  else if (window.matchMedia?.('(any-pointer: coarse)').matches) {\n    hints.touchSupport = 'secondary';\n  }\n\n  // NOTES:\n  //  - Pixel 7 devices have a bug (https://bugs.chromium.org/p/chromium/issues/detail?id=1384181) whereby\n  //    ALL pointer media queries return 'fine', causing us to report hints.touchSupport as 'unknown'.\n}\n\nfunction determineHoverSupport(hints: ClientHints): void {\n  // if no global window object, or if primary input does not support hover, then specify no hover support\n  if (typeof window === 'undefined' || window.matchMedia?.('(hover: none)').matches) {\n    hints.hoverSupport = 'none';\n  }\n  // otherwise primary input must support hover - if there is some level of touch support and the primary\n  // input pointer is 'fine' (indicating the presence of a hover-able pointer), then component code\n  // should use event listeners to implement hover support\n  else if (hints.touchSupport !== 'none' && window.matchMedia?.('(pointer: fine)').matches) {\n    hints.hoverSupport = 'events';\n  }\n  // otherwise specify that component code can assume native CSS support for hover\n  else {\n    hints.hoverSupport = 'pseudo-classes';\n  }\n}\n\n// Returns an application-level override for getClientHints().deviceType\n//\n// For background, see oj.Config.getDeviceRenderMode() -\n//  https://jet.oraclecorp.com/trunk/jsdocs/oj.Config.html#.getDeviceRenderMode\n//\nfunction getDeviceTypeOverride(): ClientDeviceType | null {\n  // Check whether the application has specified an override attribute on the document body\n  let deviceOverride = document.body.getAttribute('data-oj-device-render-mode');\n  if (deviceOverride && !(deviceOverride === 'phone' || deviceOverride === 'tablet')) {\n    deviceOverride = null;\n  }\n  return deviceOverride as ReturnType<typeof getDeviceTypeOverride>;\n}\n"],"names":[],"mappings":"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"}
{"version":3,"file":"ListViewAdapter.js","sources":["../../../../src/UNSAFE_ListView/__testing__/ListViewAdapter.ts"],"sourcesContent":["import { findMenu } from '#UNSAFE_Menu/__testing__';\nimport { TestDriver, Keys, TestElement, waitFor } from '@oracle/oraclejet-testing/UNSAFE_Driver';\nimport { byCss, byTestId } from '@oracle/oraclejet-testing/UNSAFE_Locators';\nimport { TestAdapter } from '@oracle/oraclejet-testing/UNSAFE_TestAdapter';\n\nexport class ListViewAdapter extends TestAdapter {\n  /**\n   * Toggles the selection state of an item.\n   * @param key The key of the item to select or de-select in the ListView\n   * @returns Promise<void> or throw error if the key is not found\n   */\n  async doToggleSelection<K extends string | number>(key: K): Promise<void> {\n    const driver = this.getTestDriver();\n    let item;\n    try {\n      item = await (\n        await this.getElement()\n      ).waitForElement(byCss(`[data-oj-key=\"${key.toString()}\"]`));\n    } catch {\n      throw new Error('The key specified is invalid or does not exist');\n    }\n    await driver.click(item!, { modifiers: [Keys['CONTROL_COMMAND']] });\n  }\n\n  /**\n   * Simulates scroll down to trigger fetching of more data\n   * Test author would use this to ensure the item is available before performing operations such as select or reorder on it.\n   * @returns Promise<void>\n   */\n  async doLoadMore(): Promise<void> {\n    const driver = this.getTestDriver();\n    const listView = await this.getElement();\n    const listItems = await listView.waitForElements(byCss('[role=\"row\"]'));\n    const itemLength = listItems.length;\n    await waitFor(async () => {\n      driver.sendKeys(listView, Keys['PAGE_DOWN']);\n      if (await listView.waitForElements(byCss('[class=\"oj-collection-loadmore\"]'))) {\n        return (await listView.waitForElements(byCss('[role=\"row\"]'))).length > itemLength;\n      }\n      return true;\n    });\n  }\n\n  /**\n   * Reorder an item in the ListView\n   * @param key The key of the item to reorder in the ListView\n   * @param position The drop position relative to the zero-based reference index or key of the item to move in front of, if the referenceKey is null, the item will move to the end of the list\n   * @returns Promise<void> or throw error if the key is not found or the position is invalid\n   */\n  async doReorder<K extends string | number>(\n    key: K,\n    position: { index: number } | { referenceKey: K | null }\n  ): Promise<void> {\n    const driver = this.getTestDriver();\n    const listView = await this.getElement();\n    const listItems = await listView.waitForElements(byCss('[role=\"row\"]'));\n    if ('index' in position && (position.index < 0 || position.index > listItems.length - 1)) {\n      throw new Error('invaild index');\n    }\n    let desIndex = -1;\n    let srcIndex = -1;\n    let item;\n    try {\n      item = await listView.waitForElement(byCss(`[data-oj-key=\"${key.toString()}\"]`));\n\n      if ('index' in position && position.index) {\n        desIndex = position.index;\n      }\n\n      //We will move the item at the end of the list when the referenceKey is null, so we need a check here.\n      if ('referenceKey' in position && position.referenceKey === null) {\n        desIndex = listItems.length;\n      }\n\n      for (let i = 0; i < listItems.length; i++) {\n        const currentKey = await listItems[i].getAttribute('data-oj-key');\n        if (currentKey === key.toString()) {\n          srcIndex = i;\n        }\n        if (\n          desIndex === -1 &&\n          'referenceKey' in position &&\n          position.referenceKey != null &&\n          currentKey === position.referenceKey.toString()\n        ) {\n          desIndex = i;\n        }\n      }\n\n      //We want to move the item in front of the the referenceKey, do the desIndex mins 1.\n      if ('referenceKey' in position && srcIndex < desIndex) {\n        desIndex--;\n      }\n\n      if (desIndex === -1 || srcIndex === -1) {\n        throw new Error('The key specified is invalid or does not exist or the index is invaild');\n      }\n      await driver.click(item!);\n      if (srcIndex < desIndex) {\n        for (let i = 0; i < desIndex - srcIndex; i++) {\n          await driver.sendKeys(listView, Keys['SHIFT'], Keys['CONTROL'], Keys['ARROW_DOWN']);\n        }\n      } else {\n        for (let i = 0; i < srcIndex - desIndex; i++) {\n          await driver.sendKeys(listView, Keys['SHIFT'], Keys['CONTROL'], Keys['ARROW_UP']);\n        }\n      }\n    } catch {\n      throw new Error('The key specified is invalid or does not exist');\n    }\n  }\n\n  /**\n   * Perform the context menu action for an item in the ListView\n   * @param key The key to the item to perform the context menu action on.\n   * @param path The path that consist of the label/key of the menu item and the label/key of the submenu that leads to the menu item.\n   * @returns Promise<void> or throw error if the key is not found or the path is invalid\n   */\n  async doContextMenuAction<K extends string | number>(\n    key: K,\n    path:\n      | { menuItemLabel: string | string[]; menuItemKey?: never }\n      | { menuItemKey: string | string[]; menuItemLabel?: never }\n  ): Promise<void> {\n    const driver = this.getTestDriver();\n    const listView = await this.getElement();\n    const testId = await listView.getAttribute('data-testid');\n    try {\n      const menu = await findContextMenu(driver, key, listView, testId);\n      return menu.doMenuAction({ label: path.menuItemLabel, key: path.menuItemKey } as Parameters<\n        (typeof menu)['doMenuAction']\n      >[0]);\n    } catch {\n      throw new Error('The key specified is invalid or does not exist');\n    }\n  }\n\n  /**\n   * Perform the context menu group action for an item in the ListView\n   * @param key The key to the item to perform the context menu action on.\n   * @param path The path that consist of the label/key of the menu item and the label/key of the submenu that leads to the menu item. If key is specified it also include item value of the select menu item that is going to be clicked.\n   * @returns Promise<void> or throw error if the key is not found or the path is invalid\n   */\n  async doContextMenuGroupAction<K extends string | number>(\n    key: K,\n    path:\n      | { menuItemLabel: string | string[]; menuItemKey?: never; menuItemValue?: never }\n      | { menuItemKey: string | string[]; menuItemValue?: string; menuItemLabel?: never }\n  ): Promise<void> {\n    const driver = this.getTestDriver();\n    const listView = await this.getElement();\n    const testId = await listView.getAttribute('data-testid');\n    try {\n      const menu = await findContextMenu(driver, key, listView, testId);\n      await menu.doMenuGroupAction({\n        label: path.menuItemLabel,\n        key: path.menuItemKey,\n        itemValue: path.menuItemValue\n      } as Parameters<(typeof menu)['doMenuGroupAction']>[0]);\n    } catch {\n      throw new Error('The key specified is invalid or does not exist');\n    }\n  }\n}\n\n// Method that to open the context menu for each list item\nconst findContextMenu = async <K extends string | number>(\n  driver: TestDriver,\n  key: K,\n  listView: TestElement,\n  testId: string | null\n) => {\n  const item = await listView.waitForElement(byCss(`[data-oj-key=\"${key.toString()}\"]`));\n  await driver.click(item!);\n  await driver.sendKeys(listView, Keys['SHIFT'], Keys['F10']);\n  await delay(100);\n  return findMenu(byTestId(testId + '-menu'));\n};\n\n// TODO: Adding a delay for now since in the first ms menu could not be present in DOM.\n// This needs to be removed once we know what we should do in this kind of use cases\nconst delay = (ms: number) =>\n  new Promise((resolve) =>\n    setTimeout(() => {\n      resolve(true);\n    }, ms)\n  );\n"],"names":["TestAdapter","byCss","Keys","waitFor","findMenu","byTestId"],"mappings":"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"}
{"version":3,"file":"useTextField-6ecf97b7.js","sources":["../../src/hooks/UNSAFE_useTextField/useTextField.ts"],"sourcesContent":["import type { ComponentProps, ContextType, JSX } from 'preact';\nimport { useCallback, useRef, useState } from 'preact/hooks';\n\nimport type { UnpackSignals } from '@oracle/oraclejet-internal-utilities/attributeUtils';\nimport { merge } from '@oracle/oraclejet-internal-utilities/stringUtils';\n\nimport { detectTruncation } from '#utils/PRIVATE_truncationUtils';\nimport type { FormVariantContext } from '#hooks/UNSAFE_useFormVariantContext';\nimport type { Label } from '#UNSAFE_Label';\nimport type { TextField } from '#UNSAFE_TextField';\nimport type { InlineUserAssistance, UserAssistanceDensityType } from '#UNSAFE_UserAssistance';\nimport { useMessageSeverity } from '../PRIVATE_useMessageSeverity';\nimport { useFocusWithin } from '../UNSAFE_useFocusWithin';\nimport { useFormFieldContextProps } from '../UNSAFE_useFormFieldContextProps';\nimport { useId } from '../UNSAFE_useId';\n\ntype InlineUserAssistanceProps = ComponentProps<typeof InlineUserAssistance>;\ntype PickedUserAssistanceProps = Pick<InlineUserAssistanceProps, 'messages'>;\n\ntype UseTextFieldProps<V> = PickedUserAssistanceProps & {\n  ariaDescribedBy?: string;\n  contentVariant?: 'input' | 'textarea';\n  helpSourceLink?: string;\n  helpSourceText?: string;\n  isDisabled?: boolean;\n  isFocused?: boolean;\n  isLoading?: boolean;\n  isReadonly?: boolean;\n  isRequiredShown?: boolean;\n  labelEdge?: ComponentProps<typeof TextField>['labelEdge'] | 'none';\n  styleVariant?: ContextType<typeof FormVariantContext>;\n  userAssistanceDensity?: UserAssistanceDensityType;\n  value?: V;\n};\n\n/**\n * A custom hook to determine the props for a component that renders\n * a text field\n */\nexport function useTextField<V>({\n  ariaDescribedBy,\n  contentVariant,\n  helpSourceLink,\n  helpSourceText,\n  isDisabled,\n  isFocused,\n  isLoading,\n  isReadonly,\n  isRequiredShown,\n  labelEdge,\n  messages,\n  styleVariant,\n  userAssistanceDensity,\n  value\n}: UseTextFieldProps<V>) {\n  const baseId = useId();\n  const labelId = labelEdge !== 'none' ? `${baseId}-label` : undefined;\n  const inputId = !isReadonly ? `${baseId}-input` : undefined;\n  const uaId = !isDisabled ? `${baseId}-ua` : undefined;\n  const helpIconId = userAssistanceDensity === 'compact' ? `${baseId}-helpIcon` : undefined;\n\n  // JET-73197: Truncated Text Enhancements for Core Pack\n  // Create a ref to the Label element. When we see focusWithin the input, measure the label\n  // to determine if the text is truncated and if so, set showTruncatedTooltip to true.\n  // If we see a blurWithin event and the input is no longer focused, set the flag to false.\n  const labelRef = useRef<HTMLLabelElement>(null);\n  const [showTruncatedTooltip, setShowTruncatedTooltip] = useState(false);\n  const onBlurWithin = useCallback(() => {\n    setShowTruncatedTooltip(false);\n  }, []);\n  const onFocusWithin = useCallback(() => {\n    const isTruncated = labelEdge === 'inside' && !isDisabled ? detectTruncation(labelRef) : false;\n    setShowTruncatedTooltip(isTruncated);\n  }, [isDisabled, labelEdge, labelRef]);\n\n  const { focusProps, isFocused: isInputFocused } = useFocusWithin({\n    isDisabled,\n    onBlurWithin,\n    onFocusWithin\n  });\n  const hasValue = value !== undefined && (typeof value !== 'string' || value !== '');\n\n  // Create the form field context\n  const formFieldContext = useFormFieldContextProps({\n    hasTruncatedLabel: showTruncatedTooltip,\n    hasValue,\n    isDisabled,\n    isFocused,\n    isInputFocused,\n    isLoading,\n    isReadonly\n  });\n\n  // Determine the highest severity from the messages\n  const messageSeverity = useMessageSeverity(messages);\n\n  // Determine the label variant\n  const labelVariant: ComponentProps<typeof Label>['variant'] =\n    labelEdge !== 'none' ? labelEdge : undefined;\n\n  return {\n    baseId,\n    formFieldContext,\n    inputProps: {\n      id: inputId,\n      'aria-describedby': merge([helpIconId, uaId, ariaDescribedBy]),\n      'aria-invalid':\n        messageSeverity === 'error'\n          ? 'true'\n          : (undefined as UnpackSignals<JSX.AriaAttributes>['aria-invalid']),\n      variant: styleVariant,\n      onBlur: focusProps?.onFocusOut,\n      onFocus: focusProps?.onFocusIn\n    },\n    labelProps: {\n      forId: inputId,\n      helpIconId,\n      helpSourceLink,\n      helpSourceText,\n      id: labelId,\n      isRequiredShown,\n      labelRef,\n      userAssistanceDensity,\n      variant: labelVariant\n    },\n    textFieldProps: {\n      contentVariant,\n      statusVariant: /error|warning/.test(messageSeverity ?? '')\n        ? (messageSeverity as 'error' | 'warning')\n        : undefined,\n      styleVariant\n    },\n    userAssistanceProps: {\n      id: uaId\n    }\n  };\n}\n"],"names":["useId","useRef","useState","useCallback","detectTruncation","useFocusWithin","useFormFieldContextProps","useMessageSeverity","merge"],"mappings":"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"}
{"version":3,"file":"Modal-0cea796e.js","sources":["../../src/UNSAFE_Modal/ModalBackdrop.tsx","../../src/UNSAFE_Modal/ModalManager.ts","../../src/UNSAFE_Modal/Modal.tsx"],"sourcesContent":["import type { JSX } from 'preact';\nimport { forwardRef, ForwardedRef } from 'preact/compat';\nimport { multiVariantStyles } from './themes/ModalStyles.css';\nimport type { UnpackSignals } from '@oracle/oraclejet-internal-utilities/attributeUtils';\n\ntype IntrinsicProps = Pick<UnpackSignals<JSX.IntrinsicElements['div']>, 'children'>;\n\ntype Props = IntrinsicProps & {\n  /**\n   * Specifies the backdrop is visible or transparent. Default is 'scrim' (visible).\n   */\n  variant?: 'scrim' | 'transparent';\n};\n\nconst ModalBackdrop = forwardRef<HTMLDivElement, Props>(\n  ({ variant = 'scrim' }, ref: ForwardedRef<HTMLDivElement | null>) => {\n    const variantClasses = multiVariantStyles({\n      backdrop: variant === 'transparent' ? 'transparent' : 'scrim'\n    });\n\n    return <div ref={ref} class={variantClasses} />;\n  }\n);\n\nexport default ModalBackdrop;\n","import { focusWithin, allTabbableElements } from '../utils/PRIVATE_tabbableUtils';\nimport { isLogicalAncestor } from '../utils/UNSAFE_popupUtils';\n\ninterface Modal {\n  modalRef?: HTMLDivElement | null;\n}\n\n/**\n * CSS property backup type.\n */\ntype StyleBackup = Array<{\n  property: string;\n  value: string;\n}>;\n\nexport default class ModalManager {\n  /**\n   * Array of ModalDescriptors managed by ModalManager\n   */\n  private modals: Modal[];\n  /**\n   * Backup of the main container's (body) CSS props potentially altered by Modal.\n   */\n  private styleBackup: StyleBackup;\n  /**\n   * A flag indicating that the ModalManager's focus handler is installed\n   */\n  private isFocusHandlerActive = false;\n\n  constructor() {\n    this.modals = [];\n    this.styleBackup = [];\n  }\n\n  /**\n   * A focus handler to keep focus in the top-most modal.\n   */\n  private focusHandler = (event: FocusEvent) => {\n    const topModal = this.getTopModal();\n    const target = event.target as HTMLElement;\n\n    // if there is an open modal and valid focus event target...\n    if (topModal && target) {\n      const modalElement = topModal.modalRef;\n      if (\n        modalElement &&\n        !modalElement.contains(target) &&\n        !isLogicalAncestor(modalElement, target) &&\n        !this._parentLayerContainsNode(modalElement, target)\n      ) {\n        // Focus is outside of the top modal container, let's try to fix it\n        const tabbableElements = allTabbableElements(modalElement);\n        if (tabbableElements.length > 0) {\n          // re-directing focus to the element inside top modal\n          focusWithin(modalElement);\n          event.preventDefault();\n          event.stopPropagation();\n        }\n      }\n    }\n  };\n\n  /**\n   * Registers a modal with ModalManager\n   *\n   * @param modal\n   * @returns\n   */\n  push(modal: Modal) {\n    const modalIndex = this._findModalIndex(modal);\n\n    if (modalIndex !== -1) {\n      // Do not try to register the same modal multiple times\n      return;\n    }\n\n    this.modals.push(modal);\n\n    // if this is the first modal in the container, block container scrolling\n    if (this.modals.length === 1) {\n      const ownerDocument = this._getOwnerDocument(modal.modalRef);\n      const scrollContainer = ownerDocument.body;\n\n      const scrollBarWidth = window.innerWidth - document.documentElement.clientWidth;\n      if (scrollBarWidth > 1) {\n        // in RTL, scrollbar is on the left\n        const scrollBarLeft =\n          Math.round(document.documentElement.getBoundingClientRect().left) +\n          document.documentElement.scrollLeft;\n\n        if (scrollBarLeft) {\n          this.styleBackup.push({\n            property: 'padding-left',\n            value: scrollContainer.style.paddingLeft\n          });\n          scrollContainer.style.paddingLeft = `${scrollBarWidth}px`;\n        } else {\n          this.styleBackup.push({\n            property: 'padding-right',\n            value: scrollContainer.style.paddingRight\n          });\n          scrollContainer.style.paddingRight = `${scrollBarWidth}px`;\n        }\n      }\n\n      this.styleBackup.push({ property: 'overflow', value: scrollContainer.style.overflow });\n      this.styleBackup.push({ property: 'overflow-x', value: scrollContainer.style.overflowX });\n      this.styleBackup.push({ property: 'overflow-y', value: scrollContainer.style.overflowY });\n\n      scrollContainer.style.overflow = 'hidden';\n    }\n\n    // also install the focus handler when the first modal becomes active\n    if (this.modals.length === 1 && !this.islegacyLayerSupportAvailable()) {\n      document.addEventListener('focus', this.focusHandler, true);\n      this.isFocusHandlerActive = true;\n    }\n  }\n\n  /**\n   * Unegisters a modal from ModalManager\n   *\n   * @param modal\n   * @returns\n   */\n  pop(modal: Modal) {\n    const modalIndex = this._findModalIndex(modal);\n\n    if (modalIndex === -1) {\n      // modal to be removed not found!'\n      return;\n    }\n\n    if (modalIndex !== this.modals.length - 1) {\n      // trying to remove modal out of order!\n      return;\n    }\n\n    // remove the focus handler when the last modal is about to be removed\n    if (this.isFocusHandlerActive && this.modals.length === 1) {\n      document.removeEventListener('focus', this.focusHandler, true);\n    }\n\n    this.modals.pop();\n\n    // if this was the last modal in the container, restore its overflow props\n    if (this.modals.length === 0) {\n      const ownerDocument = this._getOwnerDocument(modal.modalRef);\n      const scrollContainer = ownerDocument.body;\n\n      this.styleBackup.forEach(({ property, value }) => {\n        scrollContainer.style.setProperty(property, value);\n      });\n    }\n  }\n\n  isTopModal(modal: Modal): boolean {\n    return this.modals.length > 0 && this.modals[this.modals.length - 1] === modal;\n  }\n\n  getTopModal = (): Modal | null => {\n    return this.modals.length > 0 ? this.modals[this.modals.length - 1] : null;\n  };\n\n  private _findModalIndex(modal: Modal): number {\n    let index = -1;\n    this.modals.forEach((elem, idx) => {\n      if (elem === modal) {\n        index = idx;\n        return;\n      }\n    });\n    return index;\n  }\n\n  private _getOwnerDocument(node: Node | null | undefined): Document {\n    return (node && node.ownerDocument) || document;\n  }\n\n  /**\n   * Checks of the modal's layer contains the target node\n   * @param modalElement modal element\n   * @param node target node\n   * @returns true, if the modal layer contains the node\n   */\n  private _parentLayerContainsNode(modalElement: Element, node: Node): boolean {\n    const parentLayer = modalElement.closest('[data-oj-layer]');\n    if (parentLayer && parentLayer.contains(node)) {\n      return true;\n    }\n    return false;\n  }\n\n  // TODO: replace with a proper API\n  /**\n   * Checks if the legacy popup service is available\n   */\n  private islegacyLayerSupportAvailable = () => {\n    return document.getElementById('__oj_zorder_container') !== null;\n  };\n}\n","import type { JSX } from 'preact';\nimport { useEffect, useRef } from 'preact/compat';\nimport { useModal } from './hooks/useModal';\nimport { Layer } from '../UNSAFE_Layer';\nimport ModalBackdrop from './ModalBackdrop';\nimport ModalManager from './ModalManager';\nimport { baseStyle } from './themes/ModalStyles.css';\nimport type { UnpackSignals } from '@oracle/oraclejet-internal-utilities/attributeUtils';\n\n// Global ModalManager singleton instance\nconst globalModalManager = new ModalManager();\n\n/**\n * Returns an array of element's siblings.\n *\n * @param elem\n * @returns\n */\nfunction getSiblings(elem: Element): Element[] {\n  const siblings: Element[] = [];\n  let sibling = elem.previousSibling;\n  while (sibling != null) {\n    if (sibling.nodeType === 1) {\n      siblings.push(sibling as Element);\n    }\n    sibling = sibling.previousSibling;\n  }\n  sibling = elem.nextSibling;\n  while (sibling != null) {\n    if (sibling.nodeType === 1) {\n      siblings.push(sibling as Element);\n    }\n    sibling = sibling.nextSibling;\n  }\n  return siblings;\n}\n\n/**\n * Sets aria-hidden=true on Modal ancestors and siblings.\n *\n * @param modal\n * @returns An array of modified elements.\n */\nfunction setAriaHiddenOnBackgroundElements(modal: HTMLElement) {\n  if (!modal) {\n    return [];\n  }\n  const ariaHiddenElements: Element[] = [];\n  let node: Element | null = modal.parentElement as Element;\n\n  do {\n    if (!node) {\n      break;\n    }\n    const siblings = getSiblings(node);\n    siblings.forEach((elem: Element) => {\n      if (elem.tagName.toLowerCase() !== 'script' && elem.getAttribute('aria-hidden') !== 'true') {\n        ariaHiddenElements.push(elem);\n        elem.setAttribute('aria-hidden', 'true');\n      }\n    });\n    node = node.parentElement;\n  } while (node && node.tagName.toLowerCase() !== 'body');\n\n  return ariaHiddenElements;\n}\n\n/**\n * Resets the aria-hidden state on previously aria-hidden elements.\n *\n * @param elements\n */\nfunction resetAriaHiddenOnBackgroundElements(elements: Element[]) {\n  elements.forEach((elem) => {\n    elem.removeAttribute('aria-hidden');\n  });\n}\n\ntype IntrinsicProps = Pick<UnpackSignals<JSX.IntrinsicElements['div']>, 'children'>;\ntype UseModalProps = Parameters<typeof useModal>[0];\ntype Props = UseModalProps &\n  IntrinsicProps & {\n    /**\n     * Determines if the modal is active.\n     */\n    isOpen: boolean;\n    /**\n     * Specifies if modal backdrop is visible or transparent. Default is 'scrim' (visible).\n     */\n    backdropVariant?: 'scrim' | 'transparent';\n    /**\n     * A callback to be invoked when a click on the modal backdrop occurs.\n     */\n    onBackdropClick?: (event: MouseEvent) => void;\n  };\n\n/**\n * Modal is a low-level component that provides the 'modality' feature with built-in overlay (scrim).\n * It is typically used for building higher-level components (such as 'Dialog' or 'Popup') that need\n * to support modal behavior preventing interaction with the rest of the page while the modal is open.\n */\nconst Modal = ({ children, isOpen, onBackdropClick, backdropVariant }: Props) => {\n  // get the global ModalContext instance\n  const modalManager = globalModalManager;\n\n  const { backdropRef } = useModal({ isOpen, onBackdropClick });\n  // main modal element ref\n  const modalRef = useRef<HTMLDivElement>(null);\n\n  const ariaHiddenCache = useRef<Element[] | null>(null);\n\n  // modal ref cache, required to lookup the item in modal manager when the actual ref is unmounted\n  const modal = useRef<{\n    modalRef?: typeof modalRef.current;\n  }>({});\n\n  // populates and returns the modal ref cache\n  const getModal = () => {\n    modal.current.modalRef = modalRef.current;\n    return modal.current;\n  };\n\n  useEffect(() => {\n    if (isOpen && modalRef.current) {\n      modalManager?.push(getModal());\n    } else {\n      if (modal.current.modalRef) {\n        if (ariaHiddenCache.current !== null) {\n          resetAriaHiddenOnBackgroundElements(ariaHiddenCache.current);\n          ariaHiddenCache.current = null;\n        }\n        modalManager?.pop(getModal());\n      }\n    }\n  }, [isOpen, modalManager]);\n\n  useEffect(() => {\n    const modalRef = modal.current.modalRef;\n    return () => {\n      if (ariaHiddenCache.current !== null) {\n        resetAriaHiddenOnBackgroundElements(ariaHiddenCache.current);\n        ariaHiddenCache.current = null;\n      }\n      if (modalRef) {\n        modalManager?.pop(getModal());\n      }\n    };\n  }, [modalManager]);\n\n  const handleFocusIn = () => {\n    // on first focusin, set aria-hidden on modal ancestor's siblings and remember the modified elements\n    if (modalRef.current && ariaHiddenCache.current === null) {\n      ariaHiddenCache.current = setAriaHiddenOnBackgroundElements(modalRef.current);\n    }\n  };\n\n  return isOpen ? (\n    <Layer isModal={true}>\n      <div ref={modalRef} class={baseStyle} onFocus={handleFocusIn}>\n        <ModalBackdrop ref={backdropRef} variant={backdropVariant} />\n        {children}\n      </div>\n    </Layer>\n  ) : null;\n};\n\nexport default Modal;\n"],"names":["forwardRef","multiVariantStyles","_jsx","isLogicalAncestor","allTabbableElements","focusWithin","useModal","useRef","useEffect","Layer","_jsxs","baseStyle"],"mappings":"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"}
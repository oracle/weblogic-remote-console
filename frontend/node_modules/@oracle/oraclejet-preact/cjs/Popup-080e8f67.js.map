{"version":3,"file":"Popup-080e8f67.js","sources":["../../src/UNSAFE_Popup/PopupSkipLink.tsx","../../src/UNSAFE_Popup/Popup.tsx"],"sourcesContent":["import { JSX } from 'preact';\nimport { useRef } from 'preact/hooks';\nimport { HiddenAccessible } from '../UNSAFE_HiddenAccessible';\n\ntype IntrinsicProps = Pick<JSX.HTMLAttributes<HTMLDivElement>, 'children'>;\n\ntype SkipLinkProps = IntrinsicProps & {\n  message?: string;\n  callback?: () => void;\n};\n\nexport function PopupSkipLink({ message, callback }: SkipLinkProps) {\n  const hiddenAccessibleRef = useRef<HTMLDivElement | null>(null);\n\n  const handleKey = (event: KeyboardEvent) => {\n    // Prevent click generated from an \"enter\" key press by eating the event.\n    // This could only happen in some kind of simulator as this skip link is only used on the iOS platform.\n    if (event.code === 'Enter') {\n      event.stopPropagation();\n      event.preventDefault();\n    }\n  };\n\n  return (\n    <div ref={hiddenAccessibleRef}>\n      <HiddenAccessible>\n        <a\n          onClick={callback}\n          tabIndex={-1}\n          href=\"#\"\n          role=\"button\"\n          onKeyDown={handleKey}\n          onKeyUp={handleKey}\n          onKeyPress={handleKey}>\n          {message}\n        </a>\n      </HiddenAccessible>\n    </div>\n  );\n}\n","import type { JSX, RefObject } from 'preact';\nimport { useState, useEffect, useLayoutEffect, useMemo, useRef, useCallback } from 'preact/hooks';\nimport { Floating, Offset, Placement, Coords, FlipOptions, ShiftOptions } from '../UNSAFE_Floating';\nimport {\n  FocusableElement,\n  focusOn,\n  focusWithin,\n  getActiveElement\n} from '../utils/PRIVATE_tabbableUtils';\nimport { mergeRefs } from '../utils/PRIVATE_refUtils';\nimport { FocusTrap } from '../UNSAFE_FocusTrap';\nimport { Layer } from '../UNSAFE_Layer';\nimport { Modal } from '../UNSAFE_Modal';\nimport { WindowOverlay, WindowOverlayPlacement } from '../UNSAFE_WindowOverlay';\nimport { forwardRef, ForwardedRef } from 'preact/compat';\nimport type { UnpackSignals } from '@oracle/oraclejet-internal-utilities/attributeUtils';\nimport { usePopupAnimation } from './usePopupAnimation';\nimport { AnimationStatus } from '../hooks/PRIVATE_useAnimationStatus';\nimport { useTestId, TestIdProps } from '../hooks/UNSAFE_useTestId';\nimport { useOutsideClick } from '../hooks/UNSAFE_useOutsideClick';\nimport { getClientHints } from '../utils/PRIVATE_clientHints';\nimport { LiveRegion } from '../UNSAFE_LiveRegion';\nimport { PopupSkipLink } from './PopupSkipLink';\nimport { useTranslationBundle } from '../hooks/UNSAFE_useTranslationBundle';\nimport type { BundleType } from '../resources/nls/bundle';\n\n// Style imports\nimport { useComponentTheme } from '../hooks/UNSAFE_useComponentTheme';\nimport { popupVars } from './themes/PopupContract.css';\nimport { getVarName } from '@oracle/oraclejet-internal-utilities/stringUtils';\nimport { Property } from 'csstype';\nimport { classNames } from '../utils/UNSAFE_classNames';\nimport { PopupRedwoodTheme } from './themes/redwood/PopupTheme';\nimport { dimensionInterpolations, DimensionProps } from '../utils/UNSAFE_interpolations/dimensions';\nimport { colorInterpolations, ColorProps } from '../utils/UNSAFE_interpolations/colors';\nimport { mergeInterpolations } from '../utils/UNSAFE_mergeInterpolations';\n\nimport type { UnsafeDomHandle } from '#utils/UNSAFE_unsafeDomAccess';\nimport { UNSAFE_DOM_ACCESS } from '#utils/UNSAFE_unsafeDomAccess';\n\ntype IntrinsicProps = Pick<JSX.HTMLAttributes<HTMLDivElement>, 'children'>;\n\nexport type PopupPlacement = Placement | WindowOverlayPlacement;\nexport type OnCloseDetail = {\n  reason: 'escapeKey' | 'closeSkipLink';\n};\nexport type InitialFocus = 'auto' | 'none' | 'popup' | 'firstFocusable';\nexport type Tail = 'none' | 'simple';\nexport type Modality = 'modal' | 'modeless';\nexport type Variant = 'standard' | 'unstyled';\n\ntype Props = IntrinsicProps &\n  Pick<ColorProps, 'backgroundColor'> &\n  DimensionProps &\n  TestIdProps & {\n    /**\n     * Specifies whether the Popup is open.\n     */\n    isOpen: boolean;\n    /**\n     * Specifies Popup's anchor. Popup is placed relatively to its anchor.\n     */\n    anchorRef?: RefObject<Element | Coords | UnsafeDomHandle<Element>>;\n    /**\n     * Specifies Popup's launcher. After Popup closes, it returns focus to the launcher.\n     */\n    launcherRef?: RefObject<HTMLElement>;\n    /**\n     * Specifies placement of the Popup relative to the anchor.\n     */\n    placement?: PopupPlacement;\n    /**\n     * Specifies displacement of the Popup from the anchor element along the specified axes.\n     * The offset object consists of mainAxis and crossAxis properties. The direction in which these properties\n     * are applied depends on the current value of the position property.\n     *\n     * The <code>mainAxis</code> property represents the distance between the Popup and the anchor.\n     * The <code>crossAxis</code> property represents the deviation in the opposite axis to the main axis - the skidding between the Popup and the anchor.\n     */\n    offset?: Offset;\n    /**\n     * Specifies modality of the Popup.\n     */\n    modality?: Modality;\n    /**\n     * Specifies whether a floating Popup changes placement to the opposite side to be kept in view when a collision is detected.\n     *\n     * The flipOptions object consists of mainAxis and crossAxis properties.\n     * The <code>mainAxis</code> runs along the side of the Popup element.\n     * The <code>crossAxis</code> runs along the alignment of the Popup element.\n     */\n    flipOptions?: FlipOptions;\n    /**\n     * Specifies whether a floating Popup shifts along axis to be kept in view when a collision is detected.\n     * Note that if both 'flip' and 'shift' are enabled on respective axis, the flip will take precedence.\n     *\n     * The shiftOptions object consists of mainAxis and crossAxis properties.\n     * The <code>mainAxis</code> runs along the side of the Popup element.\n     * The <code>crossAxis</code> runs along the alignment of the Popup element.\n     */\n    shiftOptions?: ShiftOptions;\n    /**\n     * Specifies if the Popup sets focus to its content when initially open.\n     * A value of none prevents the popup from setting focus when open.\n     *\n     * <code>auto</code> in modeless mode resolves to none.\n     * <code>none</code> prevents the popup from setting focus when open.\n     * <code>popup</code> sets focus to the root popup container (good choice for touch platforms).\n     * <code>firstFocusable</code> defines that a popup should set focus to the first focusable element within the popup's content.\n     */\n    initialFocus?: InitialFocus;\n    /**\n     * Specifies callback triggered when a user clicks outside Popup.\n     */\n    onClickOutside?: (event: MouseEvent) => void;\n    /**\n     * Specifies callback triggered when a user tries to close a Popup through UI interaction.\n     * The parent should listen to this event and close the Popup. If the parent fails to remove\n     * the Popup, then no change will be done in the UI by the component.\n     */\n    onClose?: (detail: OnCloseDetail) => void;\n    /**\n     * Specifies callback triggered when initial focus is set or when Popup receives it via F6 key.\n     */\n    onFocusSet?: () => void;\n    /**\n     * Specifies Popup's tail. Simple tail is an arrow pointing to Popup's anchor.\n     */\n    tail?: Tail;\n    /**\n     * Specifies callback triggered after the animation ends.\n     */\n    onTransitionEnd?: (value: boolean) => void;\n    /**\n     * Specifies styling variant. If <code>unstyled</code> is set, standard styles are not applied.\n     */\n    variant?: Variant;\n    /**\n     * Specifies the ARIA role type.\n     */\n    role?: UnpackSignals<JSX.HTMLAttributes['role']>;\n    /**\n     * Specifies guidance for screen readers.\n     */\n    'aria-label'?: string;\n    /**\n     * Specifies ID of an element used for guidance for screen readers.\n     */\n    'aria-labelledby'?: string;\n    /**\n     * Specifies ID of an element (or space separated IDs of multiple elements) that\n     * describes the Drawer.\n     */\n    'aria-describedby'?: string;\n  };\n\n/**\n * A popup temporarily 'pops up' content in the foreground.\n */\nexport const Popup = forwardRef(\n  (\n    {\n      anchorRef,\n      launcherRef,\n      children,\n      isOpen = false,\n      modality = 'modeless',\n      offset = { mainAxis: 0, crossAxis: 0 },\n      flipOptions = { mainAxis: true, crossAxis: true },\n      shiftOptions = { mainAxis: false, crossAxis: false },\n      onClickOutside,\n      onClose,\n      initialFocus = 'auto',\n      placement = anchorRef ? 'top' : 'center',\n      tail = 'none',\n      onTransitionEnd,\n      onFocusSet,\n      variant = 'standard',\n      role = 'dialog',\n      'aria-label': ariaLabel,\n      'aria-labelledby': ariaLabelledBy,\n      'aria-describedby': ariaDescribedBy,\n      testId,\n      ...props\n    }: Props,\n    ref: ForwardedRef<HTMLElement | null>\n  ) => {\n    const localLauncherRef = useRef<HTMLElement | null>(null);\n    const [popupBgColor, setPopupBgColor] = useState<Property.BackgroundColor>();\n\n    const contentWrapperRef = useRef<HTMLDivElement | null>(null);\n\n    const prevStatusRef = useRef<AnimationStatus>('unmounted');\n\n    // testId support\n    const testIdProps = useTestId(testId);\n\n    const insideRefs: RefObject<HTMLElement>[] = [contentWrapperRef];\n    // launcher should be considered an \"inside\" element\n    if (localLauncherRef.current && localLauncherRef.current !== document.body) {\n      insideRefs.push(localLauncherRef);\n    }\n\n    const translations = useTranslationBundle<BundleType>('@oracle/oraclejet-preact');\n\n    const isModal = useCallback(() => {\n      return modality === 'modal';\n    }, [modality]);\n\n    // We can not merge outsideClick to onClose event with {reason: 'outsideClick'} payload\n    // The reason is that we allow outsideClick/autodismiss in modeless mode and\n    // we need to detect outsideClick which is\n    useOutsideClick({\n      isDisabled: !(isOpen && contentWrapperRef.current),\n      ref: insideRefs,\n      handler: (event) => {\n        onClickOutside?.(event);\n      }\n    });\n\n    const launcherKeyDownCallback = useCallback(\n      (event: KeyboardEvent): void => {\n        if (localLauncherRef.current === getActiveElement() && event.code === 'F6' && !isModal()) {\n          // Prevent default F6 handlers.\n          // F6 is a standard Chrome address bar shortcut on Windows.\n          event.preventDefault();\n          event.stopPropagation();\n\n          focusWithin(contentWrapperRef.current as HTMLElement);\n          onFocusSet?.();\n        }\n      },\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      [isModal]\n    );\n\n    const _onTransitionEnd = (isOpen: boolean) => {\n      if (isOpen) {\n        setInitialFocus();\n        onTransitionEnd?.(true);\n      } else {\n        onTransitionEnd?.(false);\n      }\n    };\n\n    // Animation\n    const { setAnimationElementRef, status, onPosition } = usePopupAnimation({\n      isOpen,\n      isAnimatedOnMount: true,\n      onTransitionEnd: _onTransitionEnd,\n      placement: placement\n    });\n\n    const stableRef = useMemo(() => mergeRefs(contentWrapperRef, ref), [contentWrapperRef, ref]);\n\n    const returnFocus = useCallback((): void => {\n      // Try to return focus to 1.launcher or 2.anchor\n      const launcherEl = localLauncherRef.current;\n      const anchor = anchorRef?.current;\n\n      if (launcherEl) {\n        focusOn(launcherEl);\n      } else if (anchor) {\n        let anchorElement: FocusableElement | null = null;\n\n        // Checking instanceof to avoid Coords type that can not be focused\n        if (anchor instanceof Element) {\n          anchorElement = anchor as FocusableElement;\n        } else if ((anchor as UnsafeDomHandle)[UNSAFE_DOM_ACCESS]) {\n          anchorElement = (anchor as UnsafeDomHandle)[UNSAFE_DOM_ACCESS];\n        }\n\n        if (anchorElement) {\n          focusOn(anchorElement);\n        }\n      }\n    }, [localLauncherRef, anchorRef]);\n\n    useEffect(() => {\n      // Init closing\n      if (!isOpen && status === 'opening' && !isModal()) {\n        // Only actively return focus to the launcher or anchor if the popup contained focus.\n        // Otherwise, focus is already elsewhere on the page and should not be forced back\n        // because that could reopen the popup again, which essentially prevents the user from\n        // moving focus out of the launcher.\n        if (contentWrapperRef.current?.contains(getActiveElement())) {\n          returnFocus();\n        }\n      }\n      // JET-71010 - for modal popups, the focus cannot be moved until the modal overlay is gone\n      else if (!isOpen && status === 'unmounted' && isModal()) {\n        // avoid returning focus on initial render\n        if (status !== prevStatusRef.current) {\n          returnFocus();\n        }\n      }\n      return () => {\n        prevStatusRef.current = status;\n      };\n    }, [isOpen, status, returnFocus, isModal]);\n\n    // Initialize launcher\n    useEffect(() => {\n      if (isOpen) {\n        if (!launcherRef?.current) {\n          // 1. If launcher is not defined, most frequent scenario is,\n          // that element, that has focus before opening a popup is considered launcher\n          localLauncherRef.current = getActiveElement() as HTMLElement;\n        } else if (launcherRef.current instanceof Element) {\n          // 2. launcherRef element was provided.\n          // Verify, if it exists in DOM, otherwise use the last active element\n          localLauncherRef.current = document.body.contains(launcherRef.current)\n            ? launcherRef.current\n            : (getActiveElement() as HTMLElement);\n        } else {\n          localLauncherRef.current = getActiveElement() as HTMLElement;\n        }\n        // Register F6 key handler to enter the Popup\n        localLauncherRef.current?.addEventListener('keydown', launcherKeyDownCallback);\n      }\n      return () => {\n        // Deregister F6 key handler\n        localLauncherRef.current?.removeEventListener('keydown', launcherKeyDownCallback);\n      };\n    }, [isOpen, launcherRef, launcherKeyDownCallback]);\n    // Note: unlike oj-c-popup we do not default anchorRef to launcherRef in Preact Popup\n    // If anchorRef is undefined, we use WindowOverlay as anchor\n\n    const setInitialFocus = () => {\n      let derivedInitialFocus = initialFocus;\n      if (initialFocus === 'auto') {\n        if (isModal()) {\n          // modal mode - set focus to first focusable\n          derivedInitialFocus = 'firstFocusable';\n        } else {\n          // modeless mode - do not steal focus by default\n          derivedInitialFocus = 'none';\n        }\n      }\n\n      // Case: 'popup'\n      // Focus on Popup container\n      if (derivedInitialFocus === 'popup') {\n        focusOn(contentWrapperRef.current as HTMLElement);\n        onFocusSet?.();\n      }\n\n      // Case: 'firstFocusable'\n      // Focus on first tabbable in the Popup container or container itself if there is none\n      if (derivedInitialFocus === 'firstFocusable') {\n        focusWithin(contentWrapperRef.current as HTMLElement);\n        onFocusSet?.();\n      }\n    };\n\n    const getMainAxisOffset = (offset?: Offset) => {\n      let calcOffset = 0;\n      if (offset) {\n        // @ts-ignore as OffsetFunction is going to be removed\n        // Property 'mainAxis' does not exist on type 'OffsetFunction'.\n        calcOffset = typeof offset === 'number' ? offset : offset.mainAxis || 0;\n        if (tail === 'simple') {\n          calcOffset += 5;\n        }\n      }\n      return calcOffset;\n    };\n\n    const getCrossAxisOffset = (offset?: Offset) => {\n      if (!offset) {\n        return 0;\n      } else {\n        // @ts-ignore as OffsetFunction is going to be removed\n        // Property 'crossAxis' does not exist on type 'OffsetFunction'.\n        return typeof offset === 'number' ? 0 : offset.crossAxis || 0;\n      }\n    };\n\n    const finalOffset = {\n      mainAxis: getMainAxisOffset(offset),\n      crossAxis: getCrossAxisOffset(offset)\n    };\n\n    const handlePopupKeyDown = (event: KeyboardEvent) => {\n      const currentlyFocusedEl = getActiveElement();\n      const wrapperEl = contentWrapperRef.current;\n      const launcherEl = localLauncherRef.current;\n      if (wrapperEl === currentlyFocusedEl || wrapperEl?.contains(currentlyFocusedEl)) {\n        switch (event.code) {\n          case 'Escape': {\n            // Trigger onClose event with outside click detail\n            onClose?.({ reason: 'escapeKey' });\n            break;\n          }\n          case 'F6':\n            // Prevent default F6 handlers.\n            // F6 is a standard Chrome address bar shortcut on Windows.\n            event.preventDefault();\n            event.stopPropagation();\n\n            // Focus launcher\n            if (launcherEl && !isModal()) {\n              focusOn(launcherEl);\n            }\n            break;\n        }\n      }\n    };\n\n    useLayoutEffect(() => {\n      if (\n        status === 'unmounted' ||\n        contentWrapperRef.current == null ||\n        popupBgColor != null ||\n        tail === 'none'\n      )\n        return;\n\n      const backgroundColorVar = getVarName(popupVars.backgroundColor);\n      const computedStyle = getComputedStyle(contentWrapperRef.current!);\n      setPopupBgColor(props.backgroundColor || computedStyle.getPropertyValue(backgroundColorVar));\n    }, [status, contentWrapperRef, popupBgColor, tail, props.backgroundColor]);\n\n    const clientHints = getClientHints();\n    const isVOSupported = ['ios', 'android'].indexOf(clientHints.platform) > -1;\n    // Note: Popup does not have 'open' status. It is 'opening' even when open.\n    const renderVOSupport = status === 'opening';\n\n    // Styles\n    const { baseTheme, classes } = useComponentTheme(PopupRedwoodTheme);\n    const isMounted = status !== 'unmounted';\n\n    const interpolations = [\n      ...Object.values(dimensionInterpolations),\n      ...Object.values(colorInterpolations)\n    ];\n    const styleInterpolations = mergeInterpolations<DimensionProps & ColorProps>(interpolations);\n    const { ...styles } = styleInterpolations(props);\n\n    const closeSkipLinkCallback = () => {\n      // Trigger onClose event with outside click detail\n      onClose?.({ reason: 'closeSkipLink' });\n    };\n\n    const renderPopup = () => {\n      return (\n        <>\n          <FocusTrap restoreFocusRef={false}>\n            {/*Setting restoreFocusRef to false because otherwise FocusTrap is stealing the focus back when :*/}\n            {/*we click outside of modeless Popup (that keeps being open).*/}\n            <div\n              ref={stableRef}\n              tabIndex={-1}\n              role={role}\n              className={classNames([baseTheme, variant === 'unstyled' ? null : classes])}\n              style={styles}\n              onKeyDown={handlePopupKeyDown}\n              aria-label={ariaLabel}\n              aria-labelledby={ariaLabelledBy}\n              aria-describedby={ariaDescribedBy}\n              {...testIdProps}>\n              {/* Acc: Close SkipLink */}\n              {!isModal() && isVOSupported && renderVOSupport && (\n                <PopupSkipLink\n                  callback={closeSkipLinkCallback}\n                  message={`${translations.popup_close_skipLink}`}></PopupSkipLink>\n              )}\n              {children}\n            </div>\n          </FocusTrap>\n\n          {/* Acc: LiveRegion */}\n          {!isModal() &&\n            // Render on non-mobile only.\n            !isVOSupported && (\n              <LiveRegion>\n                {`${\n                  ['auto', 'none'].indexOf(initialFocus) != -1\n                    ? translations.popup_liveRegion_F6_initial_focus_none\n                    : translations.popup_liveRegion_F6_initial_focus_firstFocusable\n                }`}\n              </LiveRegion>\n            )}\n        </>\n      );\n    };\n\n    const renderFloatingOrOverlayPopup = () => {\n      if (!anchorRef || !anchorRef.current) {\n        return (\n          <WindowOverlay placement={placement as WindowOverlayPlacement} offset={finalOffset}>\n            <div ref={setAnimationElementRef}>{renderPopup()}</div>\n          </WindowOverlay>\n        );\n      } else {\n        return (\n          <Floating\n            ref={setAnimationElementRef}\n            backgroundColor={popupBgColor}\n            anchorRef={anchorRef}\n            placement={placement as Placement}\n            offsetValue={finalOffset}\n            flipOptions={flipOptions}\n            shiftOptions={shiftOptions}\n            tail={tail}\n            onPosition={onPosition}>\n            {renderPopup()}\n          </Floating>\n        );\n      }\n    };\n\n    if (isMounted) {\n      if (isModal()) {\n        return <Modal isOpen={isMounted}>{renderFloatingOrOverlayPopup()}</Modal>;\n      } else {\n        return <Layer>{renderFloatingOrOverlayPopup()}</Layer>;\n      }\n    } else return null;\n  }\n);\n"],"names":["useRef","_jsx","HiddenAccessible","forwardRef","useState","useTestId","useTranslationBundle","useCallback","useOutsideClick","getActiveElement","focusWithin","usePopupAnimation","useMemo","mergeRefs","focusOn","UNSAFE_DOM_ACCESS","useEffect","useLayoutEffect","getVarName","popupVars","clientHints","getClientHints","useComponentTheme","PopupRedwoodTheme","dimensionInterpolations","colorInterpolations","mergeInterpolations","_jsxs","FocusTrap","classNames","LiveRegion","WindowOverlay","Floating","Modal","Layer"],"mappings":"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"}
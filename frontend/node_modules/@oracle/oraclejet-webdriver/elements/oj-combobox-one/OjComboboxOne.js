"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.OjComboboxOne = void 0;
const selenium_webdriver_1 = require("selenium-webdriver");
const OjComboboxOneBase_1 = require("./OjComboboxOneBase");
const oj_module_proxy_1 = require("../../lib/oj-module-proxy");
/**
 * The component WebElement for [oj-combobox-one](../../jsdocs/oj.ojComboboxOne.html).
 * Do not instantiate this class directly, instead, use
 * [ojComboboxOne](../functions/elements.ojComboboxOne-1.html).
 */
class OjComboboxOne extends OjComboboxOneBase_1.OjComboboxOneBase {
    /**
     * Sets the value of "value" property.
     * The value of the element.
     * @param value The value to set for "value"
     * @override
     */
    async changeValue(value) {
        // Only mutate if not readonly/disabled
        const readonly = await this.getReadonly();
        const disabled = await this.getDisabled();
        if (!(readonly || disabled)) {
            await this.getDriver().executeScript((element) => element.focus(), this);
            await this.whenBusyContextReady();
            const isValueSet = await (0, oj_module_proxy_1.executeWithModules)(this.getDriver(), ['CustomElementUtils'], [this, value], ({ getElementBridge }, element, value) => {
                // Retrieve the widget instance from the element
                var bridge = getElementBridge(element);
                var widget = bridge._WIDGET_INSTANCE.combobox;
                return widget
                    ._selectItemByValue(value)
                    .then(() => true)
                    .catch(() => false);
            });
            // If failed to set value, fallback to setProperty
            if (isValueSet === false) {
                console.warn('Failed to update value by interaction. Falling back to setProperty.');
                await this._changeValueFallback(value);
            }
        }
    }
    /**
     * Clears the value
     * @override
     */
    async clear() {
        const input = await this.findElement(selenium_webdriver_1.By.css('.oj-combobox-input'));
        await input.clear();
        await input.sendKeys(selenium_webdriver_1.Key.ENTER);
    }
    /**
     * This is a fallback mechanism for setting a value which
     * uses the setProperty method to update the value.
     *
     * @param value The value to be set
     */
    _changeValueFallback(value) {
        return this.setProperty('value', value);
    }
}
exports.OjComboboxOne = OjComboboxOne;
//# sourceMappingURL=OjComboboxOne.js.map